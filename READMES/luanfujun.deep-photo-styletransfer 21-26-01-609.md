deep photo styletransfer code and data for paper deep photo style transfer disclaimer this software is published for academic and non commercial use only setup this code is based on torch it has been tested on ubuntu 14 04 lts dependencies torch with matio ffi and loadcaffe matlab or octave cuda backend cuda cudnn download vgg 19 sh models download models sh compile cuda utils cu adjust prefix and nvcc prefix in makefile for your machine make clean make usage quick start to generate all results in examples using the provided scripts simply run run gen laplacian gen laplacian m in matlab or octave and then python gen all py in python the final output will be in examples final results basic usage given input and style images with semantic segmentation masks put them in examples respectively they will have the following filename form examples input in id png examples style tar id png and examples segmentation in id png examples segmentation tar id png compute the matting laplacian matrix using gen laplacian gen laplacian m in matlab the output matrix will have the following filename form gen laplacian input laplacian 3x3 1e 7 csr id mat note please make sure that the content image resolution is consistent for matting laplacian computation in matlab and style transfer in torch otherwise the result wont be correct run the following script to generate segmented intermediate result th neuralstyle seg lua content image input style image style content seg inputmask style seg stylemask index id serial intermediate folder run the following script to generate final result th deepmatting seg lua content image input style image style content seg inputmask style seg stylemask index id init image intermediate folder out id t 1000 png serial final folder f radius 15 f edge 0 01 you can pass backend cudnn and cudnn autotune to both lua scripts step 3 and 4 to potentially improve speed and memory usage libcudnn so must be in your ld library path this requires cudnn torch image segmentation note in the main paper we generate all comparison results using automatic scene segmentation algorithm modified from dilatednet manual segmentation enables more diverse tasks hence we provide the masks in examples segmentation the mask colors we used you could add more colors in extractmask function in two lua files color variable rgb value hex value blue 0 0 255 0000ff green 0 255 0 00ff00 black 0 0 0 000000 white 255 255 255 ffffff red 255 0 0 ff0000 yellow 255 255 0 ffff00 grey 128 128 128 808080 lightblue 0 255 255 00ffff purple 255 0 255 ff00ff here are some automatic and manual tools for creating a segmentation mask for a photo image automatic mit scene parsing superparsing nonparametric scene parsing berkeley contour detection and image segmentation resources crf rnn for semantic image segmentation selective search deeplab tensorflow manual photoshop quick selection tool gimp selection tool gimp gmic interactive foreground extraction tool examples here are some results from our algorithm from left to right are input style and our output acknowledgement our torch implementation is based on justin johnsons code we use anat levins matlab code to compute the matting laplacian matrix citation if you find this work useful for your research please cite article luan2017deep title deep photo style transfer author luan fujun and paris sylvain and shechtman eli and bala kavita journal arxiv preprint arxiv 1703 07511 year 2017 contact feel free to contact me if there is any question fujun luan fl356 cornell edu