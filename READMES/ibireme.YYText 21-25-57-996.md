yytext powerful text framework for ios to display and edit rich text its a component of yykit features uilabel and uitextview api compatible high performance asynchronous text layout and rendering extended coretext attributes with more text effects text attachments with uiimage uiview and calayer custom highlight text range to allow user interact with text parser support built in markdown emoticon parser text container path and exclusion paths support vertical form layout support for cjk text image and attributed text copy paste support attributed text placeholder support custom keyboard view support undo and redo control attributed text archiver and unarchiver support multi language and voiceover support interface builder support fully documented architecture yytext vs textkit text attributes yytext supported attributes demo attribute name class textattachment yytextattachment texthighlight yytexthighlight textbinding yytextbinding textshadowtextinnershadow yytextshadow textborder yytextborder textbackgroundborder yytextborder textblockborder yytextborder textglyphtransform nsvalue cgaffinetransform textunderline yytextdecoration textstrickthrough yytextdecoration textbackedstring yytextbackedstring coretext attributes which is supported by yytext demo attribute name class font uifont ctfontref kern nsnumber strokewidth nsnumber strokecolor cgcolorref shadow nsshadow ligature nsnumber verticalglyphform nsnumber bool writingdirection nsarray nsnumber rundelegate ctrundelegateref textalignment nsparagraphstyle nstextalignment linebreakmode nsparagraphstyle nslinebreakmode linespacing nsparagraphstyle cgfloat paragraphspacing paragraphspacingbefore nsparagraphstyle cgfloat firstlineheadindent nsparagraphstyle cgfloat headindent nsparagraphstyle cgfloat tailindent nsparagraphstyle cgfloat minimumlineheight nsparagraphstyle cgfloat maximumlineheight nsparagraphstyle cgfloat lineheightmultiple nsparagraphstyle cgfloat basewritingdirection nsparagraphstyle nswritingdirection defaulttabinterval tabstops nsparagraphstyle cgfloat nsarray nstexttab usage basic objc yylabel similar to uilabel yylabel label yylabel new label frame label font label textcolor label textalignment label linebreakmode label numberoflines label text yytextview similar to uitextview yytextview textview yytextview new textview frame textview font textview textcolor textview datadetectortypes textview placeholdertext textview placeholdertextcolor textview delegate attributed text objc 1 create an attributed string nsmutableattributedstring text nsmutableattributedstring alloc initwithstring some text blabla 2 set attributes to text you can use almost all coretext attributes text yy font uifont boldsystemfontofsize 30 text yy color uicolor bluecolor text yy setcolor uicolor redcolor range nsmakerange 0 4 text yy linespacing 10 3 set to yylabel or yytextview yylabel label yylabel new label frame label attributedstring text yytextview textview yytextview new textview frame textview attributedstring text text highlight you can use some convenience methods to set text highlight objc text yy settexthighlightrange range color uicolor bluecolor backgroundcolor uicolor graycolor tapaction uiview containerview nsattributedstring text nsrange range cgrect rect nslog tap text range or set the text highlight with your custom config objc 1 create a highlight attribute for text yytextborder border yytextborder borderwithfillcolor uicolor graycolor cornerradius 3 yytexthighlight highlight yytexthighlight new highlight setcolor uicolor whitecolor highlight setbackgroundborder highlightborder highlight tapaction uiview containerview nsattributedstring text nsrange range cgrect rect nslog tap text range you can also set the action handler to yylabel or yytextview 2 add highlight attribute to a range of text attributedtext yy settexthighlight highlight range highlightrange 3 set text to label or text view yylabel label label attributedtext attributedtext yytextview textview textview attributedtext 4 receive user interactive action label highlighttapaction uiview containerview nsattributedstring text nsrange range cgrect rect nslog tap text range label highlightlongpressaction uiview containerview nsattributedstring text nsrange range cgrect rect nslog long press text range uitextviewdelegate void textview yytextview textview didtaphighlight yytexthighlight highlight inrange nsrange characterrange rect cgrect rect nslog tap text range void textview yytextview textview didlongpresshighlight yytexthighlight highlight inrange nsrange characterrange rect cgrect rect nslog long press text range text attachments objc nsmutableattributedstring text nsmutableattributedstring new uifont font uifont systemfontofsize 16 nsmutableattributedstring attachment nil uiimage attachment uiimage image uiimage imagenamed dribbble64 imageio attachment nsmutableattributedstring yy attachmentstringwithcontent image contentmode uiviewcontentmodecenter attachmentsize image size aligntofont font alignment yytextverticalalignmentcenter text appendattributedstring attachment uiview attachment uiswitch switcher uiswitch new switcher sizetofit attachment nsmutableattributedstring yy attachmentstringwithcontent switcher contentmode uiviewcontentmodebottom attachmentsize switcher size aligntofont font alignment yytextverticalalignmentcenter text appendattributedstring attachment calayer attachment casharplayer layer casharplayer layer layer path attachment nsmutableattributedstring yy attachmentstringwithcontent layer contentmode uiviewcontentmodebottom attachmentsize switcher size aligntofont font alignment yytextverticalalignmentcenter text appendattributedstring attachment text layout calculation objc nsattributedstring text cgsize size cgsizemake 100 cgfloat max yytextlayout layout yytextlayout layoutwithcontainersize size text text get text bounding layout textboundingrect get bounding rect layout textboundingsize get bounding size query text layout layout lineindexforpoint cgpointmake 10 10 layout closestlineindexforpoint cgpointmake 10 10 layout closestpositiontopoint cgpointmake 10 10 layout textrangeatpoint cgpointmake 10 10 layout rectforrange yytextrange rangewithrange nsmakerange 10 2 layout selectionrectsforrange yytextrange rangewithrange nsmakerange 10 2 text layout display yylabel label yylabel new label size layout textboundingsize label textlayout layout adjust text line position objc convenience methods 1 create a text line position modifier implementsyytextlinepositionmodifier protocol 2 set it to label or text view yytextlinepositionsimplemodifier modifier yytextlinepositionsimplemodifier new modifier fixedlineheight 24 yylabel label yylabel new label linepositionmodifier modifier fully control yytextlinepositionsimplemodifier modifier yytextlinepositionsimplemodifier new modifier fixedlineheight 24 yytextcontainer container yytextcontainer new container size cgsizemake 100 cgfloat max container linepositionmodifier modifier yytextlayout layout yytextlayout layoutwithcontainer container text text yylabel label yylabel new label size layout textboundingsize label textlayout layout asynchronous layout and rendering objc if you have performance issues you may enable the asynchronous display mode yylabel label label displaysasynchronously yes if you want to get the highest performance you should do text layout with yytextlayout class in background thread yylabel label yylabel new label displaysasynchronously yes label ignorecommonproperties yes dispatch async dispatch get global queue dispatch queue priority default 0 create attributed string nsmutableattributedstring text nsmutableattributedstring alloc initwithstring some text text yy font uifont systemfontofsize 16 text yy color uicolor graycolor text yy setcolor uicolor redcolor range nsmakerange 0 4 create text container yytextcontainer container yytextcontainer new container size cgsizemake 100 cgfloat max container maximumnumberofrows 0 generate a text layout yytextlayout layout yytextlayout layoutwithcontainer container text text dispatch async dispatch get main queue label size layout textboundingsize label textlayout layout text container control objc yylabel label label textcontainerpath uibezierpath bezierpathwith label exclusionpaths uibezierpath bezierpathwith label textcontainerinset uiedgeinsetsmake label verticalform yes no yytextview textview textview exclusionpaths uibezierpath bezierpathwith textview textcontainerinset uiedgeinsetsmake textview verticalform yes no text parser objc 1 create a text parser yytextsimpleemoticonparser parser yytextsimpleemoticonparser new nsmutabledictionary mapper nsmutabledictionary new mapper smile uiimage imagenamed smile png mapper cool uiimage imagenamed cool png mapper cry uiimage imagenamed cry png mapper wink uiimage imagenamed wink png parser emoticonmapper mapper yytextsimplemarkdownparser parser yytextsimplemarkdownparser new parser setcolorwithdarktheme mycustomparser parser custom parser 2 attach parser to label or text view yylabel label label textparser parser yytextview textview textview textparser parser debug objc set a shared debug option to show text layout result yytextdebugoption debugoptions yytextdebugoption new debugoptions baselinecolor uicolor redcolor debugoptions ctframebordercolor uicolor redcolor debugoptions ctlinefillcolor uicolor colorwithred 0 000 green 0 463 blue 1 000 alpha 0 180 debugoptions cgglyphbordercolor uicolor colorwithred 1 000 green 0 524 blue 0 000 alpha 0 200 yytextdebugoption setshareddebugoption debugoptions more examples see demo yytextdemo xcodeproj for more examples installation cocoapods add pod yytext to your podfile run pod install or pod update import \ yytext yytext h carthage add github ibireme yytext to your cartfile run carthage update platform ios and add the framework to your project import \ yytext yytext h manually download all the files in the yytext subdirectory add the source files to your xcode project link with required frameworks uikit corefoundation coretext quartzcore accelerate mobilecoreservices import yytext h notice you may add yyimage or yywebimage to your project if you want to support animated image gif apng webp documentation full api documentation is available on cocoadocs you can also install documentation locally using appledoc requirements this library requires ios 6 0 and xcode 8 0 license yytext is released under the mit license see license file for details 中文介绍 功能强大的 ios 富文本编辑与显示框架。 该项目是 yykit 组件之一 特性 api 兼容 uilabel 和 uitextview 支持高性能的异步排版和渲染 扩展了 coretext 的属性以支持更多文字效果 支持 uiimage、uiview、calayer 作为图文混排元素 支持添加自定义样式的、可点击的文本高亮范围 支持自定义文本解析 内置简单的 markdown 表情解析 支持文本容器路径、内部留空路径的控制 支持文字竖排版，可用于编辑和显示中日韩文本 支持图片和富文本的复制粘贴 文本编辑时，支持富文本占位符 支持自定义键盘视图 撤销和重做次数的控制 富文本的序列化与反序列化支持 支持多语言，支持 voiceover 支持 interface builder 全部代码都有文档注释 架构 yytext 和 textkit 架构对比 文本属性 yytext 原生支持的属性 demo attribute name class textattachment yytextattachment texthighlight yytexthighlight textbinding yytextbinding textshadowtextinnershadow yytextshadow textborder yytextborder textbackgroundborder yytextborder textblockborder yytextborder textglyphtransform nsvalue cgaffinetransform textunderline yytextdecoration textstrickthrough yytextdecoration textbackedstring yytextbackedstring yytext 支持的 coretext 属性 demo attribute name class font uifont ctfontref kern nsnumber strokewidth nsnumber strokecolor cgcolorref shadow nsshadow ligature nsnumber verticalglyphform nsnumber bool writingdirection nsarray nsnumber rundelegate ctrundelegateref textalignment nsparagraphstyle nstextalignment linebreakmode nsparagraphstyle nslinebreakmode linespacing nsparagraphstyle cgfloat paragraphspacing paragraphspacingbefore nsparagraphstyle cgfloat firstlineheadindent nsparagraphstyle cgfloat headindent nsparagraphstyle cgfloat tailindent nsparagraphstyle cgfloat minimumlineheight nsparagraphstyle cgfloat maximumlineheight nsparagraphstyle cgfloat lineheightmultiple nsparagraphstyle cgfloat basewritingdirection nsparagraphstyle nswritingdirection defaulttabinterval tabstops nsparagraphstyle cgfloat nsarray nstexttab 用法 基本用法 objc yylabel 和 uilabel 用法一致 yylabel label yylabel new label frame label font label textcolor label textalignment label linebreakmode label numberoflines label text yytextview 和 uitextview 用法一致 yytextview textview yytextview new textview frame textview font textview textcolor textview datadetectortypes textview placeholdertext textview placeholdertextcolor textview delegate 属性文本 objc 1 创建一个属性文本 nsmutableattributedstring text nsmutableattributedstring alloc initwithstring some text blabla 2 为文本设置属性 text yy font uifont boldsystemfontofsize 30 text yy color uicolor bluecolor text yy setcolor uicolor redcolor range nsmakerange 0 4 text yy linespacing 10 3 赋值到 yylabel 或 yytextview yylabel label yylabel new label frame label attributedstring text yytextview textview yytextview new textview frame textview attributedstring text 文本高亮 你可以用一些已经封装好的简便方法来设置文本高亮： objc text yy settexthighlightrange range color uicolor bluecolor backgroundcolor uicolor graycolor tapaction uiview containerview nsattributedstring text nsrange range cgrect rect nslog tap text range 或者用更复杂的办法来调节文本高亮的细节： objc 1 创建一个 高亮 属性，当用户点击了高亮区域的文本时， 高亮 属性会替换掉原本的属性 yytextborder border yytextborder borderwithfillcolor uicolor graycolor cornerradius 3 yytexthighlight highlight yytexthighlight new highlight setcolor uicolor whitecolor highlight setbackgroundborder highlightborder highlight tapaction uiview containerview nsattributedstring text nsrange range cgrect rect nslog tap text range 你也可以把事件回调放到 yylabel 和 yytextview 来处理。 2 把 高亮 属性设置到某个文本范围 attributedtext yy settexthighlight highlight range highlightrange 3 把属性文本设置到 yylabel 或 yytextview yylabel label label attributedtext attributedtext yytextview textview textview attributedtext 4 接受事件回调 label highlighttapaction uiview containerview nsattributedstring text nsrange range cgrect rect nslog tap text range label highlightlongpressaction uiview containerview nsattributedstring text nsrange range cgrect rect nslog long press text range uitextviewdelegate void textview yytextview textview didtaphighlight yytexthighlight highlight inrange nsrange characterrange rect cgrect rect nslog tap text range void textview yytextview textview didlongpresshighlight yytexthighlight highlight inrange nsrange characterrange rect cgrect rect nslog long press text range 图文混排 objc nsmutableattributedstring text nsmutableattributedstring new uifont font uifont systemfontofsize 16 nsmutableattributedstring attachment nil 嵌入 uiimage uiimage image uiimage imagenamed dribbble64 imageio attachment nsmutableattributedstring yy attachmentstringwithcontent image contentmode uiviewcontentmodecenter attachmentsize image size aligntofont font alignment yytextverticalalignmentcenter text appendattributedstring attachment 嵌入 uiview uiswitch switcher uiswitch new switcher sizetofit attachment nsmutableattributedstring yy attachmentstringwithcontent switcher contentmode uiviewcontentmodebottom attachmentsize switcher size aligntofont font alignment yytextverticalalignmentcenter text appendattributedstring attachment 嵌入 calayer casharplayer layer casharplayer layer layer path attachment nsmutableattributedstring yy attachmentstringwithcontent layer contentmode uiviewcontentmodebottom attachmentsize switcher size aligntofont font alignment yytextverticalalignmentcenter text appendattributedstring attachment 文本布局计算 objc nsattributedstring text cgsize size cgsizemake 100 cgfloat max yytextlayout layout yytextlayout layoutwithcontainersize size text text 获取文本显示位置和大小 layout textboundingrect get bounding rect layout textboundingsize get bounding size 查询文本排版结果 layout lineindexforpoint cgpointmake 10 10 layout closestlineindexforpoint cgpointmake 10 10 layout closestpositiontopoint cgpointmake 10 10 layout textrangeatpoint cgpointmake 10 10 layout rectforrange yytextrange rangewithrange nsmakerange 10 2 layout selectionrectsforrange yytextrange rangewithrange nsmakerange 10 2 显示文本排版结果 yylabel label yylabel new label size layout textboundingsize label textlayout layout 文本行位置调整 objc 由于中文、英文、emoji 等字体高度不一致，或者富文本中出现了不同字号的字体， 可能会造成每行文字的高度不一致。这里可以添加一个修改器来实现固定行高，或者自定义文本行位置。 简单的方法 1 创建一个文本行位置修改类，实现 yytextlinepositionmodifier 协议。 2 设置到 label 或 textview。 yytextlinepositionsimplemodifier modifier yytextlinepositionsimplemodifier new modifier fixedlineheight 24 yylabel label yylabel new label linepositionmodifier modifier 完全控制 yytextlinepositionsimplemodifier modifier yytextlinepositionsimplemodifier new modifier fixedlineheight 24 yytextcontainer container yytextcontainer new container size cgsizemake 100 cgfloat max container linepositionmodifier modifier yytextlayout layout yytextlayout layoutwithcontainer container text text yylabel label yylabel new label size layout textboundingsize label textlayout layout 异步排版和渲染 objc 如果你在显示字符串时有性能问题，可以这样开启异步模式： yylabel label label displaysasynchronously yes 如果需要获得最高的性能，你可以在后台线程用 yytextlayout 进行预排版： yylabel label yylabel new label displaysasynchronously yes 开启异步绘制 label ignorecommonproperties yes 忽略除了 textlayout 之外的其他属性 dispatch async dispatch get global queue dispatch queue priority default 0 创建属性字符串 nsmutableattributedstring text nsmutableattributedstring alloc initwithstring some text text yy font uifont systemfontofsize 16 text yy color uicolor graycolor text yy setcolor uicolor redcolor range nsmakerange 0 4 创建文本容器 yytextcontainer container yytextcontainer new container size cgsizemake 100 cgfloat max container maximumnumberofrows 0 生成排版结果 yytextlayout layout yytextlayout layoutwithcontainer container text text dispatch async dispatch get main queue label size layout textboundingsize label textlayout layout 文本容器控制 objc yylabel label label textcontainerpath uibezierpath bezierpathwith label exclusionpaths uibezierpath bezierpathwith label textcontainerinset uiedgeinsetsmake label verticalform yes no yytextview textview textview exclusionpaths uibezierpath bezierpathwith textview textcontainerinset uiedgeinsetsmake textview verticalform yes no 文本解析 objc 1 创建一个解析器 内置简单的表情解析 yytextsimpleemoticonparser parser yytextsimpleemoticonparser new nsmutabledictionary mapper nsmutabledictionary new mapper smile uiimage imagenamed smile png mapper cool uiimage imagenamed cool png mapper cry uiimage imagenamed cry png mapper wink uiimage imagenamed wink png parser emoticonmapper mapper 内置简单的 markdown 解析 yytextsimplemarkdownparser parser yytextsimplemarkdownparser new parser setcolorwithdarktheme 实现 yytextparser 协议的自定义解析器 mycustomparser parser 2 把解析器添加到 yylabel 或 yytextview yylabel label label textparser parser yytextview textview textview textparser parser debug objc 设置一个全局的 debug option 来显示排版结果。 yytextdebugoption debugoptions yytextdebugoption new debugoptions baselinecolor uicolor redcolor debugoptions ctframebordercolor uicolor redcolor debugoptions ctlinefillcolor uicolor colorwithred 0 000 green 0 463 blue 1 000 alpha 0 180 debugoptions cgglyphbordercolor uicolor colorwithred 1 000 green 0 524 blue 0 000 alpha 0 200 yytextdebugoption setshareddebugoption debugoptions 更多示例 查看演示工程 demo yytextdemo xcodeproj 安装 cocoapods 在 podfile 中添加 pod yytext。 执行 pod install 或 pod update。 导入 \ yytext yytext h 。 carthage 在 cartfile 中添加 github ibireme yytext 。 执行 carthage update platform ios 并将生成的 framework 添加到你的工程。 导入 \ yytext yytext h 。 手动安装 下载 yytext 文件夹内的所有内容。 将 yytext 内的源文件添加 拖放 到你的工程。 链接以下 frameworks uikit corefoundation coretext quartzcore accelerate mobilecoreservices 导入 yytext h。 注意 你可以添加 yyimage 或 yywebimage 到你的工程，以支持动画格式 gif apng webp 的图片。 文档 你可以在 cocoadocs 查看在线 api 文档，也可以用 appledoc 本地生成文档。 系统要求 该项目最低支持 ios 6 0 和 xcode 8 0。 已知问题 yytext 并不能支持所有 coretext textkit 的属性，比如 nsbackgroundcolor、nsstrikethrough、nsunderline、nsattachment、nslink 等，但 yytext 中基本都有对应属性作为替代。详情见上方表格。 yytextview 未实现局部刷新，所以在输入和编辑大量的文本（比如超过大概五千个汉字、或大概一万个英文字符）时会出现较明显的卡顿现象。 竖排版时，添加 exclusionpaths 在少数情况下可能会导致文本显示空白。 当添加了非矩形的 textcontainerpath，并且有嵌入大于文本排版方向宽度的 rundelegate 时，rundelegate 之后的文字会无法显示。这是 coretext 的 bug（或者说是 feature）。 许可证 yytext 使用 mit 许可证，详情见 license 文件。