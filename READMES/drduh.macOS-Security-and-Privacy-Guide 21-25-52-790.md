this guide is a collection of thoughts on and techniques for securing a modern apple mac computer macbook using macos formerly known as os x version 10 12 sierra as well as steps to generally improving privacy this guide is targeted to “power users” who wish to adopt enterprise standard security but is also suitable for novice users with an interest in improving their privacy and security on a mac a system is only as secure as its administrator is capable of making it there is no one single technology software nor technique to guarantee perfect computer security a modern operating system and computer is very complex and requires numerous incremental changes to meaningfully improve ones security and privacy posture this guide is provided on an as is basis without any warranties of any kind only you are responsible if you break a mac by following any of the steps herein if you wish to make a correction or improvement please send a pull request or open an issue this guide is also available in 简体中文 basics firmware preparing and installing macos virtualization first boot system activation admin and standard user accounts full disk encryption firewall application layer firewall third party firewalls kernel level packet filtering services spotlight suggestions homebrew dns hosts file dnscrypt dnsmasq test dnssec validation captive portal certificate authorities openssl curl web privoxy browser google chrome firefox safari web browsers and privacy plugins pgp gpg otr tor vpn viruses and malware system integrity protection gatekeeper and xprotect metadata and artifacts passwords backup wi fi ssh physical access system monitoring openbsm audit dtrace execution network binary whitelisting miscellaneous related software additional resources basics the standard best security practices apply create a threat model what are you trying to protect and from whom is your adversary a three letter agency if so you may want to consider using openbsd instead a nosy eavesdropper on the network or determined apt orchestrating a campaign against you study and recognize threats and how to reduce attack surface against them keep the system up to date patch patch patch your system and software macos system updates can be completed using the app store application or the softwareupdate command line utility neither requires registering an apple account subscribe to announcement mailing lists e g apple security announce for programs you use often encrypt sensitive data in addition to full disk encryption create one or many encrypted containers to store passwords keys personal documents and other data at rest this will mitigate damage in case of compromise and data exfiltration frequent backups create regular backups of your data and be ready to reimage in case of compromise always encrypt before copying backups to external media or the cloud verify backups work by testing them regularly for example by accessing certain files or performing a hash based comparison click carefully ultimately the security of a system can be reduced to its administrator care should be taken when installing new software always prefer free and open source software which macos is not firmware setting a firmware password prevents your mac from starting up from any device other than your startup disk it may also be set to be required on each boot this feature can be helpful if your laptop is lost or stolen protects against direct memory access dma attacks which can read your filevault passwords and inject kernel modules such as pcileech as the only way to reset the firmware password is through an apple store or by using an spi programmer such as bus pirate or other flash ic programmer start up pressing command r keys to boot to recovery mode mode when the recovery window appears choose firmware password utility from the utilities menu in the firmware utility window that appears select turn on firmware password enter a new password then enter the same password in the verify field select set password select quit firmware utility to close the firmware password utility select the apple menu and choose restart or shutdown the firmware password will activate at next boot to validate the password hold alt during boot you should be prompted to enter the password the firmware password can also be managed with the firmwarepasswd utility while booted into the os for example to prompt for the firmware password when attempting to boot from a different volume sudo firmwarepasswd setpasswd setmode command enter a password and reboot using a dediprog sf600 to dump and flash a 2013 macbook spi flash chip to remove a firmware password sans apple see ht204455 longsoft uefitool and chipsec chipsec for more information preparing and installing macos there are several ways to install a fresh copy of macos the simplest way is to boot into recovery mode by holding command r keys at boot a system image can be downloaded and applied directly from apple however this way exposes the serial number and other identifying information over the network in plaintext packet capture of an unencrypted http conversation during macos recovery another way is to download macos sierra from the app store or some other place and create a custom installable system image the macos sierra installer application is code signed which should be verified to make sure you received a legitimate copy using the spctl a v or pkgutil check signature commands shell pkgutil check signature applications install\ macos\ sierra app package install macos sierra app status signed by a certificate trusted by mac os x certificate chain 1 apple mac os application signing sha1 fingerprint b9 3b da aa f1 a8 84 6b 34 ba 32 33 26 35 cb 2b 84 85 3d a8 2 apple worldwide developer relations certification authority sha1 fingerprint ff 67 97 79 3a 3c d7 98 dc 5b 2a be f5 6f 73 ed c9 f8 3a 64 3 apple root ca sha1 fingerprint 61 1e 5b 66 2c 59 3a 08 ff 58 d1 4a e2 24 52 d1 98 df 6c 60 you may also use the codesign command to examine an applications code signature shell codesign dvv applications install\ macos\ sierra app executable applications install macos sierra app contents macos installassistant identifier com apple installassistant sierra format app bundle with mach o thin x86 64 codedirectory v 20200 size 297 flags 0x200 kill hashes 5 5 location embedded signature size 4167 authority apple mac os application signing authority apple worldwide developer relations certification authority authority apple root ca info plist entries 30 teamidentifier k36bkf7t3d sealed resources version 2 rules 7 files 137 internal requirements count 1 size 124 macos installers can be made with the createinstallmedia utility included in install macos sierra app contents resources see create a bootable installer for macos or run the utility without arguments to see how it works note apples installer does not appear to work across os versions if you want to build a 10 12 image for example the following steps must be run on a 10 12 machine to create a bootable usb installer mount a usb drive and erase and partition it then use the createinstallmedia utility shell diskutil list find disk matching correct size usually disk2 diskutil unmountdisk dev disk2 diskutil partitiondisk dev disk2 1 jhfs installer 100 cd applications install\ macos\ sierra app sudo contents resources createinstallmedia volume volumes installer applicationpath applications install\ macos\ sierra app nointeraction erasing disk 0 10 20 30 100 copying installer files to disk copy complete making disk bootable copying boot files copy complete done to create a custom installable image which can be restored to a mac you will need to find the file installesd dmg which is also inside install macos sierra app with finder right click on the app select show package contents and navigate to contents sharedsupport to find the file installesd dmg you can verify the following cryptographic hashes to ensure you have the same copy with openssl sha1 installesd dmg or shasum a 1 installesd dmg or shasum a 256 installesd dmg in finder you can drag the file into a terminal window to provide the full path to determine which macos versions and builds originally shipped with or are available for your mac see ht204319 see installesd hashes csv in this repository for a list of current and previous file hashes you can also google the cryptographic hashes to ensure the file is genuine and has not been tampered with to create the image use magervalp autodmg or to create it manually mount and install the operating system to a temporary image hdiutil attach mountpoint tmp install esd installesd dmg hdiutil create size 32g type sparse fs hfs j volname macos uid 0 gid 80 mode 1775 tmp output sparseimage hdiutil attach mountpoint tmp os owners on tmp output sparseimage sudo installer pkg tmp install esd packages osinstall mpkg tgt tmp os verbose this part will take a while so be patient you can tail f var log install log in another terminal window to check progress optional install additional software for example wireshark hdiutil attach wireshark\ 2 2 0\ intel\ 64 dmg sudo installer pkg volumes wireshark wireshark\ 2 2 0\ intel\ 64 pkg tgt tmp os hdiutil unmount volumes wireshark see magervalp autodmg wiki packages suitable for deployment for caveats and chilcote outset to instead processes packages and scripts at first boot when youre done detach convert and verify the image hdiutil detach tmp os hdiutil detach tmp install esd hdiutil convert format udzo tmp output sparseimage o sierra dmg asr imagescan source sierra dmg now sierra dmg is ready to be applied to one or many macs one could futher customize the image to include premade users applications preferences etc this image can be installed using another mac in target disk mode or from a bootable usb installer to use target disk mode boot up the mac you wish to image while holding the t key and connect it to another mac using a firewire thunderbolt or usb c cable if you dont have another mac boot to a usb installer with sierra dmg and other required files copied to it by holding the option key at boot run diskutil list to identify the connected macs disk usually dev disk2 optional securely erase the disk with a single pass if previously filevault encrypted the disk must first be unlocked and mounted as dev disk3s2 sudo diskutil secureerase freespace 1 dev disk3s2 partition the disk to journaled hfs sudo diskutil unmountdisk dev disk2 sudo diskutil partitiondisk dev disk2 1 jhfs macos 100 restore the image to the new volume sudo asr restore source sierra dmg target volumes macos erase buffersize 4m you can also use the disk utility application to erase the connected macs disk then restore sierra dmg to the newly created partition if youve followed these steps correctly the target mac should now have a new install of macos sierra if you want to transfer any files copy them to a shared folder like users shared on the mounted disk image e g cp xcode 8 0 dmg volumes macos users shared finished restore install from usb recovery boot were not done yet unless you have built the image with autodmg or installed macos to a second partition on your mac you will need to create a recovery partition in order to use full disk encryption you can do so using magervalp create recovery partition installer or using the following manual steps download the file recoveryhdupdate dmg shell recoveryhdupdate dmg sha 256 f6a4f8ac25eaa6163aa33ac46d40f223f40e58ec0b6b9bf6ad96bdbfc771e12c sha 1 1ac3b7059ae0fcb2877d22375121d4e6920ae5ba attach and expand the installer then run it shell hdiutil attach recoveryhdupdate dmg pkgutil expand volumes mac\ os\ x\ lion\ recovery\ hd\ update recoveryhdupdate pkg tmp recovery hdiutil attach tmp recovery recoveryhdupdate pkg recoveryhdmeta dmg tmp recovery recoveryhdupdate pkg scripts tools dmtest ensurerecoverypartition volumes macos volumes recovery\ hd\ update basesystem dmg 0 0 volumes recovery\ hd\ update basesystem chunklist replace volumes macos with the path to the target disk mode booted mac as necessary this step will take several minutes run diskutil list again to make sure recovery hd now exists on dev disk2 or equivalent identifier once youre done eject the disk with hdiutil unmount volumes macos and power down the target disk mode booted mac virtualization to install macos as a virtual machine vm using vmware fusion follow the instructions above to create an image you will not need to download and create a recovery partition manually shell vmware fusion 10 1 0 7370838 dmg sha 256 5e968c5f88eb929740115374e0162779cbccd0383bc70e7bc52a0a680bf8fe2b sha 1 ef694e2bba7205253d5fde6e68e8ba78fad82952 for the installation method select install macos from the recovery partition customize any memory or cpu requirements and complete setup the guest vm should boot into recovery mode by default note if the virtual machine does not boot due to a kernel panic adjust the memory and process resource settings in recovery mode select a language then select utilities terminal from the menubar in the guest vm type ifconfig grep inet you should see a private address like 172 16 34 129 on the host mac type ifconfig grep inet you should see a private gateway address like 172 16 34 1 from the host mac you should be able to ping 172 16 34 129 or the equivalent guest vm address from the host mac serve the installable image to the guest vm by editing etc apache2 httpd conf and adding the following line to the top using the gateway address assigned to the host mac and port 80 listen 172 16 34 1 80 on the host mac link the image to the default apache web server directory sudo ln sierra dmg library webserver documents from the host mac start apache in the foreground sudo httpd x from the guest vm install the disk image to the volume over the local network using asr shell bash 3 2 asr restore source http 172 16 34 1 sierra dmg target volumes macintosh\ hd erase buffersize 4m validating target done validating source done erase contents of dev disk0s2 volumes macintosh hd ny y retrieving scan information done validating sizes done restoring 10 20 30 40 50 60 70 80 90 100 verifying 10 20 30 40 50 60 70 80 90 100 remounting target volume done when its finished stop the apache web server on the host mac by pressing control c at the sudo httpd x window and remove the image copy with sudo rm library webserver documents sierra dmg in the guest vm select startup disk from the menubar top left select the hard drive and restart you may wish to disable the network adapter in vmware to configure the guest vm initially take and restore from saved guest vm snapshots before and after attempting risky browsing for example or use a guest vm to install and operate questionable software first boot note before setting up macos consider disconnecting networking and configuring a firewall s first however late 2016 macbooks with touch bar hardware require online os activation also see next section on first boot hold command option p r keys to clear nvram when macos first starts youll be greeted by setup assistant when creating your account use a strong password without a hint if you enter your real name at the account setup process be aware that your computers name and local hostname will comprise that name e g john appleseeds macbook and thus will appear on local networks and in various preference files you can change them both in system preferences sharing or with the following commands sudo scutil set computername your computer name sudo scutil set localhostname your hostname system activation a few words on the privacy implications of activating touch bar macbook devices from your friendly anonymous security researcher apple increasingly seems despite vague claims to the contrary increasingly interested in merging or unifying the two oses and there are constantly rumors of fundamental changes to macos that make it far more like ios than the macos of old apples introduction of arm based coprocessors running ios sepos first with the t1 processor on the touchbar macbook pros run the touchbar implement nfc applepay add biometric login using sep and verify firmware integrity and the imac pros t2 implements verifies embedded device firmware implements secure boot etc seems to cement this concern and basically renders using macos devices without sending metadata to apple difficult to impossible ios devices have always required activation on first boot and when the battery has gone dead which initializes sepos to proceed with verified boot first boot activation not only initializes sepos as discussed below but sends metadata to apple and carriers via apple with cellular devices to activate the baseband and sim in activation processes after first boot just as with first boot a long list of highly sensitive metadata are sent hashed note hashing does not give you any privacy from apple here since they link this exact metadata to payment information at purchase to apple so it can return the personalized response required for secure boot to complete what is particularly worrying about this process is that it is a network linked secure boot process where centralized external servers have the power to dictate what the device should boot equally there are significant privacy concerns with devices constantly sending metadata both during activation and other apple linked hosted activities and linking ip addresses very strongly with real identities based on purchase payment information and if a cellular device metadata collected about sim etc unless such connections are blocked at the network level which is only possible on self managed infrastructure i e not cellular and doing this basically renders using the device impossible since simply installing an application requires sending device metadata to apple that the activation verification mechanism is designed specifically to rely on unique device identifiers that are associated with payment information at purchase and actively associated on a continuing basis by apple for every apple hosted service that the device interacts with apple id based services softwareupdate imessage facetime etc the ability and invitation for apple to silently send targeted malicious updates to devices matching specific unique id criteria is a valid concern and something that should not be dismissed as unlikely especially given apples full compliance with recently implemented chinese and other authoritarian and non authoritarian countries national security laws ios has from the start been designed with very little end user control with no way for end users to configure devices according to their wishes while maintaining security and relies heavily on new closed source code while macos has for most of its history been designed on the surface in a similar fashion power and enterprise users can for the moment still configure their devices relatively securely while maintaining basically zero network interaction with apple and with the installation of third party software kernel extensions completely control the network stack and intercept filesystem events on a per process basis macos despite having a good deal of closed source code was designed at a very different period in apples history and was designed more in line with open source standards and designed to be configurable and controllable by enterprise power users the introduction of these coprocessors to mac devices while increasing security in many ways brings with it all the issues with ios discussed above and means that running mac devices securely with complete user control and without forced network interaction with the apple mothership in highly sensitive corporate and other environments problematic and risky given this author is unaware of the exact hardware configuration of the coprocessors the following may be inaccurate however given the low level nature of these coprocessors it would not surprise the author if these coprocessors if not already will eventually have separate network access of their own independent of the intel cpu indications suggest not currently the case for t1 unclear on t2 which leads to concerns similar to those that many have raised around intel me amt and of course mac devices also have me in the intel cpu one could argue that these coprocessors increase security and in many ways that is the case but not the users security against a malicious apple the lack of configurability is the key issue apple could have introduced secure boot and firmware protection without making it require network access without making verification linked to device unique ids and without introducing an enormous amount of potentially exploitable code to protect against a much smaller but highly exploitable codebase while running on a coprocessor with a highly privileged position on the board which gives immense power to an adversary with manufacturer compliance for targeted attacks this is an ongoing concern and in the worst case scenario could potentially represent the end of macs as independent end user controllable and relatively secure systems appropriate for sensitive environments with strict network and security policies for more details see ios the future of macos freedom security and privacy in an increasingly hostile global environment admin and standard user accounts the first user account is always an admin account admin accounts are members of the admin group and have access to sudo which allows them to usurp other accounts in particular root and gives them effective control over the system any program that the admin executes can potentially obtain the same access making this a security risk utilities like sudo have weaknesses that can be exploited by concurrently running programs and many panes in system preferences are unlocked by default pdf p 61–62 for admin accounts it is considered a best practice by apple and others pdf p 41–42 to use a separate standard account for day to day work and use the admin account for installations and system configuration it is not strictly required to ever log into the admin account via the macos login screen the system will prompt for authentication when required and terminal can do the rest to that end apple provides some recommendations for hiding the admin account and its home directory this can be an elegant solution to avoid having a visible ghost account the admin account can also be removed from filevault caveats only administrators can install applications in applications local directory finder and installer will prompt a standard user with an authentication dialog many applications can be installed in applications instead the directory can be created manually as a rule of thumb applications that do not require admin access – or do not complain about not being installed in applications – should be installed in the user directory the rest in the local directory mac app store applications are still installed in applications and require no additional authentication sudo is not available in shells of the standard user which requires using su or login to enter a shell of the admin account this can make some maneuvers trickier and requires some basic experience with command line interfaces system preferences and several system utilities e g wi fi diagnostics will require root privileges for full functionality many panels in system preferences are locked and need to be unlocked separately by clicking on the lock icon some applications will simply prompt for authentication upon opening others must be opened by an admin account directly to get access to all functions e g console there are third party applications that will not work correctly because they assume that the user account is an admin these programs may have to be executed by logging into the admin account or by using the open utility setup accounts can be created and managed in system preferences on settled systems it is generally easier to create a second admin account and then demote the first account this avoids data migration newly installed systems can also just add a standard account demoting an account can be done either from the the new admin account in system preferences – the other account must be logged out – or by executing these commands it may not be necessary to execute both see issue 179 shell sudo dscl delete groups admin groupmembership username sudo dscl delete groups admin groupmembers generateduid you can find the “generateduid” of your account with shell dscl read users username generateduid see also this post for more information about how macos determines group membership full disk encryption filevault provides full disk technically full volume encryption on macos filevault encryption protects data at rest and hardens but not always prevents someone with physical access from stealing data or tampering with your mac with much of the cryptographic operations happening efficiently in hardware the performance penalty for filevault is not noticeable like all cryptosystems the security of filevault greatly depends on the quality of the pseudo random number generator prng the random device implements the yarrow pseudo random number generator algorithm and maintains its entropy pool additional entropy is fed to the generator regularly by the securityserver daemon from random jitter measurements of the kernel securityserver is also responsible for periodically saving some entropy to disk and reloading it during startup to provide entropy in early system operation see man 4 random for more information turning on filevault in system preferences after installing macos rather than creating an encrypted partition for the installation first is more secure because more prng entropy is available then additionally the prng can be manually seeded with entropy by writing to dev random before enabling filevault this can be done by simply using the mac for a little while before activating filevault to manually seed entropy before enabling filevault cat dev random type random letters for a long while then press control d enable filevault with sudo fdesetup enable or through system preferences security privacy and reboot if you can remember your password theres no reason to save the recovery key however your encrypted data will be lost forever if you cant remember the password or recovery key if you want to know more about how filevault works see the paper infiltrate the vault security analysis and decryption of lion full disk encryption pdf and related presentation pdf also see ieee std 1619 2007 “the xts aes tweakable block cipher” pdf you may wish to enforce hibernation and evict filevault keys from memory instead of traditional sleep to memory sudo pmset a destroyfvkeyonstandby 1 sudo pmset a hibernatemode 25 all computers have firmware of some type—efi bios—to help in the discovery of hardware components and ultimately to properly bootstrap the computer using the desired os instance in the case of apple hardware and the use of efi apple stores relevant information within efi to aid in the functionality of macos for example the filevault key is stored in efi to transparently come out of standby mode organizations especially sensitive to a high attack environment or potentially exposed to full device access when the device is in standby mode should mitigate this risk by destroying the filevault key in firmware doing so doesnt destroy the use of filevault but simply requires the user to enter the password in order for the system to come out of standby mode if you choose to evict filevault keys in standby mode you should also modify your standby and power nap settings otherwise your machine may wake while in standby mode and then power off due to the absence of the filevault key see issue 124 for more information these settings can be changed with sudo pmset a powernap 0 sudo pmset a standby 0 sudo pmset a standbydelay 0 sudo pmset a autopoweroff 0 for more information see best practices for deploying filevault 2 pdf and paper lest we remember cold boot attacks on encryption keys pdf firewall before connecting to the internet its a good idea to first configure a firewall there are several types of firewall available for macos application layer firewall built in basic firewall which blocks incoming connections only note this firewall does not have the ability to monitor nor block outgoing connections it can be controlled by the firewall tab of security privacy in system preferences or with the following commands enable the firewall sudo usr libexec applicationfirewall socketfilterfw setglobalstate on enable logging sudo usr libexec applicationfirewall socketfilterfw setloggingmode on you may also wish to enable stealth mode sudo usr libexec applicationfirewall socketfilterfw setstealthmode on computer hackers scan networks so they can attempt to identify computers to attack you can prevent your computer from responding to some of these scans by using stealth mode when stealth mode is enabled your computer does not respond to icmp ping requests and does not answer to connection attempts from a closed tcp or udp port this makes it more difficult for attackers to find your computer finally you may wish to prevent built in software as well as code signed downloaded software from being whitelisted automatically sudo usr libexec applicationfirewall socketfilterfw setallowsigned off sudo usr libexec applicationfirewall socketfilterfw setallowsignedapp off applications that are signed by a valid certificate authority are automatically added to the list of allowed apps rather than prompting the user to authorize them apps included in macos are signed by apple and are allowed to receive incoming connections when this setting is enabled for example since itunes is already signed by apple it is automatically allowed to receive incoming connections through the firewall if you run an unsigned app that is not listed in the firewall list a dialog appears with options to allow or deny connections for the app if you choose allow macos signs the application and automatically adds it to the firewall list if you choose deny macos adds it to the list but denies incoming connections intended for this app after interacting with socketfilterfw you may want to restart or terminate the process sudo pkill hup socketfilterfw third party firewalls programs such as little snitch hands off radio silence and security growler provide a good balance of usability and security example of little snitch monitored session shell littlesnitch 4 0 5 dmg sha 256 a954a269596c9a8e9efb3efadf843a6ae419fe218145c5b8d877e2acb0692981 sha 1 f642900c9c4f82a0fec38a0c826133e54cfbc0dc these programs are capable of monitoring and blocking incoming and outgoing network connections however they may require the use of a closed source kernel extension if the number of choices of allowing blocking network connections is overwhelming use silent mode with connections allowed then periodically check your settings to gain understanding of what various applications are doing it is worth noting that these firewalls can be bypassed by programs running as root or through os vulnerabilities pdf but they are still worth having just dont expect absolute protection however some malware actually deletes itself and doesnt execute if little snitch or other security software is installed for more on how little snitch works see the network kernel extensions programming guide and shut up snitch – reverse engineering and exploiting a critical little snitch vulnerability kernel level packet filtering a highly customizable powerful but also most complicated firewall exists in the kernel it can be controlled with pfctl and various configuration files pf can also be controlled with a gui application such as icefloor or murus there are many books and articles on the subject of pf firewall heres is just one example of blocking traffic by ip address add the following into a file called pf rules modifying en0 to be your outbound network adapter shell set block policy drop set fingerprints etc pf os set ruleset optimization basic set skip on lo0 scrub in all no df table blocklist persist block in log block in log quick from no route to any pass out proto tcp from any to any keep state pass out proto udp from any to any keep state pass out proto icmp from any to any keep state block log on en0 from blocklist to any block log on en0 from any to blocklist then use the following commands to manipulate the firewall sudo pfctl e f pf rules to enable the firewall sudo pfctl d to disable the firewall sudo pfctl t blocklist t add 1 2 3 4 to an ip address to the blocklist sudo pfctl t blocklist t show to view the blocklist sudo ifconfig pflog0 create to create an interface for logging sudo tcpdump ni pflog0 to view the filtered packets unless youre already familiar with packet filtering spending too much time configuring pf is not recommended it is also probably unnecessary if your mac is behind a nat on a secure home network it is possible to use the pf firewall to block network access to entire ranges of network addresses for example to a whole organization query merit radb for the list of networks in use by an autonomous system like facebook whois h whois radb net gas32934 copy and paste the list of networks returned into the blocklist command sudo pfctl t blocklist t add 31 13 24 0 21 31 13 64 0 24 157 240 0 0 16 confirm the addresses were added shell sudo pfctl t blocklist t show no altq support in kernel altq related functions disabled 31 13 24 0 21 31 13 64 0 24 157 240 0 0 16 confirm network traffic is blocked to those addresses note that dns requests will still work shell dig a short facebook com 157 240 2 35 curl connect timeout 5 i http facebook com trying 157 240 2 35 tcp nodelay set connection timed out after 5002 milliseconds closing connection 0 curl 28 connection timed out after 5002 milliseconds sudo tcpdump tqni pflog0 host 157 240 2 35 ip 192 168 1 1 62771 157 240 2 35 80 tcp 0 ip 192 168 1 1 62771 157 240 2 35 80 tcp 0 ip 192 168 1 1 62771 157 240 2 35 80 tcp 0 ip 192 168 1 1 62771 157 240 2 35 80 tcp 0 ip 192 168 1 1 162771 157 240 2 35 80 tcp 0 outgoing tcp syn packets are blocked so a tcp connection is not established and thus a web site is effectively blocked at the ip layer to use pf to audit phone home behavior of user and system level processes see fix macosx net monitor services before you connect to the internet you may wish to disable some system services which use up resources or phone home to apple see fix macosx yosemite phone home l1k osxparanoia and karek314 macos home call drop for further recommendations services on macos are managed by launchd see launchd info as well as apples daemons and services programming guide and technical note tn2083 you can also run knockknock that shows more information about startup items use launchctl list to view running user agents use sudo launchctl list to view running system daemons specify the service name to examine it e g launchctl list com apple maps mapspushd use defaults read to examine job plists in system library launchdaemons and system library launchagents use man strings and google to learn about what the agent daemon runs for example to learn what a system launch daemon or agent does start with defaults read system library launchdaemons com apple apsd plist look at the program or programarguments section to see which binary is run in this case apsd to find more information about that look at the man page with man apsd for example if youre not interested in apple push notifications disable the service sudo launchctl unload w system library launchdaemons com apple apsd plist note unloading services may break usability of some applications read the manual pages and use google to make sure you understand what youre doing first be careful about disabling any system daemons you dont understand as it may render your system unbootable if you break your mac use single user mode to fix it use console and activity monitor applications if you notice your mac heating up feeling sluggish or generally misbehaving as it may have resulted from your tinkering to view currently disabled services find var db com apple xpc launchd type f print exec defaults read \ 2 dev null annotated lists of launch daemons and agents the respective program executed and the programs hash sums are included in this repository optional run the read launch plists py script and diff output to check for any discrepancies on your system e g diff python read launch plists py cat 16a323 launchd csv see also cirrusj github io yosemite stop launch for descriptions of services and provisioning os x and disabling unnecessary services for another explanation spotlight suggestions disable spotlight suggestions in both the spotlight preferences and safaris search preferences to avoid your search queries being sent to apple also disable bing web searches in the spotlight preferences to avoid your search queries being sent to microsoft see fix macosx com for detailed instructions if youve upgraded to os x 10 10 yosemite and youre using the default settings each time you start typing in spotlight to open an application or search for a file on your computer your local search terms and location are sent to apple and third parties including microsoft note this web site and instructions may no longer work on macos sierra see issue 164 for comparison to windows 10 see https web archive org web 20180412124005 https fix10 isleaked com homebrew consider using homebrew to make software installations easier and to update userland tools see apples great gpl purge note if you have not already installed xcode or command line tools use xcode select install to download and install them from apple to install homebrew mkdir homebrew curl l https github com homebrew brew tarball master tar xz strip 1 c homebrew edit path in your shell or shell rc file to use homebrew bin and homebrew sbin for example echo path path homebrew sbin homebrew bin zshrc then change your login shell to z shell with chsh s bin zsh open a new terminal window and run brew update homebrew uses ssl tls to talk with github and verifies checksums of downloaded packages so its fairly secure remember to periodically run brew update and brew upgrade on trusted and secure networks to download and install software updates to get information on a package before installation run brew info package and check its recipe online according to homebrews anonymous aggregate user behaviour analytics homebrew gathers anonymous aggregate user behaviour analytics and reporting these to google analytics to opt out of homebrews analytics you can set export homebrew no analytics 1 in your environment or shell rc file or use brew analytics off you may also wish to enable additional security options such as homebrew no insecure redirect 1 and homebrew cask opts require sha dns hosts file use the hosts file to block known malware advertising or otherwise unwanted domains edit the hosts file as root for example with sudo vi etc hosts the hosts file can also be managed with the gui app 2ndalpha gasmask to block a domain append 0 example com or 0 0 0 0 example com or 127 0 0 1 example com to etc hosts note ipv6 uses the aaaa dns record type rather than a record type so you may also want to block those connections by also including 1 example com entries like shown here there are many lists of domains available online which you can paste in just make sure each line starts with 0 0 0 0 0 127 0 0 1 and the line 127 0 0 1 localhost is included for hosts lists see someonewhocares org l1k osxparanoia blob master hosts and stevenblack hosts to append a list of hosts from a list use the tee command then confirm by editing etc hosts or counting the number of lines in it shell curl https raw githubusercontent com stevenblack hosts master hosts sudo tee a etc hosts wc l etc hosts 47476 egrep ve 255 255 255 0 0 0 0 127 0 0 1 0 etc hosts sort uniq sort 1 localhost fe80 1 lo0 localhost should not return any other ip addresses see man hosts and freebsd configuration files for more information see the dnsmasq section of this guide for more hosts blocking options dnscrypt to encrypt outgoing dns traffic consider using dnscrypt in combination with dnsmasq and dnssec the security of both outbounding and inbounding dns traffic are strengthened a gui application is only available for the discontinued version 1 of dnscrypt proxy alterstep dnscrypt osxclient it is recommended to install the improved dnscrypt proxy version 2 and use a bitbar plugin like dnscrypt menu or dnscrypt proxy switcher until an updated gui application is available below are the guides for installation and configuration of the command line dnscrypt install dnscrypt from homebrew and follow the instructions to configure and start dnscrypt proxy shell brew install dnscrypt proxy if using in combination with dnsmasq find the file homebrew mxcl dnscrypt proxy plist by running shell brew info dnscrypt proxy which will show a location like usr local cellar dnscrypt proxy 2 0 8 and homebrew mxcl dnscrypt proxy plist is in this folder edit it to have the line shell string local address 127 0 0 1 5355 string below the line shell string usr local opt dnscrypt proxy sbin dnscrypt proxy string append a local address line to use dnscrypt on a port other than 53 like 5355 this can also be done using homebrew by installing gnu sed and using the gsed command shell sudo gsed i sbin\\ dnscrypt proxy \\ string a string local address 127 0 0 1 5355 \\ string \n find homebrew name homebrew mxcl dnscrypt proxy plist by default the resolvers list will point to the dnscrypt version specific resolvers file when dnscrypt is updated this version may no longer exist and if it does may point to an outdated file this can be fixed by changing the resolvers file in homebrew mxcl dnscrypt proxy plist found earlier using find to the symlinked version in usr local share shell string resolvers list usr local share dnscrypt proxy dnscrypt resolvers csv string below the line shell string usr local opt dnscrypt proxy sbin dnscrypt proxy string start dnscrypt shell sudo brew services restart dnscrypt proxy make sure dnscrypt is running shell sudo lsof pni udp 5355 command pid user fd type device size off node name dnscrypt 13415 nobody 6u ipv4 0x1773f85ff9f8bbef 0t0 udp 127 0 0 1 5355 ps a grep d nscrypt 13415 ss 13 57 21 usr local opt dnscrypt proxy sbin dnscrypt proxy local address 127 0 0 1 5355 ephemeral keys resolvers list usr local share dnscrypt proxy dnscrypt resolvers csv resolver name d0wn us ns4 user nobody by default dnscrypt proxy runs on localhost 127 0 0 1 port 53 and under the nobody user using the dnscrypt eu dk dnscrypt enabled resolver if you would like to change these settings you will have to edit the plist file e g resolver address provider name provider key etc this can be accomplished by editing homebrew mxcl dnscrypt proxy plist you can run your own dnscrypt server see also drduh debian privacy server guide dnscrypt from a trusted location or use one of many public servers instead confirm outgoing dns traffic is encrypted shell sudo tcpdump qtni en0 ip 10 8 8 8 59636 107 181 168 52 udp length 512 ip 107 181 168 52 10 8 8 8 59636 udp length 368 dig short x 128 180 155 106 49321 d0wn us ns4 dnscrypt proxy also has the capability to blacklist domains including the use of wildcards see the sample configuration file for dnscrypt proxy for the options note applications and programs may resolve dns using their own provided servers if dnscrypt proxy is used it is possible to disable all other non dnscrypt dns traffic with the following pf rules shell block drop quick on lo0 proto udp from any to any port 53 block drop quick on lo0 proto tcp from any to any port 53 see also what is a dns leak the mdnsresponder manual page and ipv6 test com dnsmasq among other features dnsmasq is able to cache replies prevent upstreaming queries for unqualified names and block entire tlds use in combination with dnscrypt to additionally encrypt outgoing dns traffic if you dont wish to use dnscrypt you should at least use dns not provided by your isp two popular alternatives are google dns and opendns optional dnssec is a set of extensions to dns which provide to dns clients resolvers origin authentication of dns data authenticated denial of existence and data integrity all answers from dnssec protected zones are digitally signed the signed records are authenticated via a chain of trust starting with a set of verified public keys for the dns root zone the current root zone trust anchors may be downloaded from iana website there are a number of resources on dnssec but probably the best one is dnssec net website install dnsmasq dnssec is optional shell brew install dnsmasq with dnssec cp usr local etc dnsmasq conf default usr local etc dnsmasq conf edit the configuration shell vim usr local etc dnsmasq conf examine all the options here are a few recommended settings to enable shell forward queries to dnscrypt on localhost port 5355 server 127 0 0 1 5355 uncomment to forward queries to google public dns if dnscrypt is not used you may also use your own dns server or other public dns server you trust server 8 8 8 8 server 8 8 4 4 never forward plain local names domain needed examples of blocking tlds or subdomains address onion 0 0 0 0 address local 0 0 0 0 address mycoolnetwork 0 0 0 0 address facebook com 0 0 0 0 address push apple com 0 0 0 0 never forward addresses in the non routed address spaces bogus priv reject private addresses from upstream nameservers stop dns rebind query servers in order strict order set the size of the cache the default is to keep 150 hostnames cache size 8192 optional logging directives log async log dhcp log facility var log dnsmasq log log all queries log queries path to list of additional hosts addn hosts etc blacklist enable dnssec see https www iana org dnssec files dnssec trust anchor 19036 8 2 49aac11d7b6f6446702e54a1607371607a1a41855200fd2ce1cdde32f24e8fb5 dnssec check unsigned install and start the program sudo is required to bind to privileged port 53 shell sudo brew services start dnsmasq to set dnsmasq as your local dns server open system preferences network and select the active interface then the dns tab select and add 127 0 0 1 or use shell sudo networksetup setdnsservers wi fi 127 0 0 1 make sure dnsmasq is correctly configured shell scutil dns dns configuration resolver 1 search domain 0 whatever nameserver 0 127 0 0 1 flags request a records request aaaa records reach reachable local address directly reachable address networksetup getdnsservers wi fi 127 0 0 1 note some vpn software overrides dns settings on connect see issue 24 for more information test dnssec validation test dnssec validation succeeds for signed zones dig dnssec icann org reply should have noerror status and contain ad flag for instance header opcode query status noerror id 47039 flags qr rd ra ad query 1 answer 2 authority 0 additional 1 test dnssec validation fails for zones that are signed improperly dig www dnssec failed org reply should have servfail status for instance header opcode query status servfail id 15190 flags qr rd ra query 1 answer 0 authority 0 additional 1 captive portal when macos connects to new networks it probes the network and launches a captive portal assistant utility if connectivity cant be determined an attacker could trigger the utility and direct a mac to a site with malware without user interaction so its best to disable this feature and log in to captive portals using your regular web browser provided you have first disable any custom dns and or proxy settings sudo defaults write library preferences systemconfiguration com apple captive control active bool false also see apples secret wispr request how to disable the captive portal window in mac os lion and an undocumented change to captive network assistant settings in os x 10 10 yosemite certificate authorities macos comes with over 200 root authority certificates installed from for profit corporations like apple verisign thawte digicert and government agencies from china japan netherlands u s and more these certificate authorities cas are capable of issuing ssl tls certificates for any domain code signing certificates etc for more information see certification authority trust tracker analysis of the https certificate ecosystem pdf and you wont be needing these any more on removing unused certificates from trust stores pdf you can inspect system root certificates in keychain access under the system roots tab or by using the security command line tool and system library keychains systemrootcertificates keychain file you can disable certificate authorities through keychain access by marking them as never trust and closing the window the risk of a man in the middle attack in which a coerced or compromised certificate authority trusted by your system issues a fake rogue ssl certificate is quite low but still possible openssl the version of openssl in sierra is 0 9 8zh which is not current it doesnt support tls 1 1 or newer elliptic curve ciphers and more apple declares openssl deprecated in their cryptographic services guide document their version also has patches which may surprise you if youre going to use openssl on your mac download and install a recent version of openssl with brew install openssl note linking brew to be used in favor of usr bin openssl may interfere with built in software see issue 39 compare the tls protocol and cipher between the homebrew version and the system version of openssl shell homebrew bin openssl version echo homebrew bin openssl s client connect github com 443 2 1 grep a2 ssl session openssl 1 0 2j 26 sep 2016 ssl session protocol tlsv1 2 cipher ecdhe rsa aes128 gcm sha256 usr bin openssl version echo usr bin openssl s client connect github com 443 2 1 grep a2 ssl session openssl 0 9 8zh 14 jan 2016 ssl session protocol tlsv1 cipher aes128 sha see also comparison of tls implementations hows my ssl qualys ssl labs tools and for detailed explanations and with latest vulnerabilities tests ssl checker online domain tools com curl the version of curl which comes with macos uses secure transport for ssl tls validation if you prefer to use openssl install with brew install curl with openssl and ensure its the default with brew link force curl here are several recommended options to add to curlrc see man curl for more shell user agent mozilla 5 0 windows nt 6 1 rv 45 0 gecko 20100101 firefox 45 0 referer auto connect timeout 10 progress bar max time 90 verbose show error remote time ipv4 web privoxy consider using privoxy as a local proxy to filter web browsing traffic note macos proxy settings are not universal apps and services may or may not honor system proxy settings ensure the app you wish to proxy is correctly configured and manually verify connections dont leak additionally it may be possible to configure the pf firewall to transparently proxy all traffic a signed installation package for privoxy can be downloaded from silvester org uk or sourceforge the signed package is more secure than the homebrew version and attracts full support from the privoxy project alternatively install and start privoxy using homebrew shell brew install privoxy brew services start privoxy by default privoxy listens on local tcp port 8118 set the system http proxy for your active network interface 127 0 0 1 and 8118 this can be done through system preferences network advanced proxies shell sudo networksetup setwebproxy wi fi 127 0 0 1 8118 optional set the system https proxy which still allows for domain name filtering with shell sudo networksetup setsecurewebproxy wi fi 127 0 0 1 8118 confirm the proxy is set shell scutil proxy dictionary exceptionslist array 0 local 1 169 254 16 ftppassive 1 httpenable 1 httpport 8118 httpproxy 127 0 0 1 visit http p p in a browser or with curl shell all proxy 127 0 0 1 8118 curl i http p p http 1 1 200 ok content length 2401 content type text html cache control no cache privoxy already comes with many good rules however you can also write your own edit homebrew etc privoxy user action to filter elements by domain or with regular expressions here are some examples shell block social networking www facebook com extern plugins login status like box activity fan php facebook com block unwanted images handle as image com ads 1x1 gif fb icon jpg gif png assets social cleardot gif img social ads co ads com redirect s http https google com wikipedia org code jquery com imgur com verify privoxy is blocking and redirecting shell all proxy 127 0 0 1 8118 curl ads foo com il http 1 1 403 request blocked by privoxy content type image gif content length 64 cache control no cache all proxy 127 0 0 1 8118 curl imgur com il http 1 1 302 local redirect from privoxy location https imgur com content length 0 date sun 09 oct 2016 18 48 19 gmt http 1 1 200 ok content type text html charset utf 8 you can replace ad images with pictures of kittens for example by starting the a local web server and redirecting blocked requests to localhost browser the web browser poses the largest security and privacy risk as its fundamental job is to download and execute untrusted code from the internet this is an important statement the unique use case of web browsers of operation in hostile environments has forced them to adopt certain impressive security features the cornerstone of web browser security is the same origin policy sop in a few words sop prevents a malicious script on one page from obtaining access to sensitive data on another web page through that pages document object model dom if sop is compromised the security of the whole web browser is compromised the best tip to ensure secure browsing regardless your choice of web browser is proper security hygiene the majority of web browser exploits require social engineering attacks to achieve native code execution always be mindful of the links you click and be extra careful when websites ask you to download and install software 99 percent of the time that software is malware another important consideration about web browser security is web extensions web extensions greatly increase the attack surface of the web browser this is an issue that plagues firefox and chrome alike luckily web extensions can only access specific browser apis that are being governed by their manifest that means we can quickly audit their behavior and remove them if they request access to information they shouldnt why would an ad blocker require camera access in the interest of security it is best to limit your use of web extensions google chrome firefox and safari are the web browsers that are being covered in this guide each web browser offers certain benefits and drawbacks regarding their security and privacy it is best to make an informed choice before committing to one google chrome google chrome is based on the open source chromium project with certain proprietary components the proprietary components are the following 1 automatic updates through the googlesoftwareupdatedaemon 1 usage tracking and crash reporting which can be disabled through chromes settings 1 chrome web store 1 non optional tracking google chrome installer includes a randomly generated token the token is sent to google after the installation completes in order to measure the success rate the rlz identifier stores information – in the form of encoded strings – like the source of chrome download and installation week it doesnt include any personal information and its used to measure the effectiveness of a promotional campaign chrome downloaded from googles website doesnt have the rlz identifier the source code to decode the strings is made open by google 1 adobe flash plugin google chrome supports a pepper api version of adobe flash which gets updated automatically with chrome 1 media codec support adds support for proprietary codecs 1 chromes pdf viewer chrome offers separate profiles sandboxing frequent updates including flash although you should disable it see below and carries impressive credentials in addition google offers a very lucrative bounty program for reporting vulnerabilities along with its own project zero this means that a large number of highly talented and motivated people are constantly auditing chromes code base chrome offers account sync between multiple devices part of the sync data are stored website logins the login passwords are encrypted and in order to access them a users google account password is required you can use your google account to sign to your chrome customized settings from other devices while retaining your the security of your passwords chromes web store for extensions requires a 5 dollar lifetime fee in order to submit extensions the low cost allows the development of many quality open source web extensions that do not aim to monetize through usage chrome has the largest share of global usage and is the preferred target platform for the majority of developers major technologies are based on chromes open source components such as node js which uses chromes v8 engine and the electron framework which is based on chromium and node js chromes vast user base makes it the most attractive target for threat actors and security researchers despite under constants attacks chrome has retained an impressive security track record over the years this is not a small feat to improve the privacy and security posture of the browser create at least three profiles one for browsing trusted web sites email banking another for mostly trusted web sites link aggregators news sites and a third for a completely cookie less and script less experience one profile without cookies or javascript enabled e g turned off in chrome settings content which should be the preferred profile to visiting untrusted web sites however many pages will not load at all without javascript enabled one profile with umatrix or ublock origin or both use this profile for visiting mostly trusted web sites take time to learn how these firewall extensions work other frequently recommended extensions are privacy badger httpseverywhere and certpatrol firefox only one or more profile s for secure and trusted browsing needs such as banking and email only the idea is to separate and compartmentalize data so that an exploit or privacy violation in one session does not necessarily affect data in another in each profile visit chrome settings content and enable block sites from running flash so flash applications do not run by default without explicit permission incognito mode in chrome disables extensions since extensions such as ad blockers have access to chromes network requests extensions have to be enabled manually moreover while in incognito mode chrome does not use session data from previous sessions incognito mode is another option if you want to access sensitive information without setting up separate profiles take some time to read through chromium security and chromium privacy for example you may wish to disable dns prefetching see also dns prefetching and its privacy implications pdf it is best to remember that google is an advertising company and its major source of revenue is adsense it makes sense that an advertising company would leverage its services to collect information and use that information to maximize its profit that means that while using google services certain personal information are being stored google is open about the data it stores and how it used them users can opt out from many of those services and see what type of information google has stored from their account settings firefox firefox is an excellent browser as well as being completely open source currently firefox is in a renaissance period it replaces major parts of its infrastructure and code base under projects quantum and photon part of the quantum project is to replace c code with rust rust is a systems programming language with a focus on security and thread safety it is expected that rust adoption will greatly improve the overall security posture of firefox firefox offers a similar security model to chrome it offers a bounty program although it is not a lucrative as chromes firefox follows a six week release cycle similar to chrome see discussion in issues 2 90 for more information about certain differences in firefox and chrome if using firefox see thecreeper privacyfox pyllyukko user js and ghacksuserjs ghacks user js for recommended privacy preferences and other hardening measures also be sure to check out noscript for mozilla based browsers which allows whitelist based pre emptive script blocking firefox is focussed on user privacy it supports tracking protection during private browsing by default the tracking protection can be enabled for the default account although it may break the browsing experience on some websites another feature for added privacy unique to firefox is containers containers lets you create profiles in firefox for different activities such as online shopping travel planning or checking work email containers store cookies separately you can log into the same site with a different account in each container and online trackers cant connect your browsing in one container to another previous versions of firefox used a web extension sdk that was quite invasive and offered immense freedom to developers sadly that freedom also introduced a number of vulnerabilities in firefox that greatly affected its users you can find more information about vulnerabilities introduced by firefoxs legacy extensions in this paper currently firefox only supports web extensions through the web extension api which is very similar to chromes submission of web extensions in firefox is free web extensions in firefox most of the time are open source although certain web extensions are proprietary note similar to chrome and safari firefox allows account sync across multiple devices while stored login passwords are encrypted firefox does not require a password to reveal their plain text format firefox only displays as yes no prompt this is an important security issue keep that in mind if you sign in to your firefox account from devices that do not belong to you and leave them unattended the issue has been raised among the firefox community and hopefully will be resolved in the coming versions safari safari is the default web browser of macos it is also the most optimized browser for reducing battery use safari like chrome has both open source and proprietary components safari is based on the open source web engine webkit which is ubiquitous among the macos ecosystem webkit is used by apple apps such as mail itunes ibooks and the app store chromes blink engine is a fork of webkit and both engines share a number of similarities safari supports certain unique features that benefit user security and privacy content blockers enables the creation of content blocking rules without using javascript this rule based approach greatly improves memory user security and privacy safari 11 introduced an intelligent tracking prevention system this feature automatically removes tracking data stored in safari after a period of non interaction by the user from the trackers website similar to chrome and firefox safari offers an invite only bounty program for bug reporting to a select number of security researchers the bounty program was announced during apples presentation at blackhat 2016 web extensions in safari have an additional option to use native code in the safaris sandbox environment in addition to web extension apis web extensions in safari are also distributed through apples app store app store submission comes with the added benefit of web extension code being audited by apple on the other hand app store submission comes at a steep cost yearly developer subscription fee costs 100 in contrast to chromes 5 lifetime fee and firefoxs free submission the high cost is prohibitive for the majority of open source developers as a result safari has very few extensions to choose from however you should keep the high cost in mind when installing extensions it is expected that most web extensions will have some way of monetizing usage in order to cover developer costs and be extra careful when the web extensions source code is not open source on a side note some safari extensions are open source and freely available be grateful to those developers safari syncs users preferences and stored logins through the icloud keychain stored passwords are encrypted with 256 bit aes in order to be viewed in plain text a user must input the account password of the current device this means that users can sync data across devices with added security safari follows a slower release cycle than chrome and firefox 3 4 minor releases 1 major release per year newer features are slower to be adopted to the stable channel although security updates in safari are handled independent of the stable release schedule and issued automatically through the app store the safari channel that follows a six week release cycle similar to as chrome and firefox is called safari technology preview and it is the recommended option instead of the stable channel of safari an excellent open source ad blocker for safari that fully leverages content blockers is ka block ka block is focussed on user privacy the only time the extension makes a network connection is when a new version of the extension is released you can view the extensions repository here other web browsers many chromium derived browsers are not recommended they are usually closed source poorly maintained have bugs and make dubious claims to protect privacy see the private life of chromium browsers other miscellaneous browsers such as brave are not evaluated in this guide so are neither recommended nor actively discouraged from use web browsers and privacy all web browsers retain certain information about our browsing habits that information is used for a number of reasons one of them is to improve the overall performance of the web browser most web browsers offer prediction services to resolve typos or url redirections store analytics data of browsing patterns crash reports and black listing of known malicious servers those options can be turned on and off from each web browsers settings panel since web browsers execute untrusted code from the server it is important to understand what type of information can be accessed the navigator interface gives access to information about the web browsers user agent those include information such as the operating system websites permissions and the devices battery level for more information about security conscious browsing and what type of information is being leaked by your browser see howto privacy security conscious browsing browserleaks com and eff panopticlick to hinder third party trackers it is recommended to disable third party cookies from your web browser settings a third party cookie is a cookie associated with a file requested by a different domain than the one the user is currently viewing most of the time third party cookies are used to create browsing profiles by tracking a users movement on the web disabling third party cookies prevents http responses and scripts from other domains from setting cookies moreover cookies are removed from requests to domains that are not the document origin domain so cookies are only sent to the current site that is being viewed also be aware of webrtc which may reveal your local or public if connected to vpn ip address es in firefox and chrome chromium this can be disabled with extensions such as ublock origin and rentamob webrtc leak prevent disabling webrtc in safari is only possible with a system hack plugins adobe flash oracle java adobe reader microsoft silverlight netflix now works with html5 and other plugins are security risks and should not be installed if they are necessary only use them in a disposable virtual machine and subscribe to security announcements to make sure youre always patched see hacking team flash zero day java trojan backdoor flashback acrobat reader security vulnerabilities and angling for silverlight exploits for example pgp gpg pgp is a standard for encrypting email end to end that means only the chosen recipients can decrypt a message unlike regular email which is read and forever archived by providers gpg or gnu privacy guard is a gpl licensed program compliant with the standard gpg is used to verify signatures of software you download and install as well as symmetrically or asymmetrically encrypt files and text install from homebrew with brew install gnupg if you prefer a graphical application download and install gpg suite here are several recommended options to add to gnupg gpg conf shell auto key locate keyserver keyserver hkps hkps pool sks keyservers net keyserver options no honor keyserver url personal cipher preferences aes256 aes192 aes cast5 personal digest preferences sha512 sha384 sha256 sha224 default preference list sha512 sha384 sha256 sha224 aes256 aes192 aes cast5 zlib bzip2 zip uncompressed cert digest algo sha512 s2k digest algo sha512 s2k cipher algo aes256 charset utf 8 fixed list mode no comments no emit version keyid format 0xlong list options show uid validity verify options show uid validity with fingerprint these settings will configure gnupg to use ssl when fetching new keys and prefer strong cryptographic primitives see also ioerror duraconf configs gnupg gpg conf you should also take some time to read openpgp best practices if you dont already have a keypair create one using gpg gen key also see drduh yubikey guide read online guides and practice encrypting and decrypting email to yourself and your friends get them interested in this stuff otr otr stands for off the record and is a cryptographic protocol for encrypting and authenticating conversations over instant messaging you can use otr on top of any existing xmpp chat service even google hangouts which only encrypts conversations between users and the server using tls the first time you start a conversation with someone new youll be asked to verify their public key fingerprint make sure to do this in person or by some other secure means e g gpg encrypted mail a popular macos gui client for xmpp and other chat protocols is adium shell adium 1 5 10 4 dmg sha 256 31fa3fd32b86dd3381b60e0d5aafbc2a9452036f0fb4963bffbc2a6c64a9458b sha 1 8a674a642447839ea287aed528194e4fd32763b8 remember to disable logging for off the record chats with adium a good console based xmpp client is profanity which can be installed with brew install profanity for improved anonymity check out tor messenger although it is still in beta as well as ricochet which has recently received a thorough security audit pdf which both use the tor network rather than relying on messaging servers if you want to know how otr works read the paper off the record communication or why not to use pgp pdf tor tor is an anonymizing proxy which can be used for browsing the web download tor browser from the offical tor project web site do not attempt to configure other browsers or applications to use tor as you will likely make a mistake which will compromise your anonymity download both the dmg and asc signature files then verify the disk image has been signed by tor developers shell cd downloads file tor torbrowser 7 0 10 osx64 en us dmg bzip2 compressed data block size 900k torbrowser 7 0 10 osx64 en us dmg asc pgp signature signature old gpg tor asc gpg assuming signed data in torbrowser 7 0 10 osx64 en us dmg gpg signature made thu nov 9 08 58 11 2017 pst gpg using rsa key 0xd1483fa6c3c07136 gpg cant check signature no public key gpg recv 0x4e2c6e8793298290 gpg key 0x4e2c6e8793298290 public key tor browser developers signing key torbrowser torproject org imported gpg no ultimately trusted keys found gpg total number processed 1 gpg imported 1 gpg verify tor asc gpg assuming signed data in torbrowser 7 0 10 osx64 en us dmg gpg signature made thu nov 9 08 58 11 2017 pst gpg using rsa key 0xd1483fa6c3c07136 gpg good signature from tor browser developers signing key torbrowser torproject org unknown gpg warning this key is not certified with a trusted signature gpg there is no indication that the signature belongs to the owner primary key fingerprint ef6e 286d da85 ea2a 4ba7 de68 4e2c 6e87 9329 8290 subkey fingerprint a430 0a6b c93c 0877 a445 1486 d148 3fa6 c3c0 7136 make sure good signature from tor browser developers signing key torbrowser torproject org appears in the output the warning about the key not being certified is benign as it has not yet been manually assigned trust see how to verify signatures for packages for more information to finish installing tor browser open the disk image and drag the it into the applications folder or with shell hdiutil mount torbrowser 7 0 10 osx64 en us dmg cp rv volumes tor\ browser torbrowser app applications verify the tor applications code signature was made by with the tor projects apple developer id madpsayn6t using the spctl a v and or pkgutil check signature commands shell spctl a vv applications torbrowser app applications torbrowser app accepted source developer id origin developer id application the tor project inc madpsayn6t pkgutil check signature applications torbrowser app package torbrowser app status signed by a certificate trusted by mac os x certificate chain 1 developer id application the tor project inc madpsayn6t sha1 fingerprint 95 80 54 f1 54 66 f3 9c c2 d8 27 7a 29 21 d9 61 11 93 b3 e8 2 developer id certification authority sha1 fingerprint 3b 16 6c 3b 7d c4 b7 51 c9 fe 2a fa b9 13 56 41 e3 88 e1 86 3 apple root ca sha1 fingerprint 61 1e 5b 66 2c 59 3a 08 ff 58 d1 4a e2 24 52 d1 98 df 6c 60 you may also use the codesign command to examine an applications code signature shell codesign dvv applications torbrowser app executable applications torbrowser app contents macos firefox identifier org torproject torbrowser format app bundle with mach o thin x86 64 codedirectory v 20200 size 249 flags 0x0 none hashes 5 3 location embedded library validation warning os x sdk version before 10 9 does not support library validation signature size 4247 authority developer id application the tor project inc madpsayn6t authority developer id certification authority authority apple root ca signed time nov 9 2017 12 47 58 am info plist entries 22 teamidentifier madpsayn6t sealed resources version 2 rules 12 files 130 internal requirements count 1 size 188 to view full certificate details extract them with codesign and decode it with openssl shell codesign d extract certificates applications torbrowser app executable applications torbrowser app contents macos firefox file codesign codesign0 data codesign1 data codesign2 data openssl x509 inform der in codesign0 subject issuer startdate enddate noout subject uid madpsayn6t cn developer id application the tor project inc madpsayn6t ou madpsayn6t o the tor project inc c us issuer cn developer id certification authority ou apple certification authority o apple inc c us notbefore apr 12 22 40 13 2016 gmt notafter apr 13 22 40 13 2021 gmt openssl x509 inform der in codesign0 fingerprint noout sha1 fingerprint 95 80 54 f1 54 66 f3 9c c2 d8 27 7a 29 21 d9 61 11 93 b3 e8 openssl x509 inform der in codesign0 fingerprint sha256 noout sha256 fingerprint b5 0d 47 f0 3e cb 42 b6 68 1c 6f 38 06 2b c2 9f 41 fa d6 54 f1 29 d3 e4 dd 9c c7 49 35 ff f5 d9 tor traffic is encrypted to the exit node i e cannot be read by a passive network eavesdropper but tor use can be identified for example tls handshake hostnames will show up in plaintext shell sudo tcpdump an tcp grep www listening on pktap link type pktap apple dlt pktap capture size 262144 bytes www odezz26nvv7jeqz1xghzs com www bxbko3qi7vacgwyk4ggulh com 6 m z w x 6 c 0 0 0 f 0 h 0 1 0 u www b6zazzahl3h3faf4x2 com0 160402000000z 170317000000z01 0 u www tm3ddrghe22wgqna5u8g net0 0 see tor protocol specification and tor tlshistory for more information you may wish to additionally obfuscate tor traffic using a pluggable transport such as yawning obfs4proxy or sri csl stegotorus this can be done by setting up your own tor relay or finding an existing private or public bridge to serve as an obfuscating entry node for extra security use tor inside a virtualbox or vmware virtualized gnu linux or bsd machine finally remember the tor network provides anonymity which is not necessarily synonymous with privacy the tor network does not guarantee protection against a global observer capable of traffic analysis and correlation see also seeking anonymity in an internet panopticon pdf and traffic correlation on tor by realistic adversaries pdf also see invisible internet project i2p and its tor comparison vpn if you use your mac on untrusted networks airports cafes etc your network traffic is being monitored and possibly tampered with it is a good idea to use a vpn which encrypts all outgoing network traffic i e not split tunnel with a provider you trust for an example of how to set up and host your own vpn see drduh debian privacy server guide dont just blindly sign up for a vpn service without understanding the full implications and how your traffic will be routed if you dont understand how the vpn works or are not familiar with the software used you are probably better off without it when choosing a vpn service or setting up your own be sure to research the protocols key exchange algorithms authentication mechanisms and type of encryption being used some protocols such as pptp should be avoided in favor of openvpn for example some clients may send traffic over the next available interface when vpn is interrupted or disconnected see scy 8122924 for an example on how to allow traffic only over vpn another set of scripts to lock down your system so it will only access the internet via a vpn can be found as part of the voodoo privacy project sarfata voodooprivacy and there is an updated guide to setting up an ipsec vpn on a virtual machine hwdsl2 setup ipsec vpn or a docker container hwdsl2 docker ipsec vpn server viruses and malware there is an ever increasing amount of mac malware in the wild macs arent immune from viruses and malicious software some malware comes bundled with both legitimate software such as the java bundling ask toolbar and some with illegitimate software such as mac backdoor iworm bundled with pirated programs malwarebytes anti malware for mac is an excellent program for ridding oneself of garden variety malware and other crapware see methods of malware persistence on mac os x pdf and malware persistence on os x yosemite to learn about how garden variety malware functions you could periodically run a tool like knock knock to examine persistent applications e g scripts binaries but by then it is probably too late maybe applications such as block block and ostiarius will help see warnings and caveats in issue 90 first however anti virus programs are a double edged sword not useful for advanced users and will likely increase attack surface against sophisticated threats however possibly useful for catching garden variety malware on novice users macs there is also the additional processing overhead to consider see sophail applied attacks against antivirus pdf analysis and exploitation of an eset vulnerability a trivial avast rce popular security software came under relentless nsa and gchq attacks how israel caught russian hackers scouring the world for u s secrets and avg web tuneup extension multiple critical vulnerabilities therefore the best anti virus is common sense 2018 see more discussion in issue 44 cylanceprotect may be worth running for the exploit mitigation features and when locked down is much harder to locally bypass than traditional av but its effectiveness at detecting malware on macos is questionable its core feature is an algorithm derived from a machine learning process which aims to identify malware based on various characteristics of a binary executable cylance have a whitepaper with information about how it works single licenses are available from third party resellers such as cyberforce or malware managed and there is also a home personal edition in the works but it is currently only available for companies to make available to their employees on macos it complements apples built in xprotect by continuously vmmaping the memory of active processes to watch for patterns that indicate bad things happening local privilege escalation bugs are plenty on macos so always be careful when downloading and running untrusted programs or trusted programs from third party websites or downloaded over http example have a look at the safe mac for past and malwarebytes blog for current mac security news also check out hacking team malware for mac os root installation for macos support driver for mac agent and rcs agent for mac which is a good example of advanced malware with capabilities to hide from userland e g ps ls for example for more see a brief analysis of an rcs implant installer and reverse put as system integrity protection system integrity protection sip is a security feature since os x 10 11 el capitan it is enabled by default but can be disabled which may be necessary to change some system settings such as deleting root certificate authorities or unloading certain launch daemons keep this feature on as it is by default from whats new in os x 10 11 a new security policy that applies to every running process including privileged code and code that runs out of the sandbox the policy extends additional protections to components on disk and at run time only allowing system binaries to be modified by the system installer and software updates code injection and runtime attachments to system binaries are no longer permitted also see what is the “rootless” feature in el capitan really some macbook hardware has shipped with sip disabled to verify sip is enabled use the command csrutil status which should return system integrity protection status enabled otherwise enable sip through recovery mode gatekeeper and xprotect gatekeeper and the quarantine system try to prevent unsigned or bad programs and files from running and opening xprotect prevents the execution of known bad files and outdated plugin versions but does nothing to cleanup or stop existing malware both offer trivial protection against common risks and are fine at default settings see also mac malware guide how does mac os x protect me and gatekeeper xprotect and the quarantine attribute note quarantine stores information about downloaded files in library preferences com apple launchservices quarantineeventsv2 which may pose a privacy risk to examine the file simply use strings or the following command echo select datetime lsquarantinetimestamp 978307200 unixepoch as lsquarantinetimestamp lsquarantineagentname lsquarantineoriginurlstring lsquarantinedataurlstring from lsquarantineevent sqlite3 users user library preferences com apple launchservices quarantineeventsv2 see here for more information to permanently disable this feature clear the file and make it immutable shell library preferences com apple launchservices quarantineeventsv2 sudo chflags schg library preferences com apple launchservices quarantineeventsv2 metadata and artifacts macos attaches metadata hfs extended attributes to downloaded files which can be viewed with the mdls and xattr commands shell ls l downloads torbrowser 6 0 8 osx64 en us dmg rw r r 1 drduh staff 59322237 dec 1 12 00 torbrowser 6 0 8 osx64 en us dmg com apple metadata kmditemwherefroms 186 com apple quarantine 68 mdls downloads torbrowser 6 0 8 osx64 en us dmg kmditemowneruserid 501 kmditemcontentcreationdate 2016 12 01 12 00 00 0000 kmditemcontentmodificationdate 2016 12 01 12 00 00 0000 kmditemcontenttype com apple disk image udif kmditemcontenttypetree public archive public item public data public disk image com apple disk image com apple disk image udif kmditemdateadded 2016 12 01 12 00 00 0000 kmditemdisplayname torbrowser 6 0 8 osx64 en us dmg kmditemfscontentchangedate 2016 12 01 12 00 00 0000 kmditemfscreationdate 2016 12 01 12 00 00 0000 kmditemfscreatorcode kmditemfsfinderflags 0 kmditemfshascustomicon null kmditemfsinvisible 0 kmditemfsisextensionhidden 0 kmditemfsisstationery null kmditemfslabel 0 kmditemfsname torbrowser 6 0 8 osx64 en us dmg kmditemfsnodecount null kmditemfsownergroupid 5000 kmditemfsowneruserid 501 kmditemfssize 60273898 kmditemfstypecode kmditemkind disk image kmditemlogicalsize 60273898 kmditemphysicalsize 60276736 kmditemwherefroms https dist torproject org torbrowser 6 0 8 torbrowser 6 0 8 osx64 en us dmg https www torproject org projects torbrowser html en xattr l torbrowser 6 0 8 osx64 en us dmg com apple metadata kmditemwherefroms 00000000 62 70 6c 69 73 74 30 30 a2 01 02 5f 10 4d 68 74 bplist00 mht 00000010 74 70 73 3a 2f 2f 64 69 73 74 2e 74 6f 72 70 72 tps dist torpr 00000020 6f 6a 65 63 74 2e 6f 72 67 2f 74 6f 72 62 72 6f oject org torbro 00000030 77 73 65 72 2f 36 2e 30 2e 38 2f 54 6f 72 42 72 wser 6 0 8 torbr 00000040 6f 77 73 65 72 2d 36 2e 30 2e 38 2d 6f 73 78 36 owser 6 0 8 osx6 00000050 34 5f 65 6e 2d 55 53 2e 64 6d 67 5f 10 36 68 74 4 en us dmg 6ht 00000060 74 70 73 3a 2f 2f 77 77 77 2e 74 6f 72 70 72 6f tps www torpro 00000070 6a 65 63 74 2e 6f 72 67 2f 70 72 6f 6a 65 63 74 ject org project 00000080 73 2f 74 6f 72 62 72 6f 77 73 65 72 2e 68 74 6d s torbrowser htm 00000090 6c 2e 65 6e 08 0b 5b 00 00 00 00 00 00 01 01 00 l en 000000a0 00 00 00 00 00 00 03 00 00 00 00 00 00 00 00 00 000000b0 00 00 00 00 00 00 94 000000b7 com apple quarantine 0081 58519ffa google chrome app 1f032cab f5a1 4d92 84eb cbeca971b7bc metadata attributes can also be removed with the d flag shell xattr d com apple metadata kmditemwherefroms downloads torbrowser 6 0 5 osx64 en us dmg xattr d com apple quarantine downloads torbrowser 6 0 5 osx64 en us dmg xattr l downloads torbrowser 6 0 5 osx64 en us dmg no output after removal other metadata and artifacts may be found in the directories including but not limited to library preferences library containers app data library preferences library preferences some of which is detailed below library preferences com apple sidebarlists plist contains historical list of volumes attached to clear it use the command usr libexec plistbuddy c delete systemitems volumeslist library preferences com apple sidebarlists plist library preferences com apple bluetooth plist contains bluetooth metadata including device history if bluetooth is not used the metadata can be cleared with shell sudo defaults delete library preferences com apple bluetooth plist devicecache sudo defaults delete library preferences com apple bluetooth plist idspaireddevices sudo defaults delete library preferences com apple bluetooth plist pandevices sudo defaults delete library preferences com apple bluetooth plist paninterfaces sudo defaults delete library preferences com apple bluetooth plist scoaudiodevices var spool cups contains the cups printer job cache to clear it use the commands shell sudo rm rfv var spool cups c0 sudo rm rfv var spool cups tmp sudo rm rfv var spool cups cache job cache to clear the list of ios devices connected use shell sudo defaults delete users user library preferences com apple ipod plist conn 128 last connect sudo defaults delete users user library preferences com apple ipod plist devices sudo defaults delete library preferences com apple ipod plist conn 128 last connect sudo defaults delete library preferences com apple ipod plist devices sudo rm rfv var db lockdown quicklook thumbnail data can be cleared using the qlmanage r cache command but this writes to the file resetreason in the quicklook directories and states that the quicklook cache was manually cleared it can also be manually cleared by getting the directory names with getconf darwin user cache dir and sudo getconf darwin user cache dir then removing them shell rm rfv getconf darwin user cache dir com apple quicklook thumbnailcache exclusive rm rfv getconf darwin user cache dir com apple quicklook thumbnailcache index sqlite rm rfv getconf darwin user cache dir com apple quicklook thumbnailcache index sqlite shm rm rfv getconf darwin user cache dir com apple quicklook thumbnailcache index sqlite wal rm rfv getconf darwin user cache dir com apple quicklook thumbnailcache resetreason rm rfv getconf darwin user cache dir com apple quicklook thumbnailcache thumbnails data similarly for the root user shell sudo rm rfv getconf darwin user cache dir com apple quicklook thumbnailcache thumbnails fraghandler sudo rm rfv getconf darwin user cache dir com apple quicklook thumbnailcache exclusive sudo rm rfv getconf darwin user cache dir com apple quicklook thumbnailcache index sqlite sudo rm rfv getconf darwin user cache dir com apple quicklook thumbnailcache index sqlite shm sudo rm rfv getconf darwin user cache dir com apple quicklook thumbnailcache index sqlite wal sudo rm rfv getconf darwin user cache dir com apple quicklook thumbnailcache resetreason sudo rm rfv getconf darwin user cache dir com apple quicklook thumbnailcache thumbnails data sudo rm rfv getconf darwin user cache dir com apple quicklook thumbnailcache thumbnails fraghandler also see quicklook cache may leak encrypted data to clear finder preferences shell defaults delete library preferences com apple finder plist fxdesktopvolumepositions defaults delete library preferences com apple finder plist fxrecentfolders defaults delete library preferences com apple finder plist recentmoveandcopydestinations defaults delete library preferences com apple finder plist recentsearches defaults delete library preferences com apple finder plist sgtrecentfilesearches additional diagnostic files may be found in the following directories but caution should be taken before removing any as it may break logging or cause other issues shell var db coreduet var db diagnostics var db systemstats var db uuidtext var log diagnosticmessages macos stored preferred wi fi data including credentials in nvram to clear it use the following commands shell sudo nvram d 36c28ab5 6566 4c50 9ebd cbb920f83843 current network sudo nvram d 36c28ab5 6566 4c50 9ebd cbb920f83843 preferred networks sudo nvram d 36c28ab5 6566 4c50 9ebd cbb920f83843 preferred count macos may collect sensitive information about what you type even if user dictionary and suggestions are off to remove them and prevent them from being created again use the following commands shell rm rfv library languagemodeling library spelling library suggestions chmod r 000 library languagemodeling library spelling library suggestions chflags r uchg library languagemodeling library spelling library suggestions quicklook application support metadata can be cleared and locked with the following commands shell rm rfv library application support quick look chmod r 000 library application support quick look chflags r uchg library application support quick look document revision metadata is stored in documentrevisions v100 and can be cleared and locked with the following commands caution should be taken as this may break some core apple applications shell sudo rm rfv documentrevisions v100 sudo chmod r 000 documentrevisions v100 sudo chflags r uchg documentrevisions v100 saved application state metadata may be cleared and locked with the following commands shell rm rfv library saved application state rm rfv library containers appname saved application state chmod r 000 library saved application state chmod r 000 library containers appname saved application state chflags r uchg library saved application state chflags r uchg library containers appname saved application state autosave metadata can be cleared and locked with the following commands shell rm rfv library containers app data library autosave information rm rfv library autosave information chmod r 000 library containers app data library autosave information chmod r 000 library autosave information chflags r uchg library containers app data library autosave information chflags r uchg library autosave information the siri analytics database which is created even if the siri launch agent disabled can be cleared and locked with the following commands shell rm rfv library assistant sirianalytics db chmod r 000 library assistant sirianalytics db chflags r uchg library assistant sirianalytics db library preferences com apple itunes plist contains itunes metadata recent itunes search data may be cleared with the following command shell defaults delete library preferences com apple itunes plist recentsearches if you do not use apple id linked services the following keys may be cleared too using the following commands shell defaults delete library preferences com apple itunes plist storeuserinfo defaults delete library preferences com apple itunes plist wirelessbuddyid all media played in quicktime player can be found in shell library containers com apple quicktimeplayerx data library preferences com apple quicktimeplayerx plist additional metadata may exist in the following files shell library containers com apple appstore data library preferences com apple commerce knownclients plist library preferences com apple commerce plist library preferences com apple quicktimeplayerx plist passwords you can generate strong passwords with openssl shell openssl rand base64 30 lk9xkjueaemc1gv2ux5xqku pdmmmcbstmwfimri or gpg shell gpg gen random a 0 30 4 bgzl yuee8foqqhf5v01hpgwfspupwfcu3aowq or dev urandom output shell dd if dev urandom bs 1 count 30 2 dev null base64 cbrgkasfi4eta96nmrgyamj8dlzdfybaqtwusxke with control over character sets shell lang c tr dc a za z0 9 dev urandom fold w 40 head n 1 jm0ikn7ngqst8i0mmmcbbi6skpcouwwcb5lwejxk lang c tr dc drduh0 9 dev urandom fold w 40 head n 1 686672u2dh7r754209ud312hhh23ud7u41h3875d you can also generate passwords even memorable ones using keychain access password assistant or a command line equivalent like anders pwgen keychains are encrypted with a pbkdf2 derived key and are a pretty safe place to store credentials see also breaking into the os x keychain also be aware that keychain does not encrypt the names corresponding to password entries alternatively you can manage an encrypted passwords file yourself with gnupg see drduh purse and drduh pwd sh for example in addition to passwords ensure eligible online accounts such as github google accounts banking have two factor authentication enabled look to yubikey for a two factor and private key e g ssh gpg hardware token see drduh yubikey guide and trmm net yubikey one of two yubikeys slots can also be programmed to emit a long static password which can be used in combination with a short memorized password for example in addition to login and other pam modules you can use yubikey to secure your login and sudo here is a pdf guide from yubico yubikey are a bit pricey there is cheaper alternative but not as capable u2f zero here is a great guide to set it up backup always encrypt files locally before backing them up to external media or online services one way is to use a symmetric cipher with gpg and a password of your choosing to encrypt a directory shell tar zcvf downloads gpg c desktop backup date f h m tar gz gpg to decrypt an archive shell gpg o desktop decrypted backup tar gz d desktop backup 2015 01 01 0000 tar gz gpg \ tar zxvf desktop decrypted backup tar gz you may also create encrypted volumes using disk utility or hdiutil shell hdiutil create desktop encrypted dmg encryption size 1g volname name fs jhfs also see the following applications and services spideroak arq espionage and restic wi fi macos remembers access points it has connected to like all wireless devices the mac will broadcast all access point names it remembers e g myhomenetwork each time it looks for a network such as when waking from sleep this is a privacy risk so remove networks from the list in system preferences network advanced when theyre no longer needed also see signals from the crowd uncovering social relationships through smartphone probes pdf and wi fi told me everything about you pdf saved wi fi information ssid last connection etc can be found in library preferences systemconfiguration com apple airport preferences plist you may wish to spoof the mac address of your network card before connecting to new and untrusted wireless networks to mitigate passive fingerprinting shell sudo ifconfig en0 ether openssl rand hex 6 sed s \ \ \1 g s it is also good to know that macos will store your wi fi ssid and passwords in nvram because recovery mode needs access to restore from the internet when you need to pass your mac along be sure to either clear nvram or de authenticate your mac from your apple account which will clear the nvram resetting the smc will clear some of the nvram but not all note mac addresses will reset to hardware defaults on each boot also see feross spoofmac finally wep protection on wireless networks is not secure and you should favor connecting to wpa2 protected networks only to mitigate the risk of passive eavesdroppers ssh for outgoing ssh connections use hardware or password protected keys set up remote hosts and consider hashing them for added privacy here are several recommended options to add to ssh config shell host passwordauthentication no challengeresponseauthentication no hashknownhosts yes note macos sierra permanently remembers ssh key passphrases by default append the option usekeychain no to turn this feature off you can also use ssh to create an encrypted tunnel to send your traffic through which is similar to a vpn for example to use privoxy on a remote host shell ssh c l 5555 127 0 0 1 8118 you remote host tld sudo networksetup setwebproxy wi fi 127 0 0 1 5555 sudo networksetup setsecurewebproxy wi fi 127 0 0 1 5555 or to use an ssh connection as a socks proxy shell ssh ncd 3000 you remote host tld by default macos does not have sshd or remote login enabled to enable sshd and allow incoming ssh connections shell sudo launchctl load w system library launchdaemons ssh plist or use the system preferences sharing menu if you are going to enable sshd at least disable password authentication and consider further hardening your configuration to etc sshd config add shell passwordauthentication no challengeresponseauthentication no usepam no confirm whether sshd is enabled or disabled shell sudo lsof pni tcp 22 physical access keep your mac physically secure at all times dont leave it unattended in hotels and such a skilled attacker with unsupervised physical access to your computer can infect the boot rom to install a keylogger and steal your password see thunderstrike for example a helpful tool is usbkill which is an anti forensic kill switch that waits for a change on your usb ports and then immediately shuts down your computer consider purchasing a privacy filter for your screen to thwart shoulder surfers system monitoring openbsm audit macos has a powerful openbsm auditing capability you can use it to monitor process execution network activity and much more to tail audit logs use the praudit utility shell sudo praudit l dev auditpipe header 201 11 execve 2 0 thu sep 1 12 00 00 2015 195 msec exec arg applications evilapp rootkit path applications evilapp rootkit path applications evilapp rootkit attribute 100755 root wheel 16777220 986535 0 subject drduh root wheel root wheel 412 100005 50511731 0 0 0 0 return success 0 trailer 201 header 88 11 connect 2 0 thu sep 1 12 00 00 2015 238 msec argument 1 0x5 fd socket inet 2 443 173 194 74 104 subject drduh root wheel root wheel 326 100005 50331650 0 0 0 0 return failure operation now in progress 4354967105 trailer 88 header 111 11 openssh login 0 thu sep 1 12 00 00 2015 16 msec subject ex drduh drduh staff drduh staff 404 404 49271 1 text successful login drduh return success 0 trailer 111 see the manual pages for audit praudit audit control and other files in etc security note although man audit says the s flag will synchronize the audit configuration it appears necessary to reboot for changes to take effect see articles on ilostmynotes blogspot com and derflounder wordpress com for more information dtrace iosnoop monitors disk i o opensnoop monitors file opens execsnoop monitors execution of processes errinfo monitors failed system calls dtruss monitors all system calls see man k dtrace for more information note system integrity protection interferes with dtrace so it may no longer be possible to use these tools execution ps ef lists information about all running processes you can also view processes with activity monitor launchctl list and sudo launchctl list list loaded and running user and system launch daemons and agents network list open network files sudo lsof pni list contents of various network related data structures sudo netstat atln you can also use wireshark from the command line monitor dns queries and replies shell tshark y dns flags response 1 tfields \ e frame time delta \ e dns qry name \ e dns a \ eseparator monitor http requests and responses shell tshark y http request or http response tfields \ e ip dst \ e http request full uri \ e http request method \ e http response code \ e http response phrase \ eseparator s monitor x509 certificates shell tshark y ssl handshake certificate tfields \ e ip src \ e x509sat utf8string \ e x509sat printablestring \ e x509sat universalstring \ e x509sat ia5string \ e x509sat teletexstring \ eseparator s equote d also see the simple networking monitoring application bonzaithepenguin loading binary whitelisting google santa is a security software developed for googles corporate macintosh fleet and open sourced santa is a binary whitelisting blacklisting system for macos it consists of a kernel extension that monitors for executions a userland daemon that makes execution decisions based on the contents of a sqlite database a gui agent that notifies the user in case of a block decision and a command line utility for managing the system and synchronizing the database with a server santa uses the kernel authorization api to monitor and allow disallow binaries from executing in the kernel binaries can be white or black listed by unique hash or signing developer certificate santa can be used to only allow trusted code execution or to blacklist known malware from executing on a mac similar to bit9 software for windows note santa does not currently have a graphical user interface for managing rules the following instructions are for advanced users only to install santa visit the releases page and download the latest disk image the mount it and install the contained package shell hdiutil mount downloads santa 0 9 20 dmg sudo installer pkg volumes santa 0 9 20 santa 0 9 20 pkg tgt by default santa installs in monitor mode meaning nothing gets blocked only logged and comes with two rules one for apple binaries and another for santa software itself verify santa is running and its kernel module is loaded shell santactl status daemon info mode monitor file logging no watchdog cpu events 0 peak 0 00 watchdog ram events 0 peak 0 00mb kernel info kernel cache count 0 database info binary rules 0 certificate rules 2 events pending upload 0 ps ef grep s anta 0 786 1 0 10 01am 0 00 39 library extensions santa driver kext contents macos santad syslog kextstat grep santa 119 0 0xffffff7f822ff000 0x6000 0x6000 com google santa driver 0 9 14 693d8e4d 3161 30e0 b83d 66a273cae026 5 4 3 1 create a blacklist rule to prevent itunes from executing sudo santactl rule blacklist path applications itunes app added rule for sha 256 e1365b51d2cb2c8562e7f1de36bfb3d5248de586f40b23a2ed641af2072225b3 try to launch itunes it will be blocked open applications itunes app lsopenurlswithrole failed with error 10810 for the file applications itunes app to remove the rule sudo santactl rule remove path applications itunes app removed rule for sha 256 e1365b51d2cb2c8562e7f1de36bfb3d5248de586f40b23a2ed641af2072225b3 open itunes open applications itunes app itunes will open successfully create a new example c program shell cat foo c include main printf hello world\n” eof compile the program with gcc requires installation of xcode or command line tools shell gcc o foo foo c file foo foo mach o 64 bit executable x86 64 codesign d foo foo code object is not signed at all run it shell foo hello world toggle santa into “lockdown” mode which only allows whitelisted binaries to run sudo defaults write var db santa config plist clientmode int 2 try to run the unsigned binary shell foo bash foo operation not permitted santa the following application has been blocked from executing because its trustworthiness cannot be determined path users demouser foo identifier 4e11da26feb48231d6e90b10c169b0f8ae1080f36c168ffe53b1616f7505baed parent bash 701 to whitelist a specific binary determine its sha 256 sum shell santactl fileinfo users demouser foo path users demouser foo sha 256 4e11da26feb48231d6e90b10c169b0f8ae1080f36c168ffe53b1616f7505baed sha 1 4506f3a8c0a5abe4cacb98e6267549a4d8734d82 type executable x86 64 code signed no rule blacklisted unknown add a whitelist rule shell sudo santactl rule whitelist sha256 4e11da26feb48231d6e90b10c169b0f8ae1080f36c168ffe53b1616f7505baed added rule for sha 256 4e11da26feb48231d6e90b10c169b0f8ae1080f36c168ffe53b1616f7505baed run it shell foo hello world its allowed and works applications can also be whitelisted by developer certificate so that new binary versions will not need to be manually whitelisted on each update for example download and run google chrome it will be blocked by santa in lockdown mode shell curl so https dl google com chrome mac stable ggro googlechrome dmg hdiutil mount googlechrome dmg cp r volumes google\ chrome google\ chrome app applications open applications google\ chrome app lsopenurlswithrole failed with error 10810 for the file applications google chrome app whitelist the application by its developer certificate first item in the signing chain shell santactl fileinfo applications google\ chrome app path applications google chrome app contents macos google chrome sha 256 0eb08224d427fb1d87d2276d911bbb6c4326ec9f74448a4d9a3cfce0c3413810 sha 1 9213cbc7dfaaf7580f3936a915faa56d40479f6a bundle name google chrome bundle version 2883 87 bundle version str 55 0 2883 87 type executable x86 64 code signed yes rule blacklisted unknown signing chain 1 sha 256 15b8ce88e10f04c88a5542234fbdfc1487e9c2f64058a05027c7c34fc4201153 sha 1 85cee8254216185620ddc8851c7a9fc4dfe120ef common name developer id application google inc organization google inc organizational unit eqhxz8m8av valid from 2012 04 26 07 10 10 0700 valid until 2017 04 27 07 10 10 0700 2 sha 256 7afc9d01a62f03a2de9637936d4afe68090d2de18d03f29c88cfb0b1ba63587f sha 1 3b166c3b7dc4b751c9fe2afab9135641e388e186 common name developer id certification authority organization apple inc organizational unit apple certification authority valid from 2012 02 01 14 12 15 0800 valid until 2027 02 01 14 12 15 0800 3 sha 256 b0b1730ecbc7ff4505142c49f1295e6eda6bcaed7e2c68c5be91b5a11001f024 sha 1 611e5b662c593a08ff58d14ae22452d198df6c60 common name apple root ca organization apple inc organizational unit apple certification authority valid from 2006 04 25 14 40 36 0700 valid until 2035 02 09 13 40 36 0800 in this case 15b8ce88e10f04c88a5542234fbdfc1487e9c2f64058a05027c7c34fc4201153 is the sha 256 of googles apple developer certificate team id eqhxz8m8av to whitelist it shell sudo santactl rule whitelist certificate sha256 15b8ce88e10f04c88a5542234fbdfc1487e9c2f64058a05027c7c34fc4201153 added rule for sha 256 15b8ce88e10f04c88a5542234fbdfc1487e9c2f64058a05027c7c34fc4201153 google chrome should now launch and subsequent updates to the application will continue to work as long as the code signing certificate doesnt change or expire to disable “lockdown” mode sudo defaults delete var db santa config plist clientmode see var log santa log to monitor allow and deny execution decisions a log and configuration server for santa is available in zentral an open source event monitoring solution and tls server for osquery and santa zentral will support santa in both monitoring and lockdown operation mode clients need to be enrolled with a tls connection to sync santa rules all santa events from endpoints are aggregated and logged back in zentral santa events can trigger actions and notifications from within the zentral framework note python bash and other interpreters are whitelisted since they are signed by apples developer certificate so santa will not be able to block such scripts from executing thus a potential non binary program which disables santa is a weakness not vulnerability since it is so by design to take note of miscellaneous if you wish disable diagnostics usage data if you want to play music or watch videos use vlc media player which is free and open source if you want to use torrents use transmission which is free and open source note like all software even open source projects malware may still find its way in you may also wish to use a block list to avoid peering with known bad hosts see which is the best blocklist for transmission and johntyree 3331662 manage default file handlers with duti which can be installed with brew install duti one reason to manage extensions is to prevent auto mounting of remote filesystems in finder see protecting yourself from sparklegate here are several recommended handlers to manage shellshell duti s com apple safari afp duti s com apple safari ftp duti s com apple safari nfs duti s com apple safari smb monitor system logs with the console application or syslog w or log stream commands in systems prior to macos sierra 10 12 enable the tty tickets flag in etc sudoers to restrict the sudo session to the terminal window tab that started it to do so use sudo visudo and add the line defaults tty tickets set your screen to lock as soon as the screensaver starts shell defaults write com apple screensaver askforpassword int 1 defaults write com apple screensaver askforpassworddelay int 0 expose hidden files and library folder in finder shell defaults write com apple finder appleshowallfiles bool true chflags nohidden library show all filename extensions so that evil jpg app cannot masquerade easily shell defaults write nsglobaldomain appleshowallextensions bool true dont default to saving documents to icloud shell defaults write nsglobaldomain nsdocumentsavenewdocumentstocloud bool false enable secure keyboard entry in terminal unless you use yubikey or applications such as textexpander disable crash reporter the dialog which appears after an application crashes and prompts to report the problem to apple shell defaults write com apple crashreporter dialogtype none disable bonjour multicast advertisements shell sudo defaults write library preferences com apple mdnsresponder plist nomulticastadvertisements bool yes disable handoff and bluetooth features if they arent necessary consider sandboxing your applications see fg sandbox guide pdf and s7ephen osx sandbox seatbelt profiles did you know apple has not shipped a computer with tpm since 2006 macos comes with this line in etc sudoers shell defaults env keep home mail which stops sudo from changing the home variable when you elevate privileges this means it will execute as root the bash dotfiles in the non root users home directory when you run sudo bash it is adviseable to comment this line out to avoid a potentially easy way for malware or a local attacker to escalate privileges to root if you want to retain the convenience of the root user having a non root users home directory you can append an export line to var root bashrc eg shell export home users blah related software stronghold securely and easily configure your mac from the terminal inspired by this guide santa a binary whitelisting blacklisting system for macos kristovatlas osx config check checks your osx machine against various hardened configuration settings lockdown audits and remediates security configuration settings dylib hijack scanner scan for applications that are either susceptible to dylib hijacking or have been hijacked f secure xfence formerly little flocker little snitch for files prevents applications from accessing files facebook osquery can be used to retrieve low level system information users can write sql queries to retrieve system information google grr incident response framework focused on remote live forensics yelp osxcollector forensic evidence collection analysis toolkit for os x jipegit osxauditor analyzes artifacts on a running system such as quarantined files safari chrome and firefox history downloads html5 databases and localstore social media and email accounts and wi fi access point names libyal libfvde library to access filevault drive encryption fvde or filevault2 encrypted volumes cisofy lynis cross platform security auditing tool and assists with compliance testing and system hardening zentral a log and configuration server for santa and osquery run audit and probes on inventory events logfiles combine with point in time alerting a full framework and django web server build on top of the elastic stack formerly known as elk stack additional resources in no particular order macos hardening guide appendix of os internals volume iii security insecurity internals pdf mac developer library secure coding guide os x core technologies overview white paper pdf reverse engineering mac os x blog reverse engineering resources patrick wardles objective see blog managing macs at google scale lisa 13 os x hardening securing a large global mac fleet lisa 13 dod security technical implementation guides for mac os the efi boot process the intel mac boot process userland persistence on mac os x developing mac osx kernel rootkits iokit kernel code execution exploit hidden backdoor api to root privileges in apple os x ipv6 hardening guide for os x harden the world mac osx 10 11 el capitan hacker news discussion hacker news discussion 2 apple open source os x 10 10 yosemite the ars technica review cis apple osx 10 10 benchmark pdf how to switch to the mac security configuration for mac os x version 10 6 snow leopard pdf eff surveillance self defense guide macadmins on slack icloud security and privacy overview demystifying the dmg file format theres a lot of vulnerable os x applications out there sparkle framework rce iseeyou disabling the macbook webcam indicator led mac os x forensics technical report pdf mac forensics mac os x and the hfs file system pdf extracting filevault 2 keys with volatility auditing and exploiting apple ipc mac os x and ios internals to the apples core by jonathan levin demystifying the i device nvme nand new storage used by apple the macos phishing easy button applescript dangers over the air vol 2 pt 1 exploiting the wi fi stack on apple devices the great dom fuzz off of 2017 remote code execution git and os x osx pirrit mac adware part iii the davinci code how to make macos spotlight fuck the fuck off and do your bidding