istanbul a js code coverage tool written in js deprecation notice this version of istanbul is deprecated we will not be landing pull requests or releasing new versions but dont worry the istanbul 2 0 api is now available and is being actively developed in the new istanbuljs organization new v0 4 0 now has beautiful html reports props to tom macwright tmcw for a fantastic job features and use cases getting started and configuration usage on windows the command line ignoring code for coverage api changelog license and credits features all javascript instrumentation library that tracks statement branch and function coverage module loader hooks to instrument code on the fly command line tools to run node unit tests with coverage turned on and no cooperation whatsoever from the test runner multiple report formats html lcov cobertura and more ability to use as middleware when serving js files that need to be tested on the browser can be used on the command line as well as a library based on the awesome esprima parser and the equally awesome escodegen code generator well tested on node prev current and next versions and the browser instrumentation library only use cases supports the following use cases and more transparent coverage of nodejs unit tests instrumentation reporting of files in batch mode for browser tests server side code coverage for nodejs by embedding it as custom middleware getting started npm install g istanbul the best way to see it in action is to run node unit tests say you have a test script test js that runs all tests for your node project without coverage simply cd path to your source root istanbul cover test js and this should produce a coverage json lcov info and lcov report html under coverage sample of code coverage reports produced by this tool for this tool html reports usage on windows istanbul assumes that the command passed to it is a js file e g jasmine vows etc this is however not true on windows where npm wrap bin files in a cmd file since istanbul can not parse cmd files you need to reference the bin file manually here is an example using jasmine 2 istanbul cover node modules\jasmine\bin\jasmine js in order to use this cross platform e i linux mac and windows you can insert the above line into the script object in your package json file but with normal slash scripts test istanbul cover node modules jasmine bin jasmine js configuring drop a istanbul yml file at the top of the source tree to configure istanbul istanbul help config tells you more about the config file format the command line istanbul help gives you detailed help on all commands usage istanbul help config config provides help with istanbul configuration available commands are check coverage checks overall per file coverage against thresholds from coverage json files exits 1 if thresholds are not met 0 otherwise cover transparently adds coverage information to a node command saves coverage json and reports at the end of execution help shows help instrument instruments a file or a directory tree and writes the instrumented code to the desired output location report writes reports for coverage json objects produced in a previous run test cover a node command only when npm config coverage is set use in an npm test script for conditional coverage command names can be abbreviated as long as the abbreviation is unambiguous to get detailed help for a command and what command line options it supports run istanbul help command most of the command line options are not covered in this document the cover command istanbul cover my test script js my test args note the between the command name and the arguments to be passed the cover command can be used to get a coverage object and reports for any arbitrary node script by default coverage information is written under coverage this can be changed using command line options the cover command can also be passed an optional handle sigint flag to enable writing reports when a user triggers a manual sigint of the process that is being covered this can be useful when you are generating coverage for a long lived process the test command the test command has almost the same behavior as the cover command except that it skips coverage unless the npm config coverage environment variable is set this command is deprecated since the latest versions of npm do not seem to set the npm config coverage variable the instrument command instruments a single js file or an entire directory tree and produces an output directory tree with instrumented code this should not be required for running node unit tests but is useful for tests to be run on the browser the report command writes reports using coverage json files as the source of coverage information reports are available in multiple formats and can be individually configured using the istanbul config file see istanbul help report for more details the check coverage command checks the coverage of statements functions branches and lines against the provided thresholds positive thresholds are taken to be the minimum percentage required and negative numbers are taken to be the number of uncovered entities allowed ignoring code for coverage skip an if or else path with istanbul ignore if or istanbul ignore else respectively for all other cases skip the next thing in the source with istanbul ignore next see ignoring code for coverage md for the spec api all the features of istanbul can be accessed as a library instrument code javascript var istanbul require istanbul var instrumenter new istanbul instrumenter var generatedcode instrumenter instrumentsync function meaningoflife return 42 filename js generate reports given a bunch of coverage json objects javascript var istanbul require istanbul collector new istanbul collector reporter new istanbul reporter sync false collector add obj1 collector add obj2 etc reporter add text reporter addall lcov clover reporter write collector sync function console log all reports generated for the gory details consult the public api multiple process usage istanbul can be used in a multiple process environment by running each process with istanbul writing a unique coverage file for each process and combining the results when generating reports the method used to perform this will depend on the process forking api used for example when using the cluster module you must setup the master to start child processes with istanbul coverage disable reporting and output coverage files that include the pid in the filename before each run you may need to clear out the coverage data directory javascript if cluster ismaster setup cluster if running with istanbul coverage if process env running under istanbul use coverage for forked process disabled reporting and output for child process enable pid in child process coverage filename cluster setupmaster exec node modules bin istanbul args cover report none print none include pid process argv 1 concat process argv slice 2 cluster fork else worker code coverage json for details on the format of the coverage json object see here license istanbul is licensed under the bsd license third party libraries the following third party libraries are used by this module abbrev https github com isaacs abbrev js to handle command abbreviations async https github com caolan async for parallel instrumentation of files escodegen https github com constellation escodegen for js code generation esprima https github com ariya esprima for js parsing glob https github com isaacs node glob for loading and matching path expressions handlebars https github com wycats handlebars js for report template expansion js yaml https github com nodeca js yaml for yaml config file load mkdirp https github com substack node mkdirp to create output directories nodeunit https github com caolan nodeunit dev dependency for unit tests nopt https github com isaacs nopt for option parsing once https github com isaacs once to ensure callbacks are called once resolve https github com substack node resolve for resolving a post require hook module name into its main file rimraf https github com isaacs rimraf dev dependency for unit tests which https github com isaacs node which to resolve a node command to a file for the cover command wordwrap https github com substack node wordwrap for prettier help prettify http code google com p google code prettify for syntax colored html reports files checked in under lib vendor inspired by yui test coverage https github com yui yuitest the grand daddy of js coverage tools istanbul has been specifically designed to offer an alternative to this library with an easy migration path cover https github com itay node cover the inspiration for the cover command modeled after the run command in that tool the coverage methodology used by istanbul is quite different however shout out to mfncooper for great brainstorming discussions reid davglass the yui dudes for interesting conversations encouragement support and gentle pressure to get it done why the funky name since all the good ones are taken comes from the loose association of ideas across coverage carpet area coverage the country that makes good carpets and so on