what the f ck javascript a list of funny and tricky javascript examples javascript is a great language it has a simple syntax large ecosystem and what is most important a great community at the same time we all know that javascript is quite a funny language with tricky parts some of them can quickly turn our everyday job into hell and some of them can make us laugh out loud the original idea for wtfjs belongs to brian leroux this list is highly inspired by his talk “wtfjs” at dotjs 2012 node packaged manuscript you can install this handbook using npm just run npm install g wtfjs you should be able to run wtfjs at the command line now this will open the manual in your selected pager otherwise you may continue reading on here the source is available here https github com denysdovhan wtfjs start doctoc generated toc please keep comment here to allow auto update dont edit this section instead re run doctoc to update table of contents 💪🏻 motivation ✍🏻 notation 👀 examples is equal true is false banana nan is not a nan its a fail is truthy but not true null is falsy but not false document all is an object but it is undefined minimal value is greater than zero function is not a function adding arrays trailing commas in array array equality is a monster undefined and number parseint is a bad guy math with true and false html comments are valid in javascript nan is not a number and null are objects magically increasing numbers precision of 0 1 0 2 patching numbers comparison of three numbers funny math addition of regexps strings arent instances of string calling functions with backticks call call call a constructor property object as a key of objects property accessing prototypes with proto object destructuring with default values dots and spreading labels nested labels insidious try catch is this multiple inheritance a generator which yields itself a class of class non coercible objects tricky arrow functions arrow functions can not be a constructor arguments and arrow functions tricky return accessing object properties with arrays math max less than math min null and relational operators number tofixed display different numbers comparing null to 0 same variable redeclaration other resources 🎓 license end doctoc generated toc please keep comment here to allow auto update 💪🏻 motivation just for fun — “just for fun the story of an accidental revolutionary” linus torvalds the primary goal of this list is to collect some crazy examples and explain how they work if possible just because its fun to learn something that we didnt know before if you are a beginner you can use these notes to get a deeper dive into javascript i hope these notes will motivate you to spend more time reading the specification if you are a professional developer you can consider these examples as a great reference for all of the quirks and unexpected edges of our beloved javascript in any case just read this youre probably going to find something new ✍🏻 notation is used to show the result of an expression for example js 1 1 2 means the result of console log or another output for example js console log hello world hello world is just a comment used for explanations example js assigning a function to foo constant const foo function 👀 examples is equal array is equal not array js true 💡 explanation the abstract equality operator converts both sides to numbers to compare them and both sides become the number 0 for different reasons arrays are truthy so on the right the opposite of a truthy value is false which is then coerced to 0 on the left however an empty array is coerced to a number without becoming a boolean first and empty arrays are coerced to 0 despite being truthy here is how this expression simplifies js 0 false 0 0 true see also is truthy but not true 12 5 9 logical not operator 7 2 13 abstract equality comparison true is false js false true true false true true 💡 explanation consider this step by step js true is truthy and represented by value 1 number true in string form is nan true true false false false false false is not the empty string so its a truthy value false true true true 7 2 13 abstract equality comparison banana js b a a a this is an old school joke in javascript but remastered heres the original one js foo bar foonan 💡 explanation the expression is evaluated as foo bar which converts bar to not a number 12 8 3 the addition operator 12 5 6 unary operator nan is not a nan js nan nan false 💡 explanation the specification strictly defines the logic behind this behavior if type x is different from type y return false if type x is number then if x is nan return false if y is nan return false … … … — 7 2 14 strict equality comparison following the definition of nan from the ieee four mutually exclusive relations are possible less than equal greater than and unordered the last case arises when at least one operand is nan every nan shall compare unordered with everything including itself — “what is the rationale for all comparisons returning false for ieee754 nan values ” at stackoverflow its a fail you would not believe but … js fail 💡 explanation by breaking that mass of symbols into pieces we notice that the following pattern occurs often js false false so we try adding to false but due to a number of internal function calls binary operator toprimitive defaultvalue we end up converting the right operand to a string js tostring false thinking of a string as an array we can access its first character via 0 js false 0 f the rest is obvious but the i is tricky the i in fail is grabbed by generating the string falseundefined and grabbing the element on index 10 is truthy but not true an array is a truthy value however its not equal to true js true true false 💡 explanation here are links to the corresponding sections in the ecma 262 specification 12 5 9 logical not operator 7 2 13 abstract equality comparison null is falsy but not false despite the fact that null is a falsy value its not equal to false js null false null false false at the same time other falsy values like 0 or are equal tofalse js 0 false true false true 💡 explanation the explanation is the same as for previous example heres the corresponding link 7 2 13 abstract equality comparison document all is an object but it is undefined ⚠️ this is part of the browser api and wont work in a node js environment ⚠️ despite the fact that document all is an array like object and it gives access to the dom nodes in the page it responds to the typeof function as undefined js document all instanceof object true typeof document all undefined at the same time document all is not equal to undefined js document all undefined false document all null false but at the same time js document all null true 💡 explanation document all used to be a way to access dom elements in particular with old versions of ie while it has never been a standard it was broadly used in the old age js code when the standard progressed with new apis such as document getelementbyid this api call became obsolete and the standard commitee had to decide what to do with it because of its broad use they decided to keep the api but introduce a willful violation of the javascript specification the reason why it responds to false when using the strict equality comparison with undefined while true when using the abstract equality comparison is due to the willful violation of the specification that explicitly allows that — “obsolete features document all” at whatwg html spec — “chapter 4 toboolean falsy values” at ydkjs types grammar minimal value is greater than zero number min value is the smallest number which is greater than zero js number min value 0 true 💡 explanation number min value is 5e 324 i e the smallest positive number that can be represented within float precision i e thats as close as you can get to zero it defines the best resolution that floats can give you now the overall smallest value is number negative infinity although its not really numeric in a strict sense — “why is 0 less than number min value in javascript ” at stackoverflow 20 1 2 9 number min value function is not a function ⚠️ a bug present in v8 v5 5 or lower node js 7 ⚠️ all of you know about the annoying undefined is not a function but what about this js declare a class which extends null class foo extends null function foo new foo instanceof null typeerror function is not a function at … … … 💡 explanation this is not a part of the specification its just a bug that has now been fixed so there shouldnt be a problem with it in the future adding arrays what if you try to add two arrays js 1 2 3 4 5 6 1 2 34 5 6 💡 explanation the concatenation happens step by step it looks like this js 1 2 3 4 5 6 call tostring 1 2 3 tostring 4 5 6 tostring concatenation 1 2 3 4 5 6 1 2 34 5 6 trailing commas in array youve created an array with 4 empty elements despite all youll get an array with three elements because of trailing commas js let a a length 3 a tostring 💡 explanation trailing commas sometimes called final commas can be useful when adding new elements parameters or properties to javascript code if you want to add a new property you can simply add a new line without modifying the previously last line if that line already uses a trailing comma this makes version control diffs cleaner and editing code might be less troublesome — trailing commas at mdn array equality is a monster array equality is a monster in js as you can see below js true 0 true true 0 0 true 0 false 0 true null true null 0 true undefined true undefined 0 true 0 true true true 0 true null 0 true null true undefined 0 true undefined true 💡 explanation you should watch very carefully for the above examples the behaviour is described in section 7 2 13 abstract equality comparison of the specification undefined and number if we dont pass any arguments into the number constructor well get 0 the value undefined is assigned to formal arguments when there are no actual arguments so you might expect that number without arguments takes undefined as a value of its parameter however when we pass undefined we will get nan js number 0 number undefined nan 💡 explanation according to the specification if no arguments were passed to this functions invocation let n be 0 else let n be tonumber value in case of undefined tonumber undefined should return nan heres the corresponding section 20 1 1 the number constructor 7 1 3 tonumber argument parseint is a bad guy parseint is famous by its quirks js parseint f ck nan parseint f ck 16 15 💡 explanation this happens because parseint will continue parsing character by character until it hits a character it doesnt know the f in f ck is the hexadecimal digit 15 parsing infinity to integer is something… js parseint infinity 10 nan parseint infinity 18 nan parseint infinity 19 18 parseint infinity 23 18 parseint infinity 24 151176378 parseint infinity 29 385849803 parseint infinity 30 13693557269 parseint infinity 34 28872273981 parseint infinity 35 1201203301724 parseint infinity 36 1461559270678 parseint infinity 37 nan be careful with parsing null too js parseint null 24 23 💡 explanation its converting null to the string null and trying to convert it for radixes 0 through 23 there are no numerals it can convert so it returns nan at 24 n the 14th letter is added to the numeral system at 31 u the 21st letter is added and the entire string can be decoded at 37 on there is no longer any valid numeral set that can be generated and nan is returned — “parseint null 24 23… wait what ” at stackoverflow dont forget about octals js parseint 06 6 parseint 08 8 if support ecmascript 5 parseint 08 0 if not support ecmascript 5 💡 explanation if the input string begins with 0 radix is eight octal or 10 decimal exactly which radix is chosen is implementation dependent ecmascript 5 specifies that 10 decimal is used but not all browsers support this yet for this reason always specify a radix when using parseint parseint always convert input to string js parseint tostring 2 valueof 1 2 number tostring 2 valueof 1 1 be careful while parsing floating point values js parseint 0 000001 0 parseint 0 0000001 1 parseint 1 1999999 5 💡 explanation parseint takes a string argument and returns an integer of the specified radix parseint also strips anything after and including the first non digit in the string parameter 0 000001 is converted to a string 0 000001 and the parseint returns 0 when 0 0000001 is converted to a string it is treated as 1e 7 and hence parseint returns 1 1 1999999 is interpreted as 5 00000250000125e 7 and parseint returns 5 math with true and false lets do some math js true true 2 true true true true true 3 hmmm… 🤔 💡 explanation we can coerce values to numbers with the number constructor its quite obvious that true will be coerced to 1 js number true 1 the unary plus operator attempts to convert its value into a number it can convert string representations of integers and floats as well as the non string values true false and null if it cannot parse a particular value it will evaluate to nan that means we can coerce true to 1 easier js true 1 when youre performing addition or multiplication the tonumber method is invoked according to the specification this method returns if argument is true return 1 if argument is false return 0 thats why we can add boolean values as regular numbers and get correct results corresponding sections 12 5 6 unary operator 12 8 3 the addition operator 7 1 3 tonumber argument html comments are valid in javascript you will be impressed but which is known as html comment is a valid comment in javascript js valid comment valid comment too 💡 explanation impressed html like comments were intended to allow browsers that didnt understand the script tag to degrade gracefully these browsers e g netscape 1 x are no longer popular so there is really no point in putting html comments in your script tags anymore since node js is based on the v8 engine html like comments are supported by the node js runtime too moreover theyre a part of the specification b 1 3 html like comments nan is not a number type of nan is a number js typeof nan number 💡 explanation explanations of how typeof and instanceof operators work 12 5 5 the typeof operator 12 10 4 runtime semantics instanceofoperator o c and null are objects js typeof object typeof null object however null instanceof object false 💡 explanation the behavior of typeof operator is defined in this section of the specification 12 5 5 the typeof operator according to the specification the typeof operator returns a string according to table 35 typeof operator results for null ordinary standard exotic and non standard exotic objects which do not implement call it returns the string object however you can check the type of an object by using the tostring method js object prototype tostring call object array object prototype tostring call new date object date object prototype tostring call null object null magically increasing numbers js 999999999999999 999999999999999 9999999999999999 10000000000000000 10000000000000000 10000000000000000 10000000000000000 1 10000000000000000 10000000000000000 1 1 10000000000000002 💡 explanation this is caused by ieee 754 2008 standard for binary floating point arithmetic at this scale it rounds to the nearest even number read more 6 1 6 the number type ieee 754 on wikipedia precision of 0 1 0 2 a well known joke an addition of 0 1 and 0 2 is deadly precise js 0 1 0 2 0 30000000000000004 0 1 0 2 0 3 false 💡 explanation the answer for the ”is floating point math broken ” question on stackoverflow the constants 0 2 and 0 3 in your program will also be approximations to their true values it happens that the closest double to 0 2 is larger than the rational number 0 2 but that the closest double to 0 3 is smaller than the rational number 0 3 the sum of 0 1 and 0 2 winds up being larger than the rational number 0 3 and hence disagreeing with the constant in your code this problem is so known that there is even a website called 0 30000000000000004 com it occurs in every language that uses floating point math not just javascript patching numbers you can add your own methods to wrapper objects like number or string js number prototype isone function return number this 1 1 0 isone true 1 isone true 2 0 isone false 7 isone false 💡 explanation obviously you can extend the number object like any other object in javascript however its not recommended if the behavior of the defined method is not a part of the specification here is the list of numbers properties 20 1 number objects comparison of three numbers js 1 2 3 true 3 2 1 false 💡 explanation why does this work that way well the problem is in the first part of an expression heres how it works js 1 2 3 1 2 true true 3 true 1 1 3 true 3 2 1 3 2 true true 1 true 1 1 1 false we can fix this with greater than or equal operator js 3 2 1 true read more about relational operators in the specification 12 10 relational operators funny math often the results of arithmetic operations in javascript might be quite unexpected consider these examples js 3 1 2 3 1 4 3 1 2 3 1 31 0 object object object object object object 222 111 333 4 4 16 0 4 4 4 4 nan 💡 explanation whats happening in the first four examples heres a small table to understand addition in javascript number number addition boolean number addition boolean boolean addition number string concatenation string boolean concatenation string string concatenation what about other examples a toprimitive and tostring methods are being implicitly called for and before addition read more about evaluation process in the specification 12 8 3 the addition operator 7 1 1 toprimitive input preferredtype 7 1 12 tostring argument addition of regexps did you know you can add numbers like this js patch a tostring method regexp prototype tostring function return this source 7 5 2 💡 explanation 21 2 5 10 get regexp prototype source strings arent instances of string js str str typeof str string str instanceof string false 💡 explanation the string constructor returns a string js typeof string str string string str str string str str true lets try with a new js new string str str true typeof new string str object object whats that js new string str string str more information about the string constructor in the specification 21 1 1 the string constructor calling functions with backticks lets declare a function which logs all params into the console js function f args return args no doubt you know you can call this function like this js f 1 2 3 1 2 3 but did you know you can call any function with backticks js f true is true false is false array is 1 2 3 true is false is array is true false 1 2 3 💡 explanation well this is not magic at all if youre familiar with tagged template literals in the example above f function is a tag for template literal tags before template literal allow you to parse template literals with a function the first argument of a tag function contains an array of string values the remaining arguments are related to the expressions example js function template strings keys do something with strings and keys… this is the magic behind famous library called 💅 styled components which is popular in the react community link to the specification 12 3 7 tagged templates call call call found by cramforce js console log call call call call call apply a a 1 2 💡 explanation attention it could break your mind try to reproduce this code in your head were applying the call method using the apply method read more 19 2 3 3 function prototype call thisarg args 19 2 3 1 function prototype apply thisarg argarray a constructor property js const c constructor c c c console log wtf wtf 💡 explanation lets consider this example step by step js declare a new constant which is a string constructor const c constructor c is a string c constructor getting a constructor of string c c function string getting a constructor of constructor c c c function function call the function constructor and pass the body of new function as an argument c c c function anonymous and then call this anonymous function the result is console logging a string wtf c c c wtf an object prototype constructor returns a reference to the object constructor function that created the instance object in case with strings it is string in case with numbers it is number and so on object prototype constructor at mdn 19 1 3 1 object prototype constructor object as a key of objects property js object object 💡 explanation why does this work so here were using a computed property name when you pass an object between those brackets it coerces object to a string so we get the property key object object and the value we can make brackets hell like this js structure object object object object read more about object literals here object initializer at mdn 12 2 6 object initializer accessing prototypes with proto as we know primitives dont have prototypes however if we try to get a value of proto for primitives we would get this js 1 proto proto proto null 💡 explanation this happens because when something doesnt have a prototype it will be wrapped into a wrapper object using the toobject method so step by step js 1 proto number 0 1 proto proto 1 proto proto proto null here is more information about proto b 2 2 1 object prototype proto 7 1 13 toobject argument object what is the result of the expression below js object the answer is js object object 💡 explanation we defined an object with a property object using shorthand property notation js object object then weve passed this object to the template literal so the tostring method calls for that object thats why we get the string object object 12 2 9 template literals object initializer at mdn destructuring with default values consider this example js let x x y 1 x y the example above is a great task for an interview what the value of y the answer is js 1 💡 explanation js let x x y 1 x y ↑ ↑ ↑ ↑ 1 3 2 4 with the example above we declare x with no value so its undefined then we pack the value of x into the object property x then we extract the value of x using destructuring and want to assign it to y if the value is not defined then were going to use 1 as the default value return the value of y object initializer at mdn dots and spreading interesting examples could be composed with spreading of arrays consider this js length 3 💡 explanation why 3 when we use the spread operator the iterator method is called and the returned iterator is used to obtain the values to be iterated the default iterator for string spreads a string into characters after spreading we pack these characters into an array then we spread this array again and pack it back to an array a string consists with three characters so the length of resulting array is 3 now step by step js length 3 obviously we can spread and wrap the elements of an array as many times as we want js and so on … labels not many programmers know about labels in javascript they are kind of interesting js foo console log first break foo console log second first undefined 💡 explanation the labeled statement is used with break or continue statements you can use a label to identify a loop and then use the break or continue statements to indicate whether a program should interrupt the loop or continue its execution in the example above we identify a label foo after that console log first executes and then we interrupt the execution read more about labels in javascript 13 13 labelled statements labeled statements at mdn nested labels js a b c d e f g 1 2 3 4 5 5 💡 explanation similar to previous examples follow these links 12 16 comma operator 13 13 labelled statements labeled statements at mdn insidious try catch what will this expression return 2 or 3 js try return 2 finally return 3 the answer is 3 surprised 💡 explanation 13 15 the try statement is this multiple inheritance take a look at the example below js new class f extends string array f is this a multiple inheritance nope 💡 explanation the interesting part is the value of the extends clause string array the grouping operator always returns its last argument so string array is actually just array that means weve just created a class which extends array 14 5 class definitions 12 16 comma operator a generator which yields itself consider this example of a generator which yields itself js function f yield f next value generatorfunction f done false as you can see the returned value is an object with its value equal to f in that case we can do something like this js function f yield f next value next value generatorfunction f done false and again function f yield f next value next value next value generatorfunction f done false and again function f yield f next value next value next value next value generatorfunction f done false and so on … 💡 explanation to understand why this works that way read these sections of the specification 25 control abstraction objects 25 3 generator objects a class of class consider this obfuscated syntax playing js typeof new class class object it seems like were declaring a class inside of class should be an error however we get the string object 💡 explanation since ecmascript 5 era keywords are allowed as property names so think about it as this simple object example js const foo class function and es6 standardized shorthand method definitions also classes can be anonymous so if we drop function part were going to get js class class the result of a default class is always a simple object and its typeof should return object read more here 14 3 method definitions 14 5 class definitions non coercible objects with well known symbols theres a way to get rid of type coercion take a look js function noncoercible val if val null throw typeerror noncoercible should not be called with null or undefined const res object val res symbol toprimitive throw typeerror trying to coerce non coercible object return res now we can use this like this js objects const foo noncoercible foo foo foo 10 typeerror trying to coerce non coercible object foo evil typeerror trying to coerce non coercible object strings const bar noncoercible bar bar 1 typeerror trying to coerce non coercible object bar tostring 1 bar1 bar bar false bar tostring bar true bar bar typeerror trying to coerce non coercible object numbers const baz noncoercible 1 baz 1 typeerror trying to coerce non coercible object baz 1 false baz valueof 1 true 💡 explanation a gist by sergey rubanov 6 1 5 1 well known symbols tricky arrow functions consider the example below js let f 10 f 10 okay fine but what about this js let f f undefined 💡 explanation you might expect instead of undefined this is because the curly braces are part of the syntax of the arrow functions so f will return undefined it is however possible to return the object directly from an arrow function by enclosing the return value with brackets js let f f arrow functions can not be a constructor consider the example below js let f function this a 1 new f a 1 now try do to the same with an arrow function js let f this a 1 new f typeerror f is not a constructor 💡 explanation arrow functions cannot be used as constructors and will throw an error when used with new because has a lexical this and do not have a prototype property so it would not make much sense arguments and arrow functions consider the example below js let f function return arguments f a 0 a now try do to the same with an arrow function js let f arguments f a uncaught referenceerror arguments is not defined 💡 explanation arrow functions are a lightweight version of regular functions with a focus on being short and lexical this at the same time arrow functions do not provide a binding for the arguments object as a valid alternative use the rest parameters to achieve the same result js let f args args f a arrow functions at mdn tricky return return statement is also tricky consider this js function return b 10 undefined 💡 explanation return and the returned expression must be in the same line js function return b 10 b 10 this is because of a concept called automatic semicolon insertion which automagically inserts semicolons after most newlines in the first example there is a semicolon inserted between the return statement and the object literal so the function returns undefined and the object literal is never evaluated 11 9 1 rules of automatic semicolon insertion 13 10 the return statement accessing object properties with arrays js var obj property 1 var array property obj array 1 what about pseudo multidimensional arrays js var map var x 1 var y 2 var z 3 map x y z true map x 10 y z true map 1 2 3 true map 11 2 3 true 💡 explanation the brackets operator converts the passed expression using tostring converting a one element array to a string is akin to converting the contained element to the string js property tostring property null and relational operators js null 0 false null 0 false null 0 true 💡 explanation long story short if null is less than 0 is false then null 0 is true read in depth explanation for this here number tofixed display different numbers number tofixed can behave a bit strange in different browsers check out this example js 0 7875 tofixed 3 firefox 0 787 chrome 0 787 ie11 0 788 0 7876 tofixed 3 firefox 0 788 chrome 0 788 ie11 0 788 💡 explanation while your first instinct may be that ie11 is correct and firefox chrome are wrong the reality is that firefox chrome are more directly obeying standards for numbers ieee 754 floating point while ie11 is minutely disobeying them in what is probably an effort to give clearer results you can see why this occurs with a few quick tests js confirm the odd result of rounding a 5 down 0 7875 tofixed 3 0 787 it looks like its just a 5 when you expand to the limits of 64 bit double precision float accuracy 0 7875 tofixed 14 0 78750000000000 but what if you go beyond the limit 0 7875 tofixed 20 0 78749999999999997780 floating point numbers are not stored as a list of decimal digits internally but through a more complicated methodology that produces tiny inaccuracies that are usually rounded away by tostring and similar calls but are actually present internally in this case that 5 on the end was actually an extremely tiny fraction below a true 5 rounding it at any reasonable length will render it as a 5 but it is actually not a 5 internally ie11 however will report the value input with only zeros appended to the end even in the tofixed 20 case as it seems to be forcibly rounding the value to reduce the troubles from hardware limits see for reference note 2 on the ecma 262 definition for tofixed 20 1 3 3 number prototype tofixed fractiondigits math max less than math min js math min 1 4 7 2 1 math max 1 4 7 2 7 math min infinity math max infinity math min math max true 💡 explanation why is math max less than math min by charlie harvey comparing null to 0 the following expressions seem to introduce a contradiction js null 0 false null 0 false null 0 true how can null be neither equal to nor greater than 0 if null 0 is actually true this also works with less than in the same way 💡 explanation the way these three expressions are evaluated are all different and are responsible for producing this unexpected behavior first the abstract equality comparison null 0 normally if this operator cant compare the values on either side properly it converts both to numbers and compares the numbers then you might expect the following behavior js this is not what happens null 0 null 0 0 0 true however according to a close reading of the spec the number conversion doesnt actually happen on a side that is null or undefined therefore if you have null on one side of the equal sign the other side must be null or undefined for the expression to return true since this is not the case false is returned next the relational comparison null 0 the algorithm here unlike that of the abstract equality operator will convert null to a number therefore we get this behavior js null 0 null 0 0 0 false finally the relational comparison null 0 you could argue that this expression should be the result of null 0 null 0 if this were the case then the above results would mean that this would also be false however the operator in fact works in a very different way which is basically to take the opposite of the operator because our example with the greater than operator above also holds for the less than operator that means this expression is actually evaluated like so js null 0 null 0 null 0 0 0 false true 7 2 12 abstract relational comparison 7 2 13 abstract equality comparison same variable redeclaration js allows to redeclare variables js a a this is also valid a a works also in strict mode js var a a a var a var a 💡 explanation all defenitions are merged into one definition 13 3 2 variable statement other resources wtfjs com — a collection of those very special irregularities inconsistencies and just plain painfully unintuitive moments for the language of the web wat — a lightning talk by gary bernhardt from codemash 2012 what the javascript — kyle simpsons talk for forward 2 attempts to “pull out the crazy” from javascript he wants to help you produce cleaner more elegant more readable code then inspire people to contribute to the open source community 🎓 license © denys dovhan