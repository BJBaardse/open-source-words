ipsec vpn server auto setup scripts set up your own ipsec vpn server in just a few minutes with both ipsec l2tp and cisco ipsec on ubuntu debian and centos all you need to do is provide your own vpn credentials and let the scripts handle the rest an ipsec vpn encrypts your network traffic so that nobody between you and the vpn server can eavesdrop on your data as it travels via the internet this is especially useful when using unsecured networks e g at coffee shops airports or hotel rooms we will use libreswan as the ipsec server and xl2tpd as the l2tp provider » related tutorial ipsec vpn server auto setup with libreswan read this in other languages english 简体中文 table of contents quick start features requirements installation next steps important notes upgrade libreswan bugs questions uninstallation see also license quick start first prepare your linux server with a fresh install of ubuntu lts debian or centos use this one liner to set up an ipsec vpn server bash wget https git io vpnsetup o vpnsetup sh sudo sh vpnsetup sh if using centos replace the link above with https git io vpnsetup centos your vpn login details will be randomly generated and displayed on the screen when finished for other installation options and how to set up vpn clients read the sections below a dedicated server or virtual private server vps openvz vps is not supported features new the faster ipsec xauth cisco ipsec mode is supported new a pre built docker image of the vpn server is now available fully automated ipsec vpn server setup no user input needed encapsulates all vpn traffic in udp does not need esp protocol can be directly used as user data for a new amazon ec2 instance includes sysctl conf optimizations for improved performance tested with ubuntu 18 04 16 04 14 04 debian 9 8 and centos 7 6 requirements a newly created amazon ec2 instance from these images amis ubuntu 18 04 bionic 16 04 xenial or 14 04 trusty debian 9 stretch or 8 jessie centos 7 x86 64 with updates centos 6 x86 64 with updates please see detailed instructions and ec2 pricing or a dedicated server or kvm xen based virtual private server vps freshly installed with one of the above os openvz vps is not supported users could instead try openvpn or shadowsocks this also includes linux vms in public clouds such as digitalocean vultr linode google compute engine amazon lightsail microsoft azure ibm cloud ovh and rackspace » i want to run my own vpn but dont have a server for that advanced users can set up the vpn server on a 35 raspberry pi 3 warning do not run these scripts on your pc or mac they should only be used on a server installation ubuntu debian first update your system with apt get update apt get dist upgrade and reboot this is optional but recommended to install the vpn please choose one of the following options option 1 have the script generate random vpn credentials for you will be displayed when finished bash wget https git io vpnsetup o vpnsetup sh sudo sh vpnsetup sh option 2 edit the script and provide your own vpn credentials bash wget https git io vpnsetup o vpnsetup sh nano w vpnsetup sh replace with your own values your ipsec psk your username and your password sudo sh vpnsetup sh option 3 define your vpn credentials as environment variables bash all values must be placed inside single quotes do not use these special characters within values \ wget https git io vpnsetup o vpnsetup sh sudo \ vpn ipsec psk your ipsec pre shared key \ vpn user your vpn username \ vpn password your vpn password sh vpnsetup sh note if unable to download via wget you may also open vpnsetup sh or vpnsetup centos sh and click the raw button press ctrl a to select all ctrl c to copy then paste into your favorite editor centos rhel first update your system with yum update and reboot this is optional but recommended follow the same steps as above but replace https git io vpnsetup with https git io vpnsetup centos next steps get your computer or device to use the vpn please refer to configure ipsec l2tp vpn clients configure ipsec xauth cisco ipsec vpn clients how to ikev2 vpn for windows 7 and above if you get an error when trying to connect see troubleshooting enjoy your very own vpn sparkles tada rocket sparkles important notes read this in other languages english 简体中文 for windows users this one time registry change is required if the vpn server and or client is behind nat e g home router the same vpn account can be used by your multiple devices however due to an ipsec l2tp limitation if you wish to connect multiple devices simultaneously from behind the same nat e g home router you must use only ipsec xauth mode for servers with an external firewall e g ec2 gce open udp ports 500 and 4500 for the vpn if you wish to add edit or remove vpn user accounts see manage vpn users clients are set to use google public dns when the vpn is active if another dns provider is preferred replace 8 8 8 8 and 8 8 4 4 in both etc ppp options xl2tpd and etc ipsec conf then reboot your server using kernel support could improve ipsec l2tp performance it is available on ubuntu 18 04 16 04 debian 9 and centos 7 6 ubuntu users need to install the linux image extra uname r package and run service xl2tpd restart to modify the iptables rules after install edit etc iptables rules and or etc iptables rules v4 ubuntu debian or etc sysconfig iptables centos then reboot your server when connecting via ipsec l2tp the vpn server has ip 192 168 42 1 within the vpn subnet 192 168 42 0 24 the scripts will backup existing config files before making changes with old date time suffix upgrade libreswan the additional scripts vpnupgrade sh and vpnupgrade centos sh can be used to upgrade libreswan changelog announce edit the swan ver variable as necessary check which version is installed ipsec version bash ubuntu debian wget https git io vpnupgrade o vpnupgrade sh centos rhel wget https git io vpnupgrade centos o vpnupgrade sh bugs questions got a question please first search other peoples comments in this gist and on my blog ask vpn related questions on the libreswan or strongswan mailing list or read these wikis 1 2 3 4 5 if you found a reproducible bug open a github issue to submit a bug report uninstallation please refer to uninstall the vpn see also ipsec vpn server on docker ikev2 vpn server on docker streisand algo vpn openvpn install license copyright c 2014 2018 lin song based on the work of thomas sarlandie copyright 2012 this work is licensed under the creative commons attribution sharealike 3 0 unported license attribution required please include my name in any derivative and let me know how you have improved it