mongoose mongoose is a mongodb object modeling tool designed to work in an asynchronous environment documentation mongoosejs com mongoose 5 0 0 was released on january 17 2018 you can find more details on backwards breaking changes in 5 0 0 on github support stack overflow bug reports mongoose slack channel help forum mongodb support importing javascript using node jsrequire const mongoose require mongoose using es6 imports import mongoose from mongoose plugins check out the plugins search site to see hundreds of related modules from the community next learn how to write your own plugin from the docs or this blog post contributors pull requests are always welcome please base pull requests against the master branch and follow the contributing guide if your pull requests makes documentation changes please do not modify any html files the html files are compiled code so please make your changes in docs jade lib js or test docs js view all 300 contributors installation first install node js and mongodb then sh npm install mongoose overview connecting to mongodb first we need to define a connection if your app uses only one database you should use mongoose connect if you need to create additional connections use mongoose createconnection both connect and createconnection take a mongodb uri or the parameters host database port options js const mongoose require mongoose mongoose connect mongodb localhost my database once connected the open event is fired on the connection instance if youre using mongoose connect the connection is mongoose connection otherwise mongoose createconnection return value is a connection note if the local connection fails then try using 127 0 0 1 instead of localhost sometimes issues may arise when the local hostname has been changed important mongoose buffers all the commands until its connected to the database this means that you dont have to wait until it connects to mongodb in order to define models run queries etc defining a model models are defined through the schema interface js const schema mongoose schema objectid schema objectid const blogpost new schema author objectid title string body string date date aside from defining the structure of your documents and the types of data youre storing a schema handles the definition of validators async and sync defaults getters setters indexes middleware methods definition statics definition plugins pseudo joins the following example shows some of these features js const comment new schema name type string default hahaha age type number min 18 index true bio type string match a z date type date default date now buff buffer a setter comment path name set function v return capitalize v middleware comment pre save function next notify this get email next take a look at the example in examples schema js for an end to end example of a typical setup accessing a model once we define a model through mongoose model modelname myschema we can access it through the same function js const mymodel mongoose model modelname or just do it all at once js const mymodel mongoose model modelname myschema the first argument is the singular name of the collection your model is for mongoose automatically looks for the plural version of your model name for example if you use js const mymodel mongoose model ticket myschema then mongoose will create the model for your tickets collection not your ticket collection once we have our model we can then instantiate it and save it js const instance new mymodel instance my key hello instance save function err or we can find documents from the same collection js mymodel find function err docs docs foreach you can also findone findbyid update etc for more details check out the docs important if you opened a separate connection using mongoose createconnection but attempt to access the model through mongoose model modelname it will not work as expected since it is not hooked up to an active db connection in this case access your model through the connection you created js const conn mongoose createconnection your connection string const mymodel conn model modelname schema const m new mymodel m save works vs js const conn mongoose createconnection your connection string const mymodel mongoose model modelname schema const m new mymodel m save does not work b c the default connection object was never connected embedded documents in the first example snippet we defined a key in the schema that looks like comments comment where comment is a schema we created this means that creating embedded documents is as simple as js retrieve my model var blogpost mongoose model blogpost create a blog post var post new blogpost create a comment post comments push title my comment post save function err if err console log success the same goes for removing them js blogpost findbyid myid function err post if err post comments 0 remove post save function err do something embedded documents enjoy all the same features as your models defaults validators middleware whenever an error occurs its bubbled to the save error callback so error handling is a snap middleware see the docs page intercepting and mutating method arguments you can intercept method arguments via middleware for example this would allow you to broadcast changes about your documents every time someone sets a path in your document to a new value js schema pre set function next path val typel this is the current document this emit set path val pass control to the next pre next moreover you can mutate the incoming method arguments so that subsequent middleware see different values for those arguments to do so just pass the new values to next js pre method function firstpre next methodarg1 methodarg2 mutate methodarg1 next altered methodarg1 tostring methodarg2 pre declaration is chainable pre method function secondpre next methodarg1 methodarg2 console log methodarg1 altered originalvalofmethodarg1 console log methodarg2 originalvalofmethodarg2 passing no arguments to next automatically passes along the current argument values i e the following next is equivalent to next methodarg1 methodarg2 and also equivalent to with the example method arg values next altered originalvalofmethodarg1 originalvalofmethodarg2 next schema gotcha type when used in a schema has special meaning within mongoose if your schema requires using type as a nested property you must use object notation js new schema broken type boolean asset name string type string uh oh it broke asset will be interpreted as string new schema works type boolean asset name string type type string works asset is an object with a type property driver access mongoose is built on top of the official mongodb node js driver each mongoose model keeps a reference to a native mongodb driver collection the collection object can be accessed using yourmodel collection however using the collection object directly bypasses all mongoose features including hooks validation etc the one notable exception that yourmodel collection still buffers commands as such yourmodel collection find will not return a cursor api docs find the api docs here generated using dox and acquit license copyright c 2010 learnboost dev learnboost com permission is hereby granted free of charge to any person obtaining a copy of this software and associated documentation files the software to deal in the software without restriction including without limitation the rights to use copy modify merge publish distribute sublicense and or sell copies of the software and to permit persons to whom the software is furnished to do so subject to the following conditions the above copyright notice and this permission notice shall be included in all copies or substantial portions of the software the software is provided as is without warranty of any kind express or implied including but not limited to the warranties of merchantability fitness for a particular purpose and noninfringement in no event shall the authors or copyright holders be liable for any claim damages or other liability whether in an action of contract tort or otherwise arising from out of or in connection with the software or the use or other dealings in the software