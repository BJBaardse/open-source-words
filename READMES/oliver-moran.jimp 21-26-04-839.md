jimp the javascript image manipulation program an image processing library for node written entirely in javascript with zero native dependencies installation npm install save jimp example usage js var jimp require jimp open a file called lenna png jimp read lenna png function err lenna if err throw err lenna resize 256 256 resize quality 60 set jpeg quality greyscale set greyscale write lena small bw jpg save using promises js jimp read lenna png then function lenna return lenna resize 256 256 resize quality 60 set jpeg quality greyscale set greyscale write lena small bw jpg save catch function err console error err basic usage the static jimp read method takes the path to a png jpeg or bmp file and returns a promise js jimp read path to image jpg then function image do stuff with the image catch function err handle an exception the method can also read a png jpeg or bmp buffer or from a url js jimp read lenna buffer then function image do stuff with the image catch function err handle an exception jimp read http www example com path to lenna jpg then function image do stuff with the image catch function err handle an exception basic methods once the promise is fulfilled the following methods can be called on the image js resize image contain w h alignbits mode mode scale the image to the given width and height some parts of the image may be letter boxed image cover w h alignbits mode mode scale the image to the given width and height some parts of the image may be clipped image resize w h mode resize the image jimp auto can be passed as one of the values image scale f mode scale the image by the factor f image scaletofit w h mode scale the image to the largest size that fits inside the given width and height an optional resize mode can be passed with all resize methods crop image autocrop tolerance frames automatically crop same color borders from image if any frames must be a boolean image crop x y w h crop to the given region composing image blit src x y srcx srcy srcw srch blit the image with another jimp image at x y optionally cropped image composite src x y composites another jimp image over this image at x y image mask src x y masks the image with another jimp image at x y using average pixel value image convolute kernel applies a convolution kernel matrix to the image or a region flip and rotate image flip horz vert flip the image horizontally or vertically image mirror horz vert an alias for flip image rotate deg mode rotate the image clockwise by a number of degrees optionally a resize mode can be passed if false is passed as the second parameter the image width and height will not be resized image exifrotate jpeg images with exif orientation data will be automatically re orientated as appropriate colour image brightness val adjust the brighness by a value 1 to 1 image contrast val adjust the contrast by a value 1 to 1 image dither565 ordered dithering of the image and reduce color space to 16 bits rgb565 image greyscale remove colour from the image image invert invert the image colours image normalize normalize the channels in an image alpha channel image fade f an alternative to opacity fades the image by a factor 0 1 0 will haven no effect 1 will turn the image image opacity f multiply the alpha channel by each pixel by the factor f 0 1 image opaque set the alpha channel on every pixel to fully opaque image background hex set the default new pixel colour e g 0xffffffff or 0x00000000 for by some operations e g image contain and blurs image gaussian r gaussian blur the image by r pixels very slow image blur r fast blur the image by r pixels effects image posterize n apply a posterization effect with n level image sepia apply a sepia wash to the image image pixelate size x y w h apply a pixelation effect to the image or a region 3d image displace map offset displaces the image pixels based on the provided displacement map useful for making stereoscopic 3d images some of these methods are irreversable so it can be useful to perform them on a clone of the original image js image clone returns a clone of the image contributions of more methods are welcome resize modes the default resizing algorithm uses a bilinear method as follows js image resize 250 250 resize the image to 250 x 250 image resize jimp auto 250 resize the height to 250 and scale the width accordingly image resize 250 jimp auto resize the width to 250 and scale the height accordingly optionally the following constants can be passed to choose a particular resizing algorithm js jimp resize nearest neighbor jimp resize bilinear jimp resize bicubic jimp resize hermite jimp resize bezier for example js image resize 250 250 jimp resize bezier align modes the following constants can be passed to image cover and image contain methods js jimp horizontal align left jimp horizontal align center jimp horizontal align right jimp vertical align top jimp vertical align middle jimp vertical align bottom for example js image contain 250 250 jimp horizontal align left jimp vertical align top default align modes are js jimp horizontal align center jimp vertical align middle writing text jimp supports basic typography using bmfont format fnt bitmap fonts js jimp loadfont path then function font load font from fnt file image print font x y str print a message on an image image print font x y str width print a message on an image with text wrapped at width jimp loadfont path cb using a callback pattern bmfont fonts are raster based and fixed in size and colour jimp comes with a set of fonts that can be used on images js jimp font sans 8 black open sans 8px black jimp font sans 10 black open sans 10px black jimp font sans 12 black open sans 12px black jimp font sans 14 black open sans 14px black jimp font sans 16 black open sans 16px black jimp font sans 32 black open sans 32px black jimp font sans 64 black open sans 64px black jimp font sans 128 black open sans 128px black jimp font sans 8 white open sans 8px white jimp font sans 16 white open sans 16px white jimp font sans 32 white open sans 32px white jimp font sans 64 white open sans 64px white jimp font sans 128 white open sans 128px white these can be used as follows js jimp loadfont jimp font sans 32 black then function font image print font 10 10 hello world online tools are also available to convert ttf fonts to bmfont format e g littera writing to files and buffers writing to files the image can be written to disk in png jpeg or bmp format determined by the file extension using js image write path cb node style callback will be fired when write is successful the original extension for an image or png can accessed as using image getextension the following will save an image using its original format js var file new name image getextension image write file writing to buffers a png jpeg or bmp binary buffer of an image e g for storage in a database can be obtained using js image getbuffer mime cb node style callback will be fired with result for convenience supported mime types are available as static properties js jimp mime png image png jimp mime jpeg image jpeg jimp mime bmp image bmp if jimp auto is passed as the mime type then the original mime type for the image or image png will be used alernatively image getmime will return the original mime type of the image or image png data uri a base64 data uri can be generated in the same way as a buffer using js image getbase64 mime cb node style callback will be fired with result png and jpeg quality the quality of jpegs can be set with js image quality n set the quality of saved jpeg 0 100 the format of pngs can be set with js image rgba bool set whether pngs are saved as rgba true default or rgb false image filtertype number set the filter type for the saved png image deflatelevel number set the deflate level for the saved png jimp deflatestrategy number set the deflate for the saved png 0 3 for convenience supported filter types are available as static properties js jimp png filter auto 1 jimp png filter none 0 jimp png filter sub 1 jimp png filter up 2 jimp png filter average 3 jimp png filter paeth 4 advanced usage colour manipulation jimp supports advanced colour manipulation using a single method as follows js image color apply hue params 90 apply lighten params 50 apply xor params 06d the method supports the following modifiers modifier description lighten amount lighten the color a given amount from 0 to 100 providing 100 will always return white works through tinycolor brighten amount brighten the color a given amount from 0 to 100 works through tinycolor darken amount darken the color a given amount from 0 to 100 providing 100 will always return black works through tinycolor desaturate amount desaturate the color a given amount from 0 to 100 providing 100 will is the same as calling greyscale works through tinycolor saturate amount saturate the color a given amount from 0 to 100 works through tinycolor greyscale amount completely desaturates a color into greyscale works through tinycolor spin degree spin the hue a given amount from 360 to 360 calling with 0 360 or 360 will do nothing since it sets the hue back to what it was before works through tinycolor hue degree alias for spin mix color amount mixes colors by their rgb component values amount is opacity of overlaying color tint amount same as applying mix with white color shade amount same as applying mix with black color xor color treats the two colors as bitfields and applies an xor operation to the red green and blue components red amount modify red component by a given amount green amount modify green component by a given amount blue amount modify blue component by a given amount convolution matrix sum neighbor pixels weighted by the kernel matrix you can find a nice explanation with examples at gimps convolution matrix plugin implement emboss effect js image convolute 2 1 0 1 1 1 0 1 2 low level manipulation jimp enables low level manipulation of images in memory through the bitmap property of each jimp object js image bitmap data a buffer of the raw bitmap data image bitmap width the width of the image image bitmap height the height of the image this data can be manipulated directly but remember garbage in garbage out a helper method is available to scan a region of the bitmap js image scan x y w h f scan a given region of the bitmap and call the function f on every pixel example usage js image scan 0 0 image bitmap width image bitmap height function x y idx x y is the position of this pixel on the image idx is the position start position of this rgba tuple in the bitmap buffer this is the image var red this bitmap data idx 0 var green this bitmap data idx 1 var blue this bitmap data idx 2 var alpha this bitmap data idx 3 rgba values run from 0 255 e g this bitmap data idx 0 removes red from this pixel if you need to do something with the image at the end of the scan js image scan 0 0 image bitmap width image bitmap height function x y idx do your stuff if x image bitmap width 1 y image bitmap height 1 image scan finished do your stuff a helper to locate a particular pixel within the raw bitmap buffer js image getpixelindex x y returns the index within image bitmap data one of the following may be optionally passed as a third parameter to indicate a strategy for x y positions that are outside of boundaries of the image js jimp edge extend 1 jimp edge wrap 2 jimp edge crop 3 alternatively you can manipulate individual pixels using the following these functions js image getpixelcolor x y returns the colour of that pixel e g 0xffffffff image setpixelcolor hex x y sets the colour of that pixel two static helper functions exist to convert rgba values into single integer hex values js jimp rgbatoint r g b a e g converts 255 255 255 255 to 0xffffffff jimp inttorgba hex e g converts 0xffffffff to r 255 g 255 b 255 a 255 creating new images if you want to begin with an empty jimp image you can call the jimp constructor passing the width and height of the image to create and optionally a node style callback js var image new jimp 256 256 function err image this image is 256 x 256 every pixel is set to 0x00000000 you can optionally set the pixel colour as follows js var image new jimp 256 256 0xff0000ff function err image this image is 256 x 256 every pixel is set to 0xff0000ff comparing images to generate a perceptual hash of a jimp image based on the phash algorithm use js image hash ahgg4ggofja by default the hash is returned as base 64 the hash can be returned at another base by passing a number from 2 to 64 to the method js image hash 2 1010101011010000101010000100101010010000011001001001010011100100 there are 18 446 744 073 709 551 615 unique hashes the hamming distance between the binary representation of these hashes can be used to find similar looking images to calculate the hamming distance between two jimp images based on their perceptual hash use js jimp distance image1 image2 returns a number 0 1 where 0 means the two images are perceived to be identical jimp also allows the diffing of two jimp images using pixelmatch as follows js var diff jimp diff image1 image2 threshold threshold ranges 0 1 default 0 1 diff image a jimp image showing differences diff percent the proportion of different pixels 0 1 where 0 means the images are pixel identical using a mix of hamming distance and pixel diffing to comare images the following code has a 99 success rate of detecting the same image from a random sample with 1 false positives the test this figure is drawn from attempts to match each image from a sample of 120 pngs against 120 corresponing jpegs saved at a quality setting of 60 js var distance jimp distance png jpeg perceived distance var diff jimp diff png jpeg pixel difference if distance 0 15 diff percent 0 15 images match else not a match chaining or callbacks most instance methods can be chained together for example as follows js jimp read lenna png function err image this greyscale scale 0 5 write lena half bw png alternatively methods can be passed node style callbacks js jimp read lenna png function err image image greyscale function err image image scale 0 5 function err image image write lena half bw png the node style callback pattern allows jimp to be used with frameworks that expect or build on the node style callback pattern contributing basicaly clone change test push and pull request please read de contributing documentation testing the test framework runs at node js and browsers environments just run npm test to test in node and browser environments more information at how to contribute docs testing topic license jimp is licensed under the mit license open sans is licensed under the apache license