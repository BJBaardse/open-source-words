stf or smartphone test farm is a web application for debugging smartphones smartwatches and other gadgets remotely from the comfort of your browser stf was originally developed at cyberagent to control a growing collection of more than 160 devices as of july 2016 development is mainly sponsored by headspin and other individual contributors please visit our bountysource if youd like to support future development how are your donations being used check out our donation transparency report sponsors gold sponsor headspin enables developers launch high quality and high performing apps worldwide using headspins global distributed device cloud infrastructure developers can test and monitor their apps instantly on 1 500 global cell networks and local devices headspin seamlessly plugs into your development workflow with no code changes to your apps headspin offers a generous monthly contribution towards stf development how to become a sponsor please contact us for sponsor arrangements both recurring and one time contributions are most welcome contributions towards a specific issue or feature are also possible and can be attributed to your company in our release notes and other related materials hardware only contributions whether new or used are also extremely helpful and well received especially if you find a device that doesnt work please see our donation transparency report for past hardware contributions features os support android supports versions 2 3 3 sdk level 10 to 8 1 sdk level 27 supports wear 5 1 but not 5 0 due to missing permissions supports fire os cyanogenmod and other heavily android based distributions root is not required for any current functionality remote control any device from your browser real time screen view refresh speed can reach 30 40 fps depending on specs and android version see minicap for more information rotation support supports typing text from your own keyboard supports meta keys copy and paste support although it can be a bit finicky on older devices you may need to long press and select paste manually may sometimes not work well with non latin languages unfortunately multitouch support on touch screens via minitouch two finger pinch rotate zoom gesture support on regular screens by pressing alt while dragging drag drop installation and launching of apk files launches main launcher activity if specified in the manifest reverse port forwarding via minirev access your local server directly from the device even if its not on the same network open websites easily in any browser installed browsers are detected in real time and shown as selectable options default browser is detected automatically if selected by the user execute shell commands and see real time output display and filter device logs use adb connect to connect to a remote device as if it was plugged in to your computer regardless of adb mode and whether youre connected to the same network run any adb command locally including shell access android studio and other ide support debug your app while watching the device screen on your browser supports chrome remote debug tools file explorer to access device file system experimental vnc support work in progress manage your device inventory see which devices are connected offline unavailable indicating a weak usb connection unauthorized or unplugged see whos using a device search devices by phone number imei iccid android version operator product name and or many other attributes with easy but powerful queries show a bright red screen with identifying information on a device you need to locate physically track battery level and health rudimentary play store account management list remove and add new accounts adding may not work on all devices display hardware specs simple rest api status stf is in continued active development but development is still largely funded by individual team members and their unpaid free time leading to slow progress while normal for many open source projects stf is quite heavy on the hardware side and is therefore somewhat of a money sink see how to become a sponsor if you or your company would like to support future development were also actively working to expand the team dont be afraid to ask if youre interested short term goals here are some things we are planning to address asap performance properly expose the new vnc functionality in the ui properly reset user data between uses android 4 0 automated scheduled restarts for devices more consulting services we highly encourage open participation in the community however if youre running a business that uses stf or would like to use stf you may sometimes want to have an expert i e one of the original developers or a skilled contributor work with you to set up a prototype for evaluation purposes add support for new or old hardware figure out an issue fix a bug or add some new feature our services are similar to ffmpegs contact us with details and well see what we can do availability is limited and tied to individual developers schedules a quick note about security as the product has evolved from an internal tool running in our internal network we have made certain assumptions about the trustworthiness of our users as such there is little to no security or encryption between the different processes furthermore devices do not get completely reset between uses potentially leaving accounts logged in or exposing other sensitive data this is not an issue for us as all of our devices are test devices and are only used with test accounts but it may be an issue for you if you plan on deploying stf to a multiuser environment we welcome contributions in this area requirements node js 6 9 latest stable version preferred adb properly set up rethinkdb 2 2 graphicsmagick for resizing screenshots zeromq libraries installed protocol buffers libraries installed yasm installed for compiling embedded libjpeg turbo pkg config so that node js can find the libraries note that you need these dependencies even if youve installed stf directly from npm because they cant be included in the package on mac os you can use homebrew to install most of the dependencies bash brew install rethinkdb graphicsmagick zeromq protobuf yasm pkg config on windows youre on your own in theory you might be able to get stf installed via cygwin or similar but weve never tried in principle we will not provide any windows installation support but please do send a documentation pull request if you figure out what to do we also provide a docker container in the docker hub as openstf stf you can use our dockerfile as guidance if youd prefer to do the installation yourself you should now be ready to build or run stf note that while mac os can be used for development it doesnt provide a very reliable experience in production due to presumed bugs in adbs mac os implementation we use coreos but any linux or bsd distribution should do fine installation as mentioned earlier you must have all of the requirements installed first then you can simply install via npm bash npm install g stf now youre ready to run for development though you should build instead building after youve got all the requirements installed its time to fetch the rest of the dependencies first fetch all npm and bower modules bash npm install you may also wish to link the module so that youll be able to access the stf command directly from the command line bash npm link you should now have a working installation for local development running stf comprises of several independent processes that must normally be launched separately in our own setup each one these processes is its own systemd unit see deployment md and setup examples if youre interested for development purposes however theres a helper command to quickly launch all required processes along with a mock login implementation note that you must have rethinkdb running first if you dont have rethinkdb set up yet to start it up go to the folder where youd like rethinkdb to create a rethinkdb data folder in perhaps the folder where this repo is and run the following command bash rethinkdb note if it takes a long time for rethinkdb to start up you may be running into rethinkdb rethinkdb 4600 or rethinkdb rethinkdb 6047 this usually happens on macos sierra to fix this on macos first run scutil get hostname to check if the hostname variable is unset rethinkdb needs it to generate a server name for your instance if you find that its empty running sudo scutil set hostname hostname has been confirmed to fix the issue on at least one occasion see the issues for more complete solutions you should now have rethinkdb running locally running the command again in the same folder will reuse the data from the previous session youre now ready to start up stf itself bash stf local after the webpack build process has finished which can take a small while you should have your private stf running on http localhost 7100 if you had devices connected before running the command those devices should now be available for use if not you should see what went wrong from your console feel free to plug in or unplug any devices at any time note that if you see your device ready to use but without a name or a proper image were probably missing the data for that model in our device database everything should work fine either way if you want to access stf from other machines you can add the public ip option for quick testing bash stf local public ip your internal network ip here updating to update your development version simply pull the repo and run npm install again you may occasionally have to remove the whole node modules and res bower components folder to prevent npm or bower from complaining about version mismatches faq can i deploy stf to actual servers yes see deployment md and setup examples will i have to change battery packs all the time no not all the time aside from a single early failure we had within only a few months all of our devices were doing fine for about two years however having reached the 2 3 year mark several devices have started to experience visibly expanded batteries expanded batteries should be replaced as soon as possible note that this issue isnt specific to stf its just what happens over time you should be prepared to replace the batteries every now and then in any case we consider 2 years per battery pack to be fairly good value for a device lab you should set up your devices so that the display is allowed to turn off entirely after a short timeout 30 seconds or so should do just fine stf will wake it up when necessary otherwise you risk reducing the lifetime of your device note that you may have a problem if your usb hubs are unable to both provide enough power for charging and support a data connection at the same time data connections require power too this can cause a device to stop charging when being used resulting in many charging cycles if this happens you will just need to get a better usb hub is the system secure its possible to run the whole user facing side behind https but thats pretty much it all internal communication between processes is insecure and unencrypted which is a problem if you can eavesdrop on the network see our quick note about security can i just put the system online put a few devices there and start selling it yes and no see is the system secure the system has been built in an environment where we are able to trust our users and be confident that theyre not going to want to mess with others in the current incarnation of the system a malicious user with knowledge of the inner workings will for instance be able to control any device at any time whether it is being used by someone or not pull requests are welcome once ive got the system running can i pretty much leave it like that or is manual intervention required in our experience the system runs just fine most of the time and any issues are mostly usb related youll usually have to do something about once a week the most common issue is that a device will lose all of its active usb connections momentarily youll get errors in the logs but the worker process will either recover or get respawned requiring no action on your side below are the most common errors that do require manual intervention one device worker keeps getting respawned all the time rebooting the device usually helps if the device stays online for long enough you might be able to do it from the ui otherwise youll have to ssh into the server and run adb reboot manually this could be a sign that youre having usb problems and the device wishes to be moved elsewhere the less complex your setup is the fewer problems youre going to experience see troubleshooting were working on adding periodic automatic restarts and better graceful recovery to alleviate the issue a whole group of devices keeps dying at once theyre most likely connected to the same usb hub either the hub is bad or you have other compatibility issues in our experience this usually happens with usb 3 0 hubs or you may have a problem with your usb extension card see recommended hardware a device that should be online is not showing up in the list or is showing up as disconnected see troubleshooting how do i uninstall stf from my device when you unplug your device all stf utilities except stfservice stop running automatically it doesnt do any harm to force stop or uninstall it to uninstall the stfservice run the following command bash adb uninstall jp co cyberagent stf you may also wish to remove our support binaries although as mentioned before they wont run unless the device is actually connected to stf you can do this as follows bash adb shell rm data local tmp minicap \ data local tmp minicap so \ data local tmp minitouch \ data local tmp minirev your device is now clean troubleshooting i plugged in a new device but its not showing up in the list there can be various reasons for this behavior some especially common reasons are usb debugging is not enabled enable it usb debugging is enabled but the usb connection mode is wrong try switching between mtp and ptp modes and see if the device appears this happens fairly often on mac os but almost never on linux you dont have the adb daemon running make sure adb is running with adb start server you havent authorized the adb key yet check your device for an authentication dialog you may need to unplug and then plug the device back in to see the dialog adb hasnt whitelisted the manufacturers vendor id add it yourself or wait for the new version that removes the stupid whitelisting feature to be deployed insufficient power supply if youre using a usb hub try a powered hub instead one that comes with a separate ac adapter even if youre using a powered hub there might not actually be enough power for all ports simultaneously get a better hub or use fewer ports your device is too power hungry can happen with tablets get a better hub insufficient usb host controller resources on linux use dmesg to check for this error if youve only got 9 12 devices connected and an intel haswell processor its most likely an issue with the processor if your bios has an option to disable usb 3 0 that might help if not youre screwed and must get a pcie extension card with onboard controllers your powered usb hub does not support the device can happen with older devices and newer battery charging spec compatible hubs get a more compatible hub the usb cable is bad it happens try another one the usb hub is broken this too happens just try a new one the device might not have a unique usb serial number causing stf to overwrite the other device instead this has never happened to us so far but we do have one dirt cheap android 4 4 device whose serial number is the wonderfully unique 0123456789abcdef presumably if we had more than one unit we would have a problem a device that was previously connected no longer shows up in the list again there can be various reasons for this behavior as well some common reasons are the device ran out of power you can see the last reported power level in the device list unless there was a lengthy power outage preventing the battery level from being reported someone accidentally disabled usb debugging remotely yes it happens an os update disabled usb debugging yes it happens especially on fire os someone touched the usb cable just the wrong way causing a disconnection happens easily your pcie usb extension card died yes it happens temporary network issues cant help with that someone removed the device physically or that youre on mac os theres a bug in adbs mac os implementation that causes devices to be lost on error conditions the problem is more pronounced when using usb hubs you have to unplug and then plug it back in again the usb hub broke happens just try a new one remote debugging i e adb connect disconnects while im working if youre using stf locally the most common cause is that youre not filtering the devices stf is allowed to connect to the problem is that once you do adb connect stf sees a new device and tries to set it up unfortunately since its already connected via usb setting up the new device causes the worker process handling the original usb device to fail this is not a problem in production since the devices should be connected to an entirely different machine anyway for development its a bit inconvenient what you can do is give stf local a list of serials you wish to use for example if your devices serial is 0123456789abcdef use stf local 0123456789abcdef now you can use adb connect and stf will ignore the new device theres another likely cause if youre running stf locally even if you whitelist devices by serial in stf your ide e g android studio doesnt know anything about that from the ides point of view you have two devices connected when you try to run or debug your application android studio suddenly notices that two devices are now providing jdwp connections and tries to connect to them both this doesnt really work since the debugger will only allow one simultaneous connection which causes problems with adb it then decides to disconnect the device or sometimes itself entirely one more sad possibility is that your android studio likes to restart adb behind the scenes even if you restart adb usb devices will soon reappear as theyre still connected the same is not true for remote devices as adb never stores the list anywhere this can sometimes also happen with the android device monitor monitor recommended hardware this is a list of components we are currently using and are proven to work pc components these components are for the pc where the usb devices are connected our operating system of choice is coreos but any other linux or bsd distribution should do fine be sure to use reasonably recent kernels though as they often include improvements for the usb subsystem our currently favorite build is as follows it will be able to provide 28 devices using powered usb hubs and about 10 more if youre willing to use the motherboards usb ports which is usually not recommended for stability reasons note that our component selection is somewhat limited by their availability in japan component recommendation how many pc case xigmatek nebula x1 motherboard asus h97i plus x1 processor intel® core™ i5 4460 x1 psu corsair cx series™ modular cx430m atx power supply x1 memory your favorite ddr3 1600 mhz 8gb stick x1 ssd a data premier pro sp900 64gb ssd x1 usb extension card startech com 4 port pci express pcie superspeed usb 3 0 card adapter w 4 dedicated 5gbps channels uasp sata lp4 power x1 usb hub plugable usb 2 0 7 port hub with 60w power adapter x4 microusb cable monoprice com 1 5ft usb 2 0 a male to micro 5pin male 28 24awg cable w ferrite core gold plated x28 you may also need extension cords for power alternatively if you find that some of your older devices do not support the recommended hub you may wish to mix the hub selection as follows component recommendation how many usb hub plugable usb 2 0 7 port hub with 60w power adapter x2 usb hub for older devices system talks usb2 hub4xa bk x2 4 you can connect up to two of the older hubs providing up to 8 devices total directly to the motherboard without exhausting usb host controller resources we also have several budget builds with an msi am1i motherboard and an amd athlon 5350 4 core processor these builds while significantly cheaper sometimes completely lose the usb pcie extension cards and even a reboot will not always fix it this may normally be fixable via bios usb settings but unfortunately the budget motherboard has a complete lack of any useful options fortunately the amd processor does not share intels haswell usb host control resource problem so you can also just connect your hubs to the motherboard directly if you dont mind sharing the root bus below is an incomplete list of some of the components we have tried so far including unsuitable ones tested equipment note that our hardware score ratings only reflect their use for the purposes of this project and are not an overall statement about the quality of the product usb extension cards name score short explanation startech com 4 port pci express pcie superspeed usb 3 0 card adapter w 4 dedicated 5gbps channels uasp sata lp4 power 9 10 reliable well supported chipset and good power connections startech com 4 independent port pci express usb 2 0 adapter card 8 10 reliable 玄人志向 usb3 0rx4 p4 pcie 4 10 well supported chipset but breaks very easily our current recommendation is startech coms pexusb3s44v it provides an independent renesas allegedly linux friendliest µpd720202 host controller for each port another option from the same maker is pexusb400 which also works great but may offer slightly less future proofing our 玄人志向 usb3 0rx4 p4 pcie cards have been nothing but trouble and weve mostly phased them out by now chipset wise its pretty much the same thing as startechs offering but the sata power connector is awfully flimsy and can actually physically break off the card is also incredibly sensitive to static electricity and will permanently brick itself which happened on numerous occasions usb hubs name score short explanation plugable usb 2 0 7 port hub with 60w power adapter 8 10 high power output high reliability plugable usb 3 0 7 port charging hub with 60w power adapter 5 10 high power output low reliability system talks usb2 hub4xa bk usb 2 0 hub with power adapter 7 10 high power output on two ports which complicates device positioning low port count anker usb 3 0 9 port hub 5v 2 1a charging port 2 10 high port count insufficient power orico p10 u2 external abs 10 port 2 0 usb hub for laptop desktop black 3 10 high port count insufficient power orico bh4 u3 bk abs 4 port usb3 0 bc1 2 charging hub with 12v3a power adapter black 5 10 high power output low reliability the best hub weve found so far is plugables usb 2 0 7 port hub with 60w power adapter its able to provide 1 5a per port for battery charging spec compliant devices which is enough to both charge and sync even tablets although charging will not occur at maximum speed but thats irrelevant to us note that even devices that are not compliant will usually charge and sync just fine albeit slower the more recent usb 3 0 version has proven unreliable with the rest of our components causing the whole hub to disconnect at times annoyingly the ports face the opposite direction too note that orico also provides hubs that are identical to plugables offerings the latter of which seem to be rebrands unfortunately plugables usb 2 0 hub is not perfect either at least for our purposes it includes a physical on off switch which can be especially annoying if your devices are in a regular office with occasional scheduled power outages this will shut down the pc too of course but the problem is that once power comes back online the hubs will be unable to switch themselves on and the devices wont charge leading you to find a bunch of dead devices the next monday the system talks usb 2 0 hub is very reliable but has a few annoying drawbacks first the power adapter only provides power to two of its four ports while the other two are powered by the host pc the problem with this approach is that you must figure out which devices are power hungry yourself and put them on the ports with higher current this can complicate device setup positioning quite a bit another drawback is that if the host pc is turned off only the powered ports will keep charging the connected devices however the hub is amazingly compatible with pretty much anything making it the top choice for older devices that do not support the battery charging hubs most powered usb 3 0 hubs weve tested have had a serious problem the whole hub occasionally disconnected this may have been caused by the specific combination of our components and or os but as of yet we dont really know disabling usb 3 0 may help if you run into the same problem translating currently stf ui is available in english and japanese if you would like translate to any other language please contribute in the stf transifex project for updating the source and all the translation files first you have to install the transifex client then just run bash gulp translate it will do the following convert all the jade files to html extract with gettext all translatable strings to stf pot push stf pot to transifex pull from transifex all po translations compile all po files to json then in order to add it officially only needs to be done once add the language to res common lang langs json pull the specific language tx pull l lang run gulp translate testing see testing md contributing see contributing md license see license copyright © 2017 the openstf project all rights reserved