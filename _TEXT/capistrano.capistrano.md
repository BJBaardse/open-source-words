capistrano a deployment automation tool built on ruby rake and ssh capistrano is a framework for building automated deployment scripts although capistrano itself is written in ruby it can easily be used to deploy projects of any language or framework be it rails java or php once installed capistrano gives you a cap tool to perform your deployments from the comfort of your command line cd my capistrano enabled project cap production deploy when you run cap capistrano dutifully connects to your server s via ssh and executes the steps necessary to deploy your project you can define those steps yourself by writing rake tasks or by using pre built task libraries provided by the capistrano community tasks are simple to make heres an example ruby task restart sidekiq do on roles worker do execute service sidekiq restart end end after deploy published restart sidekiq note this documentation is for the current version of capistrano 3 x if you are looking for capistrano 2 x documentation you can find it in this archive contents features gotchas quick start finding help and documentation how to contribute license features there are many ways to automate deployments from simple rsync bash scripts to complex containerized toolchains capistrano sits somewhere in the middle it automates what you already know how to do manually with ssh but in a repeatable scalable fashion there is no magic here heres what makes capistrano great strong conventions capistrano defines a standard deployment process that all capistrano enabled projects follow by default you dont have to decide how to structure your scripts where deployed files should be placed on the server or how to perform common tasks capistrano has done this work for you multiple stages define your deployment once and then easily parameterize it for multiple stages environments e g qa staging and production no copy and paste necessary you only need to specify what is different for each stage like ip addresses parallel execution deploying to a fleet of app servers capistrano can run each deployment task concurrently across those servers and uses connection pooling for speed server roles your application may need many different types of servers a database server an app server two web servers and a job queue work server for example capistrano lets you tag each server with one or more roles so you can control what tasks are executed where community driven capistrano is easily extensible using the rubygems package manager deploying a rails app wordpress laravel chances are someone has already written capistrano tasks for your framework of choice and has distributed it as a gem many ruby projects also come with capistrano tasks built in its just ssh everything in capistrano comes down to running ssh commands on remote servers on the one hand that makes capistrano simple on the other hand if you arent comfortable ssh ing into a linux box and doing stuff on the command line then capistrano is probably not for you gotchas while capistrano ships with a strong set of conventions that are common for all types of deployments it needs help understanding the specifics of your project and there are some things capistrano is not suited to do project specifics out of the box capistrano can deploy your code to server s but it does not know how to execute your code does foreman need to be run does apache need to be restarted youll need to tell capistrano how to do this part by writing these deployment steps yourself or by finding a gem in the capistrano community that does it for you key based ssh capistrano depends on connecting to your server s with ssh using key based i e password less authentication youll need this working before you can use capistrano provisioning likewise your server s will likely need supporting software installed before you can perform a deployment capistrano itself has no requirements other than ssh but your application probably needs database software a web server like apache or nginx and a language runtime like java ruby or php these server provisioning steps are not done by capistrano sudo etc capistrano is designed to deploy using a single non privileged ssh user using a non interactive ssh session if your deployment requires sudo interactive prompts authenticating as one user but running commands as another you can probably accomplish this with capistrano but it may be difficult your automated deployments will be much smoother if you can avoid such requirements shells capistrano 3 expects a posix shell like bash or sh shells like tcsh csh and such may work but probably will not quick start requirements ruby version 2 0 or higher on your local machine mri or rubinius a project that uses source control git mercurial and subversion support is built in the scm binaries e g git hg needed to check out your project must be installed on the server s you are deploying to bundler along with a gemfile for your project are recommended install the capistrano gem add capistrano to your projects gemfile using require false ruby group development do gem capistrano 3 11 require false end then run bundler to ensure capistrano is downloaded and installed sh bundle install capify your project make sure your project doesnt already have a capfile or capfile present then run sh bundle exec cap install this creates all the necessary configuration files and directory structure for a capistrano enabled project with two stages staging and production ├── capfile ├── config │ ├── deploy │ │ ├── production rb │ │ └── staging rb │ └── deploy rb └── lib └── capistrano └── tasks to customize the stages that are created use sh bundle exec cap install stages local sandbox qa production note that the files that capistrano creates are simply templates to get you started make sure to edit the deploy rb and stage files so that they contain values appropriate for your project and your target servers command line usage sh list all available tasks bundle exec cap t deploy to the staging environment bundle exec cap staging deploy deploy to the production environment bundle exec cap production deploy simulate deploying to the production environment does not actually do anything bundle exec cap production deploy dry run list task dependencies bundle exec cap production deploy prereqs trace through task invocations bundle exec cap production deploy trace lists all config variable before deployment tasks bundle exec cap production deploy print config variables finding help and documentation capistrano is a large project encompassing multiple github repositories and a community of plugins and it can be overwhelming when you are just getting started here are resources that can help the docs directory contains the official documentation and is used to generate the capistrano website stack overflow has a capistrano tag with lots of activity the capistrano mailing list is low traffic but is monitored by capistrano contributors codersclan has capistrano experts available to solve problems for bounties related github repositories capistrano sshkit provides the ssh behavior that underlies capistrano when you use execute in a capistrano task you are using sshkit capistrano rails is a very popular gem that adds ruby on rails deployment tasks mattbrictson airbrussh provides capistranos default log formatting github issues are for bug reports and feature requests please refer to the contributing document for guidelines on submitting github issues if you think you may have discovered a security vulnerability in capistrano do not open a github issue instead please send a report to security capistranorb com how to contribute contributions to capistrano in the form of code documentation or idea are gladly accepted read the development document to learn how to hack on capistranos code run the tests and contribute your first pull request license mit license mit copyright c 2012 2018 tom clements lee hambley permission is hereby granted free of charge to any person obtaining a copy of this software and associated documentation files the software to deal in the software without restriction including without limitation the rights to use copy modify merge publish distribute sublicense and or sell copies of the software and to permit persons to whom the software is furnished to do so subject to the following conditions the above copyright notice and this permission notice shall be included in all copies or substantial portions of the software the software is provided as is without warranty of any kind express or implied including but not limited to the warranties of merchantability fitness for a particular purpose and noninfringement in no event shall the authors or copyright holders be liable for any claim damages or other liability whether in an action of contract tort or otherwise arising from out of or in connection with the software or the use or other dealings in the software