flame graphs visualize profiled code main website http www brendangregg com flamegraphs html example click to zoom other sites the flame graph article in acmq and cacm http queue acm org detail cfm id 2927301 http cacm acm org magazines 2016 6 202665 the flame graph abstract cpu profiling using linux perf events dtrace systemtap or ktap http www brendangregg com flamegraphs cpuflamegraphs html cpu profiling using xcode instruments http schani wordpress com 2012 11 16 flame graphs for instruments cpu profiling using xperf exe http randomascii wordpress com 2013 03 26 summarizing xperf cpu usage with flame graphs memory profiling http www brendangregg com flamegraphs memoryflamegraphs html other examples updates and news http www brendangregg com flamegraphs html updates flame graphs can be created in three steps capture stacks fold stacks flamegraph pl 1 capture stacks stack samples can be captured using linux perf events freebsd pmcstat hwpmc dtrace systemtap and many other profilers see the stackcollapse converters linux perf events using linux perf events aka perf to capture 60 seconds of 99 hertz stack samples both user and kernel level stacks all processes perf record f 99 a g sleep 60 perf script out perf now only capturing pid 181 perf record f 99 p 181 g sleep 60 perf script out perf dtrace using dtrace to capture 60 seconds of kernel stacks at 997 hertz dtrace x stackframes 100 n profile 997 arg0 stack count tick 60s exit 0 o out kern stacks using dtrace to capture 60 seconds of user level stacks for pid 12345 at 97 hertz dtrace x ustackframes 100 n profile 97 pid 12345 arg1 ustack count tick 60s exit 0 o out user stacks 60 seconds of user level stacks including time spent in kernel for pid 12345 at 97 hertz dtrace x ustackframes 100 n profile 97 pid 12345 ustack count tick 60s exit 0 o out user stacks switch ustack for jstack if the application has a ustack helper to include translated frames eg node js frames see http dtrace org blogs dap 2012 01 05 where does your node program spend its time the rate for user level stack collection is deliberately slower than kernel which is especially important when using jstack as it performs additional work to translate frames 2 fold stacks use the stackcollapse programs to fold stack samples into single lines the programs provided are stackcollapse pl for dtrace stacks stackcollapse perf pl for linux perf events perf script output stackcollapse pmc pl for freebsd pmcstat g stacks stackcollapse stap pl for systemtap stacks stackcollapse instruments pl for xcode instruments stackcollapse vtune pl for intel vtune profiles stackcollapse ljp awk for lightweight java profiler stackcollapse jstack pl for java jstack 1 output stackcollapse gdb pl for gdb 1 stacks stackcollapse go pl for golang pprof stacks stackcollapse vsprof pl for microsoft visual studio profiles usage example for perf events stackcollapse perf pl out perf out folded for dtrace stackcollapse pl out kern stacks out kern folded the output looks like this unix sys sysenter post swapgs 1401 unix sys sysenter post swapgs genunix close 5 unix sys sysenter post swapgs genunix close genunix closeandsetf 85 unix sys sysenter post swapgs genunix close genunix closeandsetf c2audit audit closef 26 unix sys sysenter post swapgs genunix close genunix closeandsetf c2audit audit setf 5 unix sys sysenter post swapgs genunix close genunix closeandsetf genunix audit getstate 6 unix sys sysenter post swapgs genunix close genunix closeandsetf genunix audit unfalloc 2 unix sys sysenter post swapgs genunix close genunix closeandsetf genunix closef 48 3 flamegraph pl use flamegraph pl to render a svg flamegraph pl out kern folded kernel svg an advantage of having the folded input file and why this is separate to flamegraph pl is that you can use grep for functions of interest eg grep cpuid out kern folded flamegraph pl cpuid svg provided examples linux perf events an example output from linux perf script is included gzipd as example perf stacks txt gz the resulting flame graph is example perf svg you can create this using gunzip c example perf stacks txt gz stackcollapse perf pl all flamegraph pl color java hash example perf svg this shows my typical workflow ill gzip profiles on the target then copy them to my laptop for analysis since i have hundreds of profiles i leave them gzipd since this profile included java i used the flamegraph pl color java palette ive also used stackcollapse perf pl all which includes all annotations that help flamegraph pl use separate colors for kernel and user level code the resulting flame graph uses green java yellow c red user mode native orange kernel this profile was from an analysis of vert x performance the benchmark client wrk is also visible in the flame graph dtrace an example output from dtrace is also included example dtrace stacks txt and the resulting flame graph example dtrace svg you can generate this using stackcollapse pl example stacks txt flamegraph pl example svg this was from a particular performance investigation the flame graph identified that cpu time was spent in the lofs module and quantified that time options see the usage message help for options usage flamegraph pl options infile outfile svg title change title text width width of image default 1200 height height of each frame default 16 minwidth omit smaller functions default 0 1 pixels fonttype font type default verdana fontsize font size default 12 countname count type label default samples nametype name type label default function colors set color palette choices are hot default mem io wakeup chain java js perl red green blue aqua yellow purple orange hash colors are keyed by function name hash cp use consistent palette palette map reverse generate stack reversed flame graph inverted icicle graph negate switch differential hues blue red help this message eg flamegraph pl title flame graph malloc trace txt graph svg as suggested in the example flame graphs can process traces of any event such as malloc s provided stack traces are gathered consistent palette if you use the cp option it will use the colors selection and randomly generate the palette like normal any future flamegraphs created using the cp option will use the same palette map any new symbols from future flamegraphs will have their colors randomly generated using the colors selection if you dont like the palette just delete the palette map file this allows your to change your colorscheme between flamegraphs to make the differences really stand out example say we have 2 captures one with a problem and one when it was working whatever it is cat working folded flamegraph pl cp working svg this generates a palette map as per the normal random generated look cat broken folded flamegraph pl cp colors mem broken svg this svg will use the same palette map for the same events but a very different colorscheme for any new events take a look at the demo directory for an example palette example working svg palette example broken svg