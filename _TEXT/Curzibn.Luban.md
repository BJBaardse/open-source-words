luban book english documentation luban（鲁班） —— android图片压缩工具，仿微信朋友圈压缩策略。 项目描述 目前做app开发总绕不开图片这个元素。但是随着手机拍照分辨率的提升，图片的压缩成为一个很重要的问题。单纯对图片进行裁切，压缩已经有很多文章介绍。但是裁切成多少，压缩成多少却很难控制好，裁切过头图片太小，质量压缩过头则显示效果太差。 于是自然想到app巨头“微信”会是怎么处理，luban（鲁班）就是通过在微信朋友圈发送近100张不同分辨率图片，对比原图与微信压缩后的图片逆向推算出来的压缩算法。 因为有其他语言也想要实现luban，所以描述了一遍算法步骤。 因为是逆向推算，效果还没法跟微信一模一样，但是已经很接近微信朋友圈压缩后的效果，具体看以下对比！ 效果与对比 内容 原图 luban wechat 截屏 720p 7201280 390k 7201280 87k 7201280 56k 截屏 1080p 10801920 2 21m 10801920 104k 10801920 112k 拍照 13m 4 3 30964128 3 12m 15482064 141k 15482064 147k 拍照 9 6m 16 9 41282322 4 64m 1032581 97k 1032581 74k 滚动截屏 10806433 1 56m 10806433 351k 1080 6433 482k 导入 sh implementation top zibin luban 1 1 7 使用 方法列表 方法 描述 load 传入原图 filter 设置开启压缩条件 ignoreby 不压缩的阈值，单位为k setfocusalpha 设置是否保留透明通道 settargetdir 缓存压缩图片路径 setcompresslistener 压缩回调接口 setrenamelistener 压缩前重命名接口 异步调用 luban内部采用io线程进行图片压缩，外部调用只需设置好结果监听即可： java luban with this load photos ignoreby 100 settargetdir getpath filter new compressionpredicate override public boolean apply string path return textutils isempty path path tolowercase endswith gif setcompresslistener new oncompresslistener override public void onstart todo 压缩开始前调用，可以在方法内启动 loading ui override public void onsuccess file file todo 压缩成功后调用，返回压缩后的图片文件 override public void onerror throwable e todo 当压缩过程出现问题时调用 launch 同步调用 同步方法请尽量避免在主线程调用以免阻塞主线程，下面以rxjava调用为例 java flowable just photos observeon schedulers io map new function list string list file override public list file apply nonnull list string list throws exception 同步方法直接返回压缩后的文件 return luban with mainactivity this load list get observeon androidschedulers mainthread subscribe release note here license copyright 2016 zheng zibin licensed under the apache license version 2 0 the license you may not use this file except in compliance with the license you may obtain a copy of the license at http www apache org licenses license 2 0 unless required by applicable law or agreed to in writing software distributed under the license is distributed on an as is basis without warranties or conditions of any kind either express or implied see the license for the specific language governing permissions and limitations under the license