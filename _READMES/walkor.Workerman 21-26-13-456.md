workerman what is it workerman is an asynchronous event driven php framework with high performance for easily building fast scalable network applications supports http websocket ssl and other custom protocols supports libevent hhvm reactphp requires php 5 3 or higher a posix compatible operating system linux osx bsd posix and pcntl extensions for php installation composer require workerman workerman basic usage a websocket server php php require once dir vendor autoload php use workerman\worker create a websocket server ws worker new worker websocket 0 0 0 0 2346 4 processes ws worker count 4 emitted when new connection come ws worker onconnect function connection echo new connection\n emitted when data received ws worker onmessage function connection data send hello data connection send hello data emitted when connection closed ws worker onclose function connection echo connection closed\n run worker worker runall an http server php require once dir vendor autoload php use workerman\worker http worker http worker new worker http 0 0 0 0 2345 4 processes http worker count 4 emitted when data received http worker onmessage function connection data get post cookie session server files are available var dump get post cookie session server files send data to client connection send hello world \n run all workers worker runall a webserver php require once dir vendor autoload php use workerman\webserver use workerman\worker webserver web new webserver http 0 0 0 0 80 4 processes web count 4 set the root of domains web addroot www your domain com your path web web addroot www another domain com another path web run all workers worker runall a tcp server php require once dir vendor autoload php use workerman\worker create socket and listen 1234 port tcp worker new worker tcp 0 0 0 0 1234 4 processes tcp worker count 4 emitted when new connection come tcp worker onconnect function connection echo new connection\n emitted when data received tcp worker onmessage function connection data send data to client connection send hello data \n emitted when new connection come tcp worker onclose function connection echo connection closed\n worker runall enable ssl php php require once dir vendor autoload php use workerman\worker ssl context context array ssl array local cert your path of server pem local pk your path of server key verify peer false create a websocket server with ssl context ws worker new worker websocket 0 0 0 0 2346 context enable ssl websocket ssl means that secure websocket wss the similar approaches for https etc ws worker transport ssl ws worker onmessage function connection data send hello data connection send hello data worker runall custom protocol protocols mytextprotocol php php namespace protocols user defined protocol format text \n class mytextprotocol public static function input recv buffer find the position of the first occurrence of \n pos strpos recv buffer \n not a complete package return 0 because the length of package can not be calculated if pos false return 0 return length of the package return pos 1 public static function decode recv buffer return trim recv buffer public static function encode data return data \n php require once dir vendor autoload php use workerman\worker mytextprotocol worker text worker new worker mytextprotocol 0 0 0 0 5678 text worker onconnect function connection echo new connection\n text worker onmessage function connection data send data to client connection send hello world \n text worker onclose function connection echo connection closed\n run all workers worker runall timer php require once dir vendor autoload php use workerman\worker use workerman\lib\timer task new worker task onworkerstart function task 2 5 seconds time interval 2 5 timer id timer add time interval function echo timer run\n run all workers worker runall asynctcpconnection tcp ws text frame etc php require once dir vendor autoload php use workerman\worker use workerman\connection\asynctcpconnection worker new worker worker onworkerstart function websocket protocol for client ws connection new asynctcpconnection ws echo websocket org 80 ws connection onconnect function connection connection send hello ws connection onmessage function connection data echo recv data\n ws connection onerror function connection code msg echo error msg\n ws connection onclose function connection echo connection closed\n ws connection connect worker runall async mysql of reactphp composer require react mysql php php require once dir vendor autoload php use workerman\worker worker new worker tcp 0 0 0 0 6161 worker onworkerstart function global mysql loop worker geteventloop mysql new react\mysql\connection loop array host 127 0 0 1 dbname dbname user user passwd passwd mysql on error function e echo e mysql connect function e if e echo e else echo connect success\n worker onmessage function connection data global mysql mysql query show databases trim data function command mysql use connection if command haserror error command geterror else results command resultrows fields command resultfields connection send json encode results worker runall async redis of reactphp composer require clue redis react php php require once dir vendor autoload php use clue\react\redis\factory use clue\react\redis\client use workerman\worker worker new worker tcp 0 0 0 0 6161 worker onworkerstart function global factory loop worker geteventloop factory new factory loop worker onmessage function connection data global factory factory createclient localhost 6379 then function client client use connection client set greeting hello world client append greeting client get greeting then function greeting use connection hello world echo greeting php eol connection send greeting client incr invocation then function n use connection echo this is invocation n php eol connection send n worker runall aysnc dns of reactphp composer require react dns php require once dir vendor autoload php use workerman\worker worker new worker tcp 0 0 0 0 6161 worker onworkerstart function global dns get event loop loop worker geteventloop factory new react\dns\resolver\factory dns factory create 8 8 8 8 loop worker onmessage function connection host global dns host trim host dns resolve host then function ip use host connection connection send host ip function e use host connection connection send host e getmessage worker runall http client of reactphp composer require react http client php php require once dir vendor autoload php use workerman\worker worker new worker tcp 0 0 0 0 6161 worker onmessage function connection host loop worker geteventloop client new \react\httpclient\client loop request client request get trim host request on error function exception e use connection connection send e request on response function response use connection response on data function data use connection connection send data request end worker runall zmq of reactphp composer require react zmq php php require once dir vendor autoload php use workerman\worker worker new worker text 0 0 0 0 6161 worker onworkerstart function global pull loop worker geteventloop context new react\zmq\context loop pull context getsocket zmq socket pull pull bind tcp 127 0 0 1 5555 pull on error function e var dump e getmessage pull on message function msg echo received msg\n worker runall stomp of reactphp composer require react stomp php php require once dir vendor autoload php use workerman\worker worker new worker text 0 0 0 0 6161 worker onworkerstart function global client loop worker geteventloop factory new react\stomp\factory loop client factory createclient array vhost login guest passcode guest client connect then function client use loop client subscribe topic foo function frame echo message received frame body \n worker runall available commands php start php start php start php start d php start php status php start php connections php start php stop php start php restart php start php reload documentation 中文主页 http www workerman net 中文文档 http doc workerman net documentation https github com walkor workerman manual benchmarks cpu intel r core tm i3 3220 cpu 3 30ghz and 4 processors totally memory 8g os ubuntu 14 04 lts software ab php 5 5 9 codes php php use workerman\worker worker new worker tcp 0 0 0 0 1234 worker count 3 worker onmessage function connection data connection send http 1 1 200 ok\r\nconnection keep alive\r\nserver workerman\r\ncontent length 5\r\n\r\nhello worker runall result shell ab n1000000 c100 k http 127 0 0 1 1234 this is apachebench version 2 3 revision 1528965 copyright 1996 adam twiss zeus technology ltd http www zeustech net licensed to the apache software foundation http www apache org benchmarking 127 0 0 1 be patient completed 100000 requests completed 200000 requests completed 300000 requests completed 400000 requests completed 500000 requests completed 600000 requests completed 700000 requests completed 800000 requests completed 900000 requests completed 1000000 requests finished 1000000 requests server software workerman 3 1 4 server hostname 127 0 0 1 server port 1234 document path document length 5 bytes concurrency level 100 time taken for tests 7 240 seconds complete requests 1000000 failed requests 0 keep alive requests 1000000 total transferred 73000000 bytes html transferred 5000000 bytes requests per second 138124 14 sec mean time per request 0 724 ms mean time per request 0 007 ms mean across all concurrent requests transfer rate 9846 74 kbytes sec received connection times ms min mean sd median max connect 0 0 0 0 0 5 processing 0 1 0 2 1 9 waiting 0 1 0 2 1 9 total 0 1 0 2 1 9 percentage of the requests served within a certain time ms 50 1 66 1 75 1 80 1 90 1 95 1 98 1 99 1 100 9 longest request other links with workerman phpsocket io php socks5 php http proxy donate license workerman is released under the mit license