ws a node js websocket library ws is a simple to use blazing fast and thoroughly tested websocket client and server implementation passes the quite extensive autobahn test suite server client note this module does not work in the browser the client in the docs is a reference to a back end with the role of a client in the websocket communication browser clients must use the native websocket object to make the same code work seamlessly on node js and the browser you can use one of the many wrappers available on npm like isomorphic ws table of contents protocol support installing opt in for performance and spec compliance api docs websocket compression usage examples sending and receiving text data sending binary data simple server external http s server multiple servers sharing a single http s server server broadcast echo websocket org demo other examples error handling best practices faq how to get the ip address of the client how to detect and close broken connections how to connect via a proxy changelog license protocol support hybi drafts 07 12 use the option protocolversion 8 hybi drafts 13 17 current default alternatively option protocolversion 13 installing npm install save ws opt in for performance and spec compliance there are 2 optional modules that can be installed along side with the ws module these modules are binary addons which improve certain operations prebuilt binaries are available for the most popular platforms so you dont necessarily need to have a c compiler installed on your machine npm install save optional bufferutil allows to efficiently perform operations such as masking and unmasking the data payload of the websocket frames npm install save optional utf 8 validate allows to efficiently check if a message contains valid utf 8 as required by the spec api docs see doc ws md for node js like docs for the ws classes websocket compression ws supports the permessage deflate extension which enables the client and server to negotiate a compression algorithm and its parameters and then selectively apply it to the data payloads of each websocket message the extension is disabled by default on the server and enabled by default on the client it adds a significant overhead in terms of performance and memory consumption so we suggest to enable it only if it is really needed note that node js has a variety of issues with high performance compression where increased concurrency especially on linux can lead to catastrophic memory fragmentation and slow performance if you intend to use permessage deflate in production it is worthwhile to set up a test representative of your workload and ensure node js zlib will handle it with acceptable performance and memory usage tuning of permessage deflate can be done via the options defined below you can also use zlibdeflateoptions and zlibinflateoptions which is passed directly into the creation of raw deflate inflate streams see the docs for more options js const websocket require ws const wss new websocket server port 8080 permessagedeflate zlibdeflateoptions see zlib defaults chunksize 1024 memlevel 7 level 3 zlibinflateoptions chunksize 10 1024 other options settable clientnocontexttakeover true defaults to negotiated value servernocontexttakeover true defaults to negotiated value clientmaxwindowbits 10 defaults to negotiated value servermaxwindowbits 10 defaults to negotiated value below options specified as default values concurrencylimit 10 limits zlib concurrency for perf threshold 1024 size in bytes below which messages should not be compressed the client will only use the extension if it is supported and enabled on the server to always disable the extension on the client set the permessagedeflate option to false js const websocket require ws const ws new websocket ws www host com path permessagedeflate false usage examples sending and receiving text data js const websocket require ws const ws new websocket ws www host com path ws on open function open ws send something ws on message function incoming data console log data sending binary data js const websocket require ws const ws new websocket ws www host com path ws on open function open const array new float32array 5 for var i 0 i array length i array i i 2 ws send array simple server js const websocket require ws const wss new websocket server port 8080 wss on connection function connection ws ws on message function incoming message console log received s message ws send something external http s server js const fs require fs const https require https const websocket require ws const server new https createserver cert fs readfilesync path to cert pem key fs readfilesync path to key pem const wss new websocket server server wss on connection function connection ws ws on message function incoming message console log received s message ws send something server listen 8080 multiple servers sharing a single http s server js const http require http const websocket require ws const server http createserver const wss1 new websocket server noserver true const wss2 new websocket server noserver true wss1 on connection function connection ws wss2 on connection function connection ws server on upgrade function upgrade request socket head const pathname url parse request url pathname if pathname foo wss1 handleupgrade request socket head function done ws wss1 emit connection ws request else if pathname bar wss2 handleupgrade request socket head function done ws wss2 emit connection ws request else socket destroy server listen 8080 server broadcast js const websocket require ws const wss new websocket server port 8080 broadcast to all wss broadcast function broadcast data wss clients foreach function each client if client readystate websocket open client send data wss on connection function connection ws ws on message function incoming data broadcast to everyone else wss clients foreach function each client if client ws client readystate websocket open client send data echo websocket org demo js const websocket require ws const ws new websocket wss echo websocket org origin https websocket org ws on open function open console log connected ws send date now ws on close function close console log disconnected ws on message function incoming data console log roundtrip time date now data ms settimeout function timeout ws send date now 500 other examples for a full example with a browser client communicating with a ws server see the examples folder otherwise see the test cases error handling best practices js if the websocket is closed before the following send is attempted ws send something errors both immediate and async write errors can be detected in an optional callback the callback is also the only way of being notified that data has actually been sent ws send something function ack error if error is not defined the send has been completed otherwise the error object will indicate what failed immediate errors can also be handled with try catch but note that since sends are inherently asynchronous socket write failures will not be captured when this technique is used try ws send something catch e handle error faq how to get the ip address of the client the remote ip address can be obtained from the raw socket js const websocket require ws const wss new websocket server port 8080 wss on connection function connection ws req const ip req connection remoteaddress when the server runs behind a proxy like nginx the de facto standard is to use the x forwarded for header js wss on connection function connection ws req const ip req headers x forwarded for split \s \s 0 how to detect and close broken connections sometimes the link between the server and the client can be interrupted in a way that keeps both the server and the client unaware of the broken state of the connection e g when pulling the cord in these cases ping messages can be used as a means to verify that the remote endpoint is still responsive js const websocket require ws const wss new websocket server port 8080 function noop function heartbeat this isalive true wss on connection function connection ws ws isalive true ws on pong heartbeat const interval setinterval function ping wss clients foreach function each ws if ws isalive false return ws terminate ws isalive false ws ping noop 30000 pong messages are automatically sent in response to ping messages as required by the spec how to connect via a proxy use a custom http agent implementation like https proxy agent or socks proxy agent changelog were using the github releases for changelog entries license mit