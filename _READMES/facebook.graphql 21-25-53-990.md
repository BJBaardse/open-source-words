graphql the graphql specification is edited in the markdown files found in spec the latest release of which is published at http facebook github io graphql the latest draft specification can be found at http facebook github io graphql draft which tracks the latest commit to the master branch in this repository previous releases of the graphql specification can be found at permalinks that match their release tag for example http facebook github io graphql october2016 if you are linking directly to the graphql specification its best to link to a tagged permalink for the particular referenced version overview this is a working draft of the specification for graphql a query language for apis created by facebook the target audience for this specification is not the client developer but those who have or are actively interested in building their own graphql implementations and tools in order to be broadly adopted graphql will have to target a wide variety of backends frameworks and languages which will necessitate a collaborative effort across projects and organizations this specification serves as a point of coordination for this effort looking for help find resources from the community getting started graphql consists of a type system query language and execution semantics static validation and type introspection each outlined below to guide you through each of these components weve written an example designed to illustrate the various pieces of graphql this example is not comprehensive but it is designed to quickly introduce the core concepts of graphql to provide some context before diving into the more detailed specification or the graphql js reference implementation the premise of the example is that we want to use graphql to query for information about characters and locations in the original star wars trilogy type system at the heart of any graphql implementation is a description of what types of objects it can return described in a graphql type system and returned in the graphql schema for our star wars example the starwarsschema js file in graphql js defines this type system the most basic type in the system will be human representing characters like luke leia and han all humans in our type system will have a name so we define the human type to have a field called name this returns a string and we know that it is not null since all humans have a name so we will define the name field to be a non nullable string using a shorthand notation that we will use throughout the spec and documentation we would describe the human type as graphql type human name string this shorthand is convenient for describing the basic shape of a type system the javascript implementation is more full featured and allows types and fields to be documented it also sets up the mapping between the type system and the underlying data for a test case in graphql js the underlying data is a set of javascript objects but in most cases the backing data will be accessed through some service and this type system layer will be responsible for mapping from types and fields to that service a common pattern in many apis and indeed in graphql is to give objects an id that can be used to refetch the object so lets add that to our human type well also add a string for their home planet graphql type human id string name string homeplanet string since were talking about the star wars trilogy it would be useful to describe the episodes in which each character appears to do so well first define an enum which lists the three episodes in the trilogy graphql enum episode newhope empire jedi now we want to add a field to human describing what episodes they were in this will return a list of episodes graphql type human id string name string appearsin episode homeplanet string now lets introduce another type droid graphql type droid id string name string appearsin episode primaryfunction string now we have two types lets add a way of going between them humans and droids both have friends but humans can be friends with both humans and droids how do we refer to either a human or a droid if we look we note that theres common functionality between humans and droids they both have ids names and episodes in which they appear so well add an interface character and make both human and droid implement it once we have that we can add the friends field that returns a list of characters our type system so far is graphql enum episode newhope empire jedi interface character id string name string friends character appearsin episode type human implements character id string name string friends character appearsin episode homeplanet string type droid implements character id string name string friends character appearsin episode primaryfunction string one question we might ask though is whether any of those fields can return null by default null is a permitted value for any type in graphql since fetching data to fulfill a graphql query often requires talking to different services that may or may not be available however if the type system can guarantee that a type is never null then we can mark it as non null in the type system we indicate that in our shorthand by adding an after the type we can update our type system to note that the id is never null note that while in our current implementation we can guarantee that more fields are non null since our current implementation has hard coded data we didnt mark them as non null one can imagine we would eventually replace our hardcoded data with a backend service which might not be perfectly reliable by leaving these fields as nullable we allow ourselves the flexibility to eventually return null to indicate a backend error while also telling the client that the error occurred graphql enum episode newhope empire jedi interface character id string name string friends character appearsin episode type human implements character id string name string friends character appearsin episode homeplanet string type droid implements character id string name string friends character appearsin episode primaryfunction string were missing one last piece an entry point into the type system when we define a schema we define an object type that is the basis for all queries the name of this type is query by convention and it describes our public top level api our query type for this example will look like this graphql type query hero episode episode character human id string human droid id string droid in this example there are three top level operations that can be done on our schema hero returns the character who is the hero of the star wars trilogy it takes an optional argument that allows us to fetch the hero of a specific episode instead human accepts a non null string as a query argument a humans id and returns the human with that id droid does the same for droids these fields demonstrate another feature of the type system the ability for a field to specify arguments that configure their behavior when we package the whole type system together defining the query type above as our entry point for queries this creates a graphql schema this example just scratched the surface of the type system the specification goes into more detail about this topic in the type system section and the type directory in graphql js contains code implementing a specification compliant graphql type system query syntax graphql queries declaratively describe what data the issuer wishes to fetch from whoever is fulfilling the graphql query for our star wars example the starwarsquerytests js file in the graphql js repository contains a number of queries and responses that file is a test file that uses the schema discussed above and a set of sample data located in starwarsdata js this test file can be run to exercise the reference implementation an example query on the above schema would be graphql query heronamequery hero name the initial line query heronamequery defines a query with the operation name heronamequery that starts with the schemas root query type in this case query as defined above query has a hero field that returns a character so well query for that character then has a name field that returns a string so we query for that completing our query the result of this query would then be json hero name r2 d2 specifying the query keyword and an operation name is only required when a graphql document defines multiple operations we therefore could have written the previous query with the query shorthand graphql hero name assuming that the backing data for the graphql server identified r2 d2 as the hero the response continues to vary based on the request if we asked for r2 d2s id and friends with this query graphql query heronameandfriendsquery hero id name friends id name then well get back a response like this json hero id 2001 name r2 d2 friends id 1000 name luke skywalker id 1002 name han solo id 1003 name leia organa one of the key aspects of graphql is its ability to nest queries in the above query we asked for r2 d2s friends but we can ask for more information about each of those objects so lets construct a query that asks for r2 d2s friends gets their name and episode appearances then asks for each of their friends graphql query nestedquery hero name friends name appearsin friends name which will give us the nested response json hero name r2 d2 friends name luke skywalker appearsin newhope empire jedi friends name han solo name leia organa name c 3po name r2 d2 name han solo appearsin newhope empire jedi friends name luke skywalker name leia organa name r2 d2 name leia organa appearsin newhope empire jedi friends name luke skywalker name han solo name c 3po name r2 d2 the query type above defined a way to fetch a human given their id we can use it by hardcoding the id in the query graphql query fetchlukequery human id 1000 name to get json human name luke skywalker alternately we could have defined the query to have a query parameter graphql query fetchsomeidquery someid string human id someid name this query is now parameterized by someid to run it we must provide that id if we ran it with someid set to 1000 we would get luke set to 1002 we would get han if we passed an invalid id here we would get null back for the human indicating that no such object exists notice that the key in the response is the name of the field by default it is sometimes useful to change this key for clarity or to avoid key collisions when fetching the same field with different arguments we can do that with field aliases as demonstrated in this query graphql query fetchlukealiased luke human id 1000 name we aliased the result of the human field to the key luke now the response is json luke name luke skywalker notice the key is luke and not human as it was in our previous example where we did not use the alias this is particularly useful if we want to use the same field twice with different arguments as in the following query graphql query fetchlukeandleiaaliased luke human id 1000 name leia human id 1003 name we aliased the result of the first human field to the key luke and the second to leia so the result will be json luke name luke skywalker leia name leia organa now imagine we wanted to ask for luke and leias home planets we could do so with this query graphql query duplicatefields luke human id 1000 name homeplanet leia human id 1003 name homeplanet but we can already see that this could get unwieldy since we have to add new fields to both parts of the query instead we can extract out the common fields into a fragment and include the fragment in the query like this graphql query usefragment luke human id 1000 humanfragment leia human id 1003 humanfragment fragment humanfragment on human name homeplanet both of those queries give this result json luke name luke skywalker homeplanet tatooine leia name leia organa homeplanet alderaan the usefragment and duplicatefields queries will both get the same result but usefragment is less verbose if we wanted to add more fields we could add it to the common fragment rather than copying it into multiple places we defined the type system above so we know the type of each object in the output the query can ask for that type using the special field typename defined on every object graphql query checktypeofr2 hero typename name since r2 d2 is a droid this will return json hero typename droid name r2 d2 this was particularly useful because hero was defined to return a character which is an interface we might want to know what concrete type was actually returned if we instead asked for the hero of episode v graphql query checktypeofluke hero episode empire typename name we would find that it was luke who is a human json hero typename human name luke skywalker as with the type system this example just scratched the surface of the query language the specification goes into more detail about this topic in the language section and the language directory in graphql js contains code implementing a specification compliant graphql query language parser and lexer validation by using the type system it can be predetermined whether a graphql query is valid or not this allows servers and clients to effectively inform developers when an invalid query has been created without having to rely on runtime checks for our star wars example the file starwarsvalidationtests js contains a number of queries demonstrating various invalidities and is a test file that can be run to exercise the reference implementations validator to start lets take a complex valid query this is the nestedquery example from the above section but with the duplicated fields factored out into a fragment graphql query nestedquerywithfragment hero nameandappearances friends nameandappearances friends nameandappearances fragment nameandappearances on character name appearsin and this query is valid lets take a look at some invalid queries when we query for fields we have to query for a field that exists on the given type so as hero returns a character we have to query for a field on character that type does not have a favoritespaceship field so this query graphql invalid favoritespaceship does not exist on character query herospaceshipquery hero favoritespaceship is invalid whenever we query for a field and it returns something other than a scalar or an enum we need to specify what data we want to get back from the field hero returns a character and weve been requesting fields like name and appearsin on it if we omit that the query will not be valid graphql invalid hero is not a scalar so fields are needed query heronofieldsquery hero similarly if a field is a scalar it doesnt make sense to query for additional fields on it and doing so will make the query invalid graphql invalid name is a scalar so fields are not permitted query herofieldsonscalarquery hero name firstcharacterofname earlier it was noted that a query can only query for fields on the type in question when we query for hero which returns a character we can only query for fields that exist on character what happens if we want to query for r2 d2s primary function though graphql invalid primaryfunction does not exist on character query droidfieldoncharacter hero name primaryfunction that query is invalid because primaryfunction is not a field on character we want some way of indicating that we wish to fetch primaryfunction if the character is a droid and to ignore that field otherwise we can use the fragments we introduced earlier to do this by setting up a fragment defined on droid and including it we ensure that we only query for primaryfunction where it is defined graphql query droidfieldinfragment hero name droidfields fragment droidfields on droid primaryfunction this query is valid but its a bit verbose named fragments were valuable above when we used them multiple times but were only using this one once instead of using a named fragment we can use an inline fragment this still allows us to indicate the type we are querying on but without naming a separate fragment graphql query droidfieldininlinefragment hero name on droid primaryfunction this has just scratched the surface of the validation system there are a number of validation rules in place to ensure that a graphql query is semantically meaningful the specification goes into more detail about this topic in the validation section and the validation directory in graphql js contains code implementing a specification compliant graphql validator introspection its often useful to ask a graphql schema for information about what queries it supports graphql allows us to do so using the introspection system for our star wars example the file starwarsintrospectiontests js contains a number of queries demonstrating the introspection system and is a test file that can be run to exercise the reference implementations introspection system we designed the type system so we know what types are available but if we didnt we can ask graphql by querying the schema field always available on the root type of a query lets do so now and ask what types are available graphql query introspectiontypequery schema types name and we get back json schema types name query name character name human name string name episode name droid name schema name type name typekind name boolean name field name inputvalue name enumvalue name directive wow thats a lot of types what are they lets group them query character human episode droid these are the ones that we defined in our type system string boolean these are built in scalars that the type system provided schema type typekind field inputvalue enumvalue directive these all are preceded with a double underscore indicating that they are part of the introspection system now lets try and figure out a good place to start exploring what queries are available when we designed our type system we specified what type all queries would start at lets ask the introspection system about that graphql query introspectionquerytypequery schema querytype name and we get back json schema querytype name query and that matches what we said in the type system section that the query type is where we will start note that the naming here was just by convention we could have named our query type anything else and it still would have been returned here if we had specified it as the starting type for queries naming it query though is a useful convention it is often useful to examine one specific type lets take a look at the droid type graphql query introspectiondroidtypequery type name droid name and we get back json type name droid what if we want to know more about droid though for example is it an interface or an object graphql query introspectiondroidkindquery type name droid name kind and we get back json type name droid kind object kind returns a typekind enum one of whose values is object if we asked about character instead graphql query introspectioncharacterkindquery type name character name kind and we get back json type name character kind interface wed find that it is an interface its useful for an object to know what fields are available so lets ask the introspection system about droid graphql query introspectiondroidfieldsquery type name droid name fields name type name kind and we get back json type name droid fields name id type name null kind non null name name type name string kind scalar name friends type name null kind list name appearsin type name null kind list name primaryfunction type name string kind scalar those are our fields that we defined on droid id looks a bit weird there it has no name for the type thats because its a wrapper type of kind non null if we queried for oftype on that fields type we would find the string type there telling us that this is a non null string similarly both friends and appearsin have no name since they are the list wrapper type we can query for oftype on those types which will tell us what these are lists of graphql query introspectiondroidwrappedfieldsquery type name droid name fields name type name kind oftype name kind and we get back json type name droid fields name id type name null kind non null oftype name string kind scalar name name type name string kind scalar oftype null name friends type name null kind list oftype name character kind interface name appearsin type name null kind list oftype name episode kind enum name primaryfunction type name string kind scalar oftype null lets end with a feature of the introspection system particularly useful for tooling lets ask the system for documentation graphql query introspectiondroiddescriptionquery type name droid name description yields json type name droid description a mechanical creature in the star wars universe so we can access the documentation about the type system using introspection and create documentation browsers or rich ide experiences this has just scratched the surface of the introspection system we can query for enum values what interfaces a type implements and more we can even introspect on the introspection system itself the specification goes into more detail about this topic in the introspection section and the introspection file in graphql js contains code implementing a specification compliant graphql query introspection system additional content this readme walked through the graphql js reference implementations type system query execution validation and introspection systems theres more in both graphql js and specification including a description and implementation for executing queries how to format a response explaining how a type system maps to an underlying implementation and how to format a graphql response as well as the grammar for graphql