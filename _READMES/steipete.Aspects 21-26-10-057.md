aspects v1 4 2 a delightful simple library for aspect oriented programming by steipete think of aspects as method swizzling on steroids it allows you to add code to existing methods per class or per instance whilst thinking of the insertion point e g before instead after aspects automatically deals with calling super and is easier to use than regular method swizzling this is stable and used in hundreds of apps since its part of pspdfkit an ios pdf framework that ships with apps like dropbox or evernote and now i finally made it open source aspects extends nsobject with the following methods objc adds a block of code before instead after the currentselectorfor a specific class param block aspects replicates the type signature of the method being hooked the first parameter will beid followed by all parameters of the method these parameters are optional and will be filled to match the block signature you can even use an empty block or one that simple getsid note hooking static methods is not supported return a token which allows to later deregister the aspect id aspect hookselector sel selector withoptions aspectoptions options usingblock id block error nserror error adds a block of code before instead after the current selector for a specific instance id aspect hookselector sel selector withoptions aspectoptions options usingblock id block error nserror error deregister an aspect return yes if deregistration is successful otherwise no id aspect aspect remove adding aspects returns an opaque token of type aspecttoken which can be used to deregister again all calls are thread safe aspects uses objective c message forwarding to hook into messages this will create some overhead dont add aspects to methods that are called a lot aspects is meant for view controller code that is not called 1000 times per second aspects calls and matches block arguments blocks without arguments are supported as well the first block argument will be of type id aspectinfo when to use aspects aspect oriented programming aop is used to encapsulate cross cutting concerns these are the kind of requirements that cut across many modules in your system and so cannot be encapsulated using normal object oriented programming some examples of these kinds of requirements whenever a user invokes a method on the service client security should be checked whenever a user interacts with the store a genius suggestion should be presented based on their interaction all calls should be logged if we implemented the above requirements using regular oop thered be some drawbacks good oop says a class should have a single responsibility however adding on extra cross cutting requirements means a class that is taking on other responsibilites for example you might have a storeclient that is supposed to be all about making purchases from an online store add in some cross cutting requirements and it might also have to take on the roles of logging security and recommendations this is not great because our storeclient is now harder to understand and maintain these cross cutting requirements are duplicated and spread throughout our app aop lets us modularize these cross cutting requirements and then cleanly identify all of the places they should be applied as shown in the examples above cross cutting requirements can be either technical or business focused in nature here are some concrete examples aspects can be used to dynamically add logging for debug builds only objc uiviewcontroller aspect hookselector selector viewwillappear withoptions aspectpositionafter usingblock id aspectinfo aspectinfo bool animated nslog view controller will appear animated tu aspectinfo instance animated error null it can be used to greatly simplify your analytics setup https github com orta aranalytics you can check if methods are really being called in your test cases objc void testexample testclass testclass testclass new testclass testclass2 testclass new block bool testcallcalled no testclass aspect hookselector selector testcall withoptions aspectpositionafter usingblock testcallcalled yes error null testclass2 testcallandexecuteblock testclass testcall error null xctasserttrue testcallcalled calling testcallandexecuteblock must call testcall it can be really useful for debugging here i was curious when exactly the tap gesture changed state objc singletapgesture aspect hookselector selector setstate withoptions aspectpositionafter usingblock id aspectinfo aspectinfo nslog aspectinfo instance aspectinfo arguments error null another convenient use case is adding handlers for classes that you dont own ive written it for use in pspdfkit where we require notifications when a view controller is being dismissed modally this includes uikit view controllers like mfmailcomposeviewcontroller and uiimagepickercontroller we could have created subclasses for each of these controllers but this would be quite a lot of unnecessary code aspects gives you a simpler solution for this problem objc implementation uiviewcontroller dismissactionhook will add a dismiss action once the controller gets dismissed void pspdf addwilldismissaction void void action pspdfassert action null self aspect hookselector selector viewwilldisappear withoptions aspectpositionafter usingblock id aspectinfo aspectinfo if aspectinfo instance isbeingdismissed action error null end debugging aspects identifies itself nicely in the stack trace so its easy to see if a method has been hooked using aspects with non void return types you can use the invocation object to customize the return value objc pspdfdrawview aspect hookselector selector shouldprocesstouches withevent withoptions aspectpositioninstead usingblock id info nsset touches uievent event call original implementation bool processtouches nsinvocation invocation info originalinvocation invocation invoke invocation getreturnvalue processtouches if processtouches processtouches pspdf stylusshouldprocesstouches touches event invocation setreturnvalue processtouches error null installation the simplest option is to use pod aspects you can also add the two files aspects h m to your project there are no further requirements compatibility and limitations aspects uses quite some runtime trickery to achieve what it does you can mostly mix this with regular method swizzling an important limitation is that for class based hooking a method can only be hooked once within the subclass hierarchy see 2 this does not apply for objects that are hooked aspects creates a dynamic subclass here and has full control kvo works if observers are created after your calls aspect hookselector it most likely will crash the other way around still looking for workarounds here any help appreciated because of ugly implementation details on the objc runtime methods that return unions that also contain structs might not work correctly unless this code runs on the arm64 runtime credits the idea to use objc msgforward and parts of the nsinvocation argument selection is from the excellent reactivecocoa from the github guys this article explains how it works under the hood supported ios sdk versions aspects requires arc aspects is tested with ios 7 and os x 10 7 or higher license mit licensed copyright c 2014 peter steinberger steipete gmail com steipete release notes version 1 4 2 allow to hook different subclasses smaller tweaks version 1 4 1 rename error codes version 1 4 0 add support for block signatures that match method signatures thanks to nickynick version 1 3 1 add support for os x 10 7 or higher thanks to ashfurrow version 1 3 0 add automatic deregistration checks if the selector exists before trying to hook improved dealloc hooking no more unsafe unretained needed better examples always log errors version 1 2 0 adds error parameter improvements in subclassing registration tracking version 1 1 0 renamed the files from nsobject aspects m h to just aspects m h removing now works via calling remove on the aspect token allow hooking dealloc fixes infinite loop if the same method is hooked for multiple classes hooking will only work for one class in the hierarchy additional checks to prevent things like hooking retain release autorelease or forwardinvocation the original implementation of forwardinvocation is now correctly preserved classes are properly cleaned up and restored to the original state after the last hook is deregistered lots and lots of new test cases version 1 0 1 minor tweaks and documentation improvements version 1 0 0 initial release