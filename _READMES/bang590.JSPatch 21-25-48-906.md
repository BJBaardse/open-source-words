jspatch 中文介绍 文档 jspatch平台 请大家不要自行接入 jspatch，统一接入 jspatch 平台，让热修复在一个安全和可控的环境下使用。原因详见 这里 jspatch bridges objective c and javascript using the objective c runtime you can call any objective c class and method in javascript by just including a small engine that makes the app obtaining the power of script language add modules or replacing objective c code to fix bugs dynamically jspatch is still in development welcome to improve the project together notice please go to wiki to get full document example objc implementation appdelegate bool application uiapplication application didfinishlaunchingwithoptions nsdictionary launchoptions jpengine startengine nsstring sourcepath nsbundle mainbundle pathforresource demo oftype js nsstring script nsstring stringwithcontentsoffile sourcepath encoding nsutf8stringencoding error nil jpengine evaluatescript script self window uiwindow alloc initwithframe uiscreen mainscreen bounds self window addsubview self genview self window makekeyandvisible return yes uiview genview return uiview alloc initwithframe cgrectmake 0 0 320 320 end js demo js require uiview uicolor uilabel defineclass appdelegate replace the genview method genview function var view self origgenview view setbackgroundcolor uicolor greencolor var label uilabel alloc initwithframe view frame label settext jspatch label settextalignment 1 view addsubview label return view you can also try to use jspatch convertor to convertor code from objective c to javascript automatically installation cocoapods cocoapods is a dependency manager for objective c which automates and simplifies the process of using 3rd party libraries like jspatch in your projects see the getting started guide for more information ruby your podfile platform ios 6 0 pod jspatch manually copy jsengine m jsengine h jspatch js in jspatch to your project usage objective c import jpengine h call jpengine startengine exec javasscript by jpengine evaluatescript objc jpengine startengine exec js directly jpengine evaluatescript \ var alertview require uialertview alloc init \ alertview settitle alert \ alertview setmessage alertview from js \ alertview addbuttonwithtitle ok \ alertview show \ exec js file from network nsurlconnection sendasynchronousrequest nsurlrequest requestwithurl nsurl urlwithstring http cnbang net test js queue nsoperationqueue mainqueue completionhandler nsurlresponse response nsdata data nserror connectionerror nsstring script nsstring alloc initwithdata data encoding nsutf8stringencoding jpengine evaluatescript script exec local js file nsstring sourcepath nsbundle mainbundle pathforresource sample oftype js nsstring script nsstring stringwithcontentsoffile sourcepath encoding nsutf8stringencoding error nil jpengine evaluatescript script javascript base usage js require require uiview uicolor uislider nsindexpath invoke class method var redcolor uicolor redcolor invoke instance method var view uiview alloc init view setneedslayout set proerty view setbackgroundcolor redcolor get property var bgcolor view backgroundcolor multi params method use underline to separate oc：nsindexpath indexpath nsindexpath indexpathforrow 0 insection 1 var indexpath nsindexpath indexpathforrow insection 0 1 method name contains underline use double undeline to represent oc jpobject privatemethod jpobject privatemethod use tojs to convert nsarray nsstring nsdictionary to js type var arr require nsmutablearray alloc init arr addobject js jsarr arr tojs console log jsarr push patch join output jspatch use hashes to represent struct like cgrect cgsize cgpoint nsrange var view uiview alloc initwithframe x 20 y 20 width 100 height 100 var x view bounds x wrap function with block when passing block from js to oc oc method void request void nsstring content bool success callback require jpobject request block nsstring bool function ctn succ if succ log ctn gcd dispatch after 1 0 function do something dispatch async main function do something go to wiki page for more details base usage defineclass you can redefine an existing class and override methods objc oc implementation jptableviewcontroller void tableview uitableview tableview didselectrowatindexpath nsindexpath indexpath nsstring content self datasource indexpath row may cause out of bound jpviewcontroller ctrl jpviewcontroller alloc initwithcontent content self navigationcontroller pushviewcontroller ctrl nsarray datasource return jspatch is void custommethod nslog callcustom method end objc js defineclass jptableviewcontroller instance method definitions tableview didselectrowatindexpath function tableview indexpath var row indexpath row if self datasource count row fix the out of bound bug here var content self datasource objectatindex row var ctrl jpviewcontroller alloc initwithcontent content self navigationcontroller pushviewcontroller ctrl datasource function get the original method by adding prefix orig var data self origdatasource tojs return data push good go to wiki page for more details usage of defineclass extensions there are some extensions provide support for custom struct type c methods and other functional call addextensions after starting engine to add extensions objc implementation appdelegate bool application uiapplication application didfinishlaunchingwithoptions nsdictionary launchoptions jpengine startengine add extensions after startengine jpengine addextensions jpinclude jpcgtransform nsstring sourcepath nsbundle mainbundle pathforresource demo oftype js nsstring script nsstring stringwithcontentsoffile sourcepath encoding nsutf8stringencoding error nil jpengine evaluatescript script end js include test js include function provide by jpinclude m var view require uiview alloc init cgaffinetransform is supported in jpcgtransform m view settransform a 1 b 0 c 0 d 1 tx 0 ty 100 extensions can be added dynamiclly in js which is recommended js require jpengine addextensions jpinclude jpcgtransform include and cgaffinetransform is avaliable now you can create your own extension to support custom struct type and c methods in project see the wiki page for more details adding new extensions enviroment ios 7 forward compatibility with ios 6 javascriptcore framework support armv7 armv7s arm64