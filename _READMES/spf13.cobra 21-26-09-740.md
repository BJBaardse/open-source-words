cobra is both a library for creating powerful modern cli applications as well as a program to generate applications and command files many of the most widely used go projects are built using cobra including kubernetes hugo rkt etcd moby former docker docker distribution openshift delve gopherjs cockroachdb bleve projectatomic enterprise giantswarms swarm nanobox nanopack rclone nehm pouch table of contents overview concepts commands flags installing getting started using the cobra generator using the cobra library working with flags positional and custom arguments example help command usage message prerun and postrun hooks suggestions when unknown command happens generating documentation for your command generating bash completions contributing license overview cobra is a library providing a simple interface to create powerful modern cli interfaces similar to git go tools cobra is also an application that will generate your application scaffolding to rapidly develop a cobra based application cobra provides easy subcommand based clis app server app fetch etc fully posix compliant flags including short long versions nested subcommands global local and cascading flags easy generation of applications commands with cobra init appname cobra add cmdname intelligent suggestions app srver did you mean app server automatic help generation for commands and flags automatic help flag recognition of h help etc automatically generated bash autocomplete for your application automatically generated man pages for your application command aliases so you can change things without breaking them the flexibility to define your own help usage etc optional tight integration with viper for 12 factor apps concepts cobra is built on a structure of commands arguments flags commands represent actions args are things and flags are modifiers for those actions the best applications will read like sentences when used users will know how to use the application because they will natively understand how to use it the pattern to follow is appname verb noun adjective or appname command arg flag a few good real world examples may better illustrate this point in the following example server is a command and port is a flag hugo server port 1313 in this command we are telling git to clone the url bare git clone url bare commands command is the central point of the application each interaction that the application supports will be contained in a command a command can have children commands and optionally run an action in the example above server is the command more about cobra command flags a flag is a way to modify the behavior of a command cobra supports fully posix compliant flags as well as the go flag package a cobra command can define flags that persist through to children commands and flags that are only available to that command in the example above port is the flag flag functionality is provided by the pflag library a fork of the flag standard library which maintains the same interface while adding posix compliance installing using cobra is easy first use go get to install the latest version of the library this command will install the cobra generator executable along with the library and its dependencies go get u github com spf13 cobra cobra next include cobra in your application go import github com spf13 cobra getting started while you are welcome to provide your own organization typically a cobra based application will follow the following organizational structure ▾ appname ▾ cmd add go your go commands go here go main go in a cobra app typically the main go file is very bare it serves one purpose initializing cobra go package main import fmt os pathtoyourapp cmd func main cmd execute using the cobra generator cobra provides its own program that will create your application and add any commands you want its the easiest way to incorporate cobra into your application here you can find more information about it using the cobra library to manually implement cobra you need to create a bare main go file and a rootcmd file you will optionally provide additional commands as you see fit create rootcmd cobra doesnt require any special constructors simply create your commands ideally you place this in app cmd root go go var rootcmd cobra command use hugo short hugo is a very fast static site generator long a fast and flexible static site generator built with love by spf13 and friends in go complete documentation is available at http hugo spf13 com run func cmd cobra command args string do stuff here func execute if err rootcmd execute err nil fmt println err os exit 1 you will additionally define flags and handle configuration in your init function for example cmd root go go import fmt os homedir github com mitchellh go homedir github com spf13 cobra github com spf13 viper func init cobra oninitialize initconfig rootcmd persistentflags stringvar cfgfile config config file default is home cobra yaml rootcmd persistentflags stringvarp projectbase projectbase b base project directory eg github com spf13 rootcmd persistentflags stringp author a your name author name for copyright attribution rootcmd persistentflags stringvarp userlicense license l name of license for the project can provide licensetext in config rootcmd persistentflags bool viper true use viper for configuration viper bindpflag author rootcmd persistentflags lookup author viper bindpflag projectbase rootcmd persistentflags lookup projectbase viper bindpflag useviper rootcmd persistentflags lookup viper viper setdefault author name here viper setdefault license apache func initconfig dont forget to read config either from cfgfile or from home directory if cfgfile use config file from the flag viper setconfigfile cfgfile else find home directory home err homedir dir if err nil fmt println err os exit 1 search config in home directory with name cobra without extension viper addconfigpath home viper setconfigname cobra if err viper readinconfig err nil fmt println cant read config err os exit 1 create your main go with the root command you need to have your main function execute it execute should be run on the root for clarity though it can be called on any command in a cobra app typically the main go file is very bare it serves one purpose to initialize cobra go package main import fmt os pathtoyourapp cmd func main cmd execute create additional commands additional commands can be defined and typically are each given their own file inside of the cmd directory if you wanted to create a version command you would create cmd version go and populate it with the following go package cmd import fmt github com spf13 cobra func init rootcmd addcommand versioncmd var versioncmd cobra command use version short print the version number of hugo long all software has versions this is hugos run func cmd cobra command args string fmt println hugo static site generator v0 9 head working with flags flags provide modifiers to control how the action command operates assign flags to a command since the flags are defined and used in different locations we need to define a variable outside with the correct scope to assign the flag to work with go var verbose bool var source string there are two different approaches to assign a flag persistent flags a flag can be persistent meaning that this flag will be available to the command its assigned to as well as every command under that command for global flags assign a flag as a persistent flag on the root go rootcmd persistentflags boolvarp verbose verbose v false verbose output local flags a flag can also be assigned locally which will only apply to that specific command go rootcmd flags stringvarp source source s source directory to read from local flag on parent commands by default cobra only parses local flags on the target command any local flags on parent commands are ignored by enabling command traversechildren cobra will parse local flags on each command before executing the target command go command cobra command use print options commands traversechildren true bind flags with config you can also bind your flags with viper go var author string func init rootcmd persistentflags stringvar author author your name author name for copyright attribution viper bindpflag author rootcmd persistentflags lookup author in this example the persistent flag author is bound with viper note that the variable author will not be set to the value from config when the author flag is not provided by user more in viper documentation required flags flags are optional by default if instead you wish your command to report an error when a flag has not been set mark it as required go rootcmd flags stringvarp region region r aws region required rootcmd markflagrequired region positional and custom arguments validation of positional arguments can be specified using the args field of command the following validators are built in noargs the command will report an error if there are any positional args arbitraryargs the command will accept any args onlyvalidargs the command will report an error if there are any positional args that are not in the validargs field of command minimumnargs int the command will report an error if there are not at least n positional args maximumnargs int the command will report an error if there are more than n positional args exactargs int the command will report an error if there are not exactly n positional args rangeargs min max the command will report an error if the number of args is not between the minimum and maximum number of expected args an example of setting the custom validator go var cmd cobra command short hello args func cmd cobra command args string error if len args 1 return errors new requires at least one arg if myapp isvalidcolor args 0 return nil return fmt errorf invalid color specified s args 0 run func cmd cobra command args string fmt println hello world example in the example below we have defined three commands two are at the top level and one cmdtimes is a child of one of the top commands in this case the root is not executable meaning that a subcommand is required this is accomplished by not providing a run for the rootcmd we have only defined one flag for a single command more documentation about flags is available at https github com spf13 pflag go package main import fmt strings github com spf13 cobra func main var echotimes int var cmdprint cobra command use print string to print short print anything to the screen long print is for printing anything back to the screen for many years people have printed back to the screen args cobra minimumnargs 1 run func cmd cobra command args string fmt println print strings join args var cmdecho cobra command use echo string to echo short echo anything to the screen long echo is for echoing anything back echo works a lot like print except it has a child command args cobra minimumnargs 1 run func cmd cobra command args string fmt println print strings join args var cmdtimes cobra command use times times string to echo short echo anything to the screen more times long echo things multiple times back to the user by providing a count and a string args cobra minimumnargs 1 run func cmd cobra command args string for i 0 i echotimes i fmt println echo strings join args cmdtimes flags intvarp echotimes times t 1 times to echo the input var rootcmd cobra command use app rootcmd addcommand cmdprint cmdecho cmdecho addcommand cmdtimes rootcmd execute for a more complete example of a larger application please checkout hugo help command cobra automatically adds a help command to your application when you have subcommands this will be called when a user runs app help additionally help will also support all other commands as input say for instance you have a command called create without any additional configuration cobra will work when app help create is called every command will automatically have the help flag added example the following output is automatically generated by cobra nothing beyond the command and flag definitions are needed cobra help cobra is a cli library for go that empowers applications this application is a tool to generate the needed files to quickly create a cobra application usage cobra command available commands add add a command to a cobra application help help about any command init initialize a cobra application flags a author string author name for copyright attribution default your name config string config file default is home cobra yaml h help help for cobra l license string name of license for the project viper use viper for configuration default true use cobra command help for more information about a command help is just a command like any other there is no special logic or behavior around it in fact you can provide your own if you want defining your own help you can provide your own help command or your own template for the default command to use with following functions go cmd sethelpcommand cmd command cmd sethelpfunc f func command string cmd sethelptemplate s string the latter two will also apply to any children commands usage message when the user provides an invalid flag or invalid command cobra responds by showing the user the usage example you may recognize this from the help above thats because the default help embeds the usage as part of its output cobra invalid error unknown flag invalid usage cobra command available commands add add a command to a cobra application help help about any command init initialize a cobra application flags a author string author name for copyright attribution default your name config string config file default is home cobra yaml h help help for cobra l license string name of license for the project viper use viper for configuration default true use cobra command help for more information about a command defining your own usage you can provide your own usage function or template for cobra to use like help the function and template are overridable through public methods go cmd setusagefunc f func command error cmd setusagetemplate s string version flag cobra adds a top level version flag if the version field is set on the root command running an application with the version flag will print the version to stdout using the version template the template can be customized using the cmd setversiontemplate s string function prerun and postrun hooks it is possible to run functions before or after the main run function of your command the persistentprerun and prerun functions will be executed before run persistentpostrun and postrun will be executed after run the persistent run functions will be inherited by children if they do not declare their own these functions are run in the following order persistentprerun prerun run postrun persistentpostrun an example of two commands which use all of these features is below when the subcommand is executed it will run the root commands persistentprerun but not the root commands persistentpostrun go package main import fmt github com spf13 cobra func main var rootcmd cobra command use root sub short my root command persistentprerun func cmd cobra command args string fmt printf inside rootcmd persistentprerun with args v\n args prerun func cmd cobra command args string fmt printf inside rootcmd prerun with args v\n args run func cmd cobra command args string fmt printf inside rootcmd run with args v\n args postrun func cmd cobra command args string fmt printf inside rootcmd postrun with args v\n args persistentpostrun func cmd cobra command args string fmt printf inside rootcmd persistentpostrun with args v\n args var subcmd cobra command use sub no options short my subcommand prerun func cmd cobra command args string fmt printf inside subcmd prerun with args v\n args run func cmd cobra command args string fmt printf inside subcmd run with args v\n args postrun func cmd cobra command args string fmt printf inside subcmd postrun with args v\n args persistentpostrun func cmd cobra command args string fmt printf inside subcmd persistentpostrun with args v\n args rootcmd addcommand subcmd rootcmd setargs string rootcmd execute fmt println rootcmd setargs string sub arg1 arg2 rootcmd execute output inside rootcmd persistentprerun with args inside rootcmd prerun with args inside rootcmd run with args inside rootcmd postrun with args inside rootcmd persistentpostrun with args inside rootcmd persistentprerun with args arg1 arg2 inside subcmd prerun with args arg1 arg2 inside subcmd run with args arg1 arg2 inside subcmd postrun with args arg1 arg2 inside subcmd persistentpostrun with args arg1 arg2 suggestions when unknown command happens cobra will print automatic suggestions when unknown command errors happen this allows cobra to behave similarly to the git command when a typo happens for example hugo srever error unknown command srever for hugo did you mean this server run hugo help for usage suggestions are automatic based on every subcommand registered and use an implementation of levenshtein distance every registered command that matches a minimum distance of 2 ignoring case will be displayed as a suggestion if you need to disable suggestions or tweak the string distance in your command use go command disablesuggestions true or go command suggestionsminimumdistance 1 you can also explicitly set names for which a given command will be suggested using the suggestfor attribute this allows suggestions for strings that are not close in terms of string distance but makes sense in your set of commands and for some which you dont want aliases example kubectl remove error unknown command remove for kubectl did you mean this delete run kubectl help for usage generating documentation for your command cobra can generate documentation based on subcommands flags etc in the following formats markdown restructured text man page generating bash completions cobra can generate a bash completion file if you add more information to your command these completions can be amazingly powerful and flexible read more about it in bash completions contributing fork it download your fork to your pc git clone https github com your username cobra cd cobra create your feature branch git checkout b my new feature make changes and add them git add commit your changes git commit m add some feature push to the branch git push origin my new feature create new pull request license cobra is released under the apache 2 0 license see license txt