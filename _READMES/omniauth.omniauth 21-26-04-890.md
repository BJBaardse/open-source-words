omniauth standardized multi provider authentication an introduction omniauth is a library that standardizes multi provider authentication for web applications it was created to be powerful flexible and do as little as possible any developer can create strategies for omniauth that can authenticate users via disparate systems omniauth strategies have been created for everything from facebook to ldap in order to use omniauth in your applications you will need to leverage one or more strategies these strategies are generally released individually as rubygems and you can see a community maintained list on the wiki for this project one strategy called developer is included with omniauth and provides a completely insecure non production usable strategy that directly prompts a user for authentication information and then passes it straight through you can use it as a placeholder when you start development and easily swap in other strategies later getting started each omniauth strategy is a rack middleware that means that you can use it the same way that you use any other rack middleware for example to use the built in developer strategy in a sinatra application i might do this ruby require sinatra require omniauth class myapplication sinatra base use rack session cookie use omniauth strategies developer end because omniauth is built for multi provider authentication i may want to leave room to run multiple strategies for this the built in omniauth builder class gives you an easy way to specify multiple strategies note that there is no difference between the following code and using each strategy individually as middleware this is an example that you might put into a rails initializer at config initializers omniauth rb ruby rails application config middleware use omniauth builder do provider developer unless rails env production provider twitter env twitter key env twitter secret end you should look to the documentation for each provider you use for specific initialization requirements integrating omniauth into your application omniauth is an extremely low touch library it is designed to be a black box that you can send your applications users into when you need authentication and then get information back omniauth was intentionally built not to automatically associate with a user model or make assumptions about how many authentication methods you might want to use or what you might want to do with the data once a user has authenticated this makes omniauth incredibly flexible to use omniauth you need only to redirect users to auth provider where provider is the name of the strategy for example developer or twitter from there omniauth will take over and take the user through the necessary steps to authenticate them with the chosen strategy once the user has authenticated what do you do next omniauth simply sets a special hash called the authentication hash on the rack environment of a request to auth provider callback this hash contains as much information about the user as omniauth was able to glean from the utilized strategy you should set up an endpoint in your application that matches to the callback url and then performs whatever steps are necessary for your application for example in a rails app i would add a line in my routes rb file like this ruby get auth provider callback to sessions create and i might then have a sessionscontroller with code that looks something like this ruby class sessionscontroller applicationcontroller def create user user find or create from auth hash auth hash self current user user redirect to end protected def auth hash request env omniauth auth end end the omniauth auth key in the environment hash gives me my authentication hash which will contain information about the just authenticated user including a unique id the strategy they just used for authentication and personal details such as name and email address as available for an in depth description of what the authentication hash might contain see the auth hash schema wiki page note that omniauth does not perform any actions beyond setting some environment information on the callback request it is entirely up to you how you want to implement the particulars of your applications authentication flow configuring the origin param the origin url parameter is typically used to inform where a user came from and where should you choose to use it theyd want to return to there are three possible options default flow ruby auth twitter origin url no change if blank omniauth origin is set to http referer renaming origin param ruby auth twitter return to url if blank omniauth origin is set to http referer provider twitter env key env secret origin param return to disabling origin param ruby auth twitter origin handled externally if need be omniauth origin is not set provider twitter env key env secret origin param false integrating omniauth into your rails api the following middleware are by default included for session management in rails applications when using omniauth with a rails api youll need to add one of these required middleware back in actiondispatch session cachestore actiondispatch session cookiestore actiondispatch session memcachestore the trick to adding these back in is that by default they are passed session options when added including the session key so you cant just add a session store rb initializer add use actiondispatch session cookiestore and have sessions functioning as normal to be clear sessions may work but your session options will be ignored i e the session key will default to session id instead of the initializer youll have to set the relevant options somewhere before your middleware is built like application rb and pass them to your preferred middleware like this application rb ruby config session store cookie store key interslice session config middleware use actiondispatch cookies required for all session management config middleware use actiondispatch session cookiestore config session options thanks mltsy logging omniauth supports a configurable logger by default omniauth will log to stdout but you can configure this using omniauth config logger ruby rails application example omniauth config logger rails logger resources the omniauth wiki has actively maintained in depth documentation for omniauth it should be your first stop if you are wondering about a more in depth look at omniauth how it works and how to use it supported ruby versions omniauth is tested under 2 1 10 2 2 6 2 3 3 2 4 0 2 5 0 and jruby versioning this library aims to adhere to semantic versioning 2 0 0 violations of this scheme should be reported as bugs specifically if a minor or patch version is released that breaks backward compatibility that version should be immediately yanked and or a new version should be immediately released that restores compatibility breaking changes to the public api will only be introduced with new major versions as a result of this policy you can and should specify a dependency on this gem using the pessimistic version constraint with two digits of precision for example spec add dependency omniauth 1 0 license copyright c 2010 2017 michael bleigh and intridea inc see license for details