entrust laravel 5 package entrust is a succinct and flexible way to add role based permissions to laravel 5 if you are looking for the laravel 4 version take a look branch 1 0 it contains the latest entrust version for laravel 4 contents installation configuration user relation to roles models role permission user soft deleting usage concepts checking for roles permissions user ability blade templates middleware short syntax route filter route filter troubleshooting license contribution guidelines additional information installation 1 in order to install laravel 5 entrust just add the following to your composer json then run composer update json zizaco entrust 5 2 x dev 2 open your config app php and add the following to the providers array php zizaco\entrust\entrustserviceprovider class 3 in the same config app php and add the following to the aliases array php entrust zizaco\entrust\entrustfacade class 4 run the command below to publish the package config file config entrust php shell php artisan vendor publish 5 open your config auth php and add the following to it php providers users driver eloquent model namespace\of\your\user\model\user class table users 6 if you want to use middleware requires laravel 5 1 or later you also need to add the following php role \zizaco\entrust\middleware\entrustrole class permission \zizaco\entrust\middleware\entrustpermission class ability \zizaco\entrust\middleware\entrustability class to routemiddleware array in app http kernel php configuration set the property values in the config auth php these values will be used by entrust to refer to the correct user table and model to further customize table names and model namespaces edit the config entrust php user relation to roles now generate the entrust migration bash php artisan entrust migration it will generate the timestamp entrust setup tables php migration you may now run it with the artisan migrate command bash php artisan migrate after the migration four new tables will be present roles — stores role records permissions — stores permission records role user — stores many to many relations between roles and users permission role — stores many to many relations between roles and permissions models role create a role model inside app models role php using the following example php php namespace app use zizaco\entrust\entrustrole class role extends entrustrole the role model has three main attributes name — unique name for the role used for looking up role information in the application layer for example admin owner employee display name — human readable name for the role not necessarily unique and optional for example user administrator project owner widget co employee description — a more detailed explanation of what the role does also optional both display name and description are optional their fields are nullable in the database permission create a permission model inside app models permission php using the following example php php namespace app use zizaco\entrust\entrustpermission class permission extends entrustpermission the permission model has the same three attributes as the role name — unique name for the permission used for looking up permission information in the application layer for example create post edit user post payment mailing list subscribe display name — human readable name for the permission not necessarily unique and optional for example create posts edit users post payments subscribe to mailing list description — a more detailed explanation of the permission in general it may be helpful to think of the last two attributes in the form of a sentence the permission display name allows a user to description user next use the entrustusertrait trait in your existing user model for example php php use zizaco\entrust\traits\entrustusertrait class user extends eloquent use entrustusertrait add this trait to your user model this will enable the relation with role and add the following methods roles hasrole name withrole name can permission and ability roles permissions options within your user model dont forget to dump composer autoload bash composer dump autoload and you are ready to go soft deleting the default migration takes advantage of ondelete cascade clauses within the pivot tables to remove relations when a parent record is deleted if for some reason you cannot use cascading deletes in your database the entrustrole and entrustpermission classes and the hasrole trait include event listeners to manually delete records in relevant pivot tables in the interest of not accidentally deleting data the event listeners will not delete pivot data if the model uses soft deleting however due to limitations in laravels event listeners there is no way to distinguish between a call to delete versus a call to forcedelete for this reason before you force delete a model you must manually delete any of the relationship data unless your pivot tables uses cascading deletes for example php role role findorfail 1 pull back a given role regular delete role delete this will work no matter what force delete role users sync delete relationship data role perms sync delete relationship data role forcedelete now force delete will work regardless of whether the pivot table has cascading delete usage concepts lets start by creating the following roles and permissions php owner new role owner name owner owner display name project owner optional owner description user is the owner of a given project optional owner save admin new role admin name admin admin display name user administrator optional admin description user is allowed to manage and edit other users optional admin save next with both roles created lets assign them to the users thanks to the hasrole trait this is as easy as php user user where username michele first role attach alias user attachrole admin parameter can be an role object array or id or eloquents original technique user roles attach admin id id only now we just need to add permissions to those roles php createpost new permission createpost name create post createpost display name create posts optional allow a user to createpost description create new blog posts optional createpost save edituser new permission edituser name edit user edituser display name edit users optional allow a user to edituser description edit existing users optional edituser save admin attachpermission createpost equivalent to admin perms sync array createpost id owner attachpermissions array createpost edituser equivalent to owner perms sync array createpost id edituser id checking for roles permissions now we can check for roles and permissions simply by doing php user hasrole owner false user hasrole admin true user can edit user false user can create post true both hasrole and can can receive an array of roles permissions to check php user hasrole owner admin true user can edit user create post true by default if any of the roles or permissions are present for a user then the method will return true passing true as a second parameter instructs the method to require all of the items php user hasrole owner admin true user hasrole owner admin true false user does not have admin role user can edit user create post true user can edit user create post true false user does not have edit user permission you can have as many roles as you want for each user and vice versa the entrust class has shortcuts to both can and hasrole for the currently logged in user php entrust hasrole role name entrust can permission name is identical to auth user hasrole role name auth user can permission name you can also use placeholders wildcards to check any matching permission by doing php match any admin permission user can admin true match any permission about users user can users true to filter users according a specific role you may use withrole scope for example to retrieve all admins admins user withrole admin get or maybe with a relationsship company users withrole admin get user ability more advanced checking can be done using the awesome ability function it takes in three parameters roles permissions options roles is a set of roles to check permissions is a set of permissions to check either of the roles or permissions variable can be a comma separated string or array php user ability array admin owner array create post edit user or user ability admin owner create post edit user this will check whether the user has any of the provided roles and permissions in this case it will return true since the user is an admin and has the create post permission the third parameter is an options array php options array validate all true false default false return type boolean array both default boolean validate all is a boolean flag to set whether to check all the values for true or to return true if at least one role or permission is matched return type specifies whether to return a boolean array of checked values or both in an array here is an example output php options array validate all true return type both list validate allvalidations user ability array admin owner array create post edit user options var dump validate bool false var dump allvalidations array 4 role bool true role 2 bool false create post bool true edit user bool false theentrustclass has a shortcut toability for the currently logged in user php entrust ability admin owner create post edit user is identical to auth user ability admin owner create post edit user blade templates three directives are available for use within your blade templates what you give as the directive arguments will be directly passed to the corresponding entrust function php role admin this is visible to users with the admin role gets translated to \entrust role admin endrole permission manage admins this is visible to users with the given permissions gets translated to \entrust can manage admins the can directive is already taken by core laravel authorization package hence the permission directive instead endpermission ability admin owner create post edit user this is visible to users with the given abilities gets translated to \entrust ability admin owner create post edit user endability middleware you can use a middleware to filter routes and route groups by permission or role php route group prefix admin middleware role admin function route get admincontroller welcome route get manage middleware permission manage admins uses admincontroller manageadmins it is possible to use pipe symbol as or operator php middleware role admin root to emulate and functionality just use multiple instances of middleware php middleware role owner role writer for more complex situations use ability middleware which accepts 3 parameters roles permissions validate all php middleware ability admin owner create post edit user true short syntax route filter to filter a route by permission or role you can call the following in your app http routes php php only users with roles that have the manage posts permission will be able to access any route within admin post entrust routeneedspermission admin post create post only owners will have access to routes within admin advanced entrust routeneedsrole admin advanced owner optionally the second parameter can be an array of permissions or roles user would need to match all roles or permissions for that route entrust routeneedspermission admin post array create post edit comment entrust routeneedsrole admin advanced array owner writer both of these methods accept a third parameter if the third parameter is null then the return of a prohibited access will be app abort 403 otherwise the third parameter will be returned so you can use it like php entrust routeneedsrole admin advanced owner redirect to home furthermore both of these methods accept a fourth parameter it defaults to true and checks all roles permissions given if you set it to false the function will only fail if all roles permissions fail for that user useful for admin applications where you want to allow access for multiple groups php if a user has create post edit comment or both they will have access entrust routeneedspermission admin post array create post edit comment null false if a user is a member of owner writer or both they will have access entrust routeneedsrole admin advanced array owner writer null false if a user is a member of owner writer or both or user has create post edit comment they will have access if the 4th parameter is true then the user must be a member of role and must have permission entrust routeneedsroleorpermission admin advanced array owner writer array create post edit comment null false route filter entrust roles permissions can be used in filters by simply using the can and hasrole methods from within the facade php route filter manage posts function check the current user if entrust can create post return redirect to admin only users with roles that have the manage posts permission will be able to access any admin post route route when admin post manage posts using a filter to check for a role php route filter owner role function check the current user if entrust hasrole owner app abort 403 only owners will have access to routes within admin advanced route when admin advanced owner role as you can see entrust hasrole and entrust can checks if the user is logged in and then if he or she has the role or permission if the user is not logged the return will also be false troubleshooting if you encounter an error when doing the migration that looks like sqlstate hy000 general error 1005 cant create table laravelbootstrapstarter sql 42c f8 errno 150 sql alter table role user add constraint role user user id foreign foreign key user id references users id bindings array then its likely that the id column in your user table does not match the user id column in role user make sure both are int 10 when trying to use the entrustusertrait methods you encounter the error which looks like class name must be a valid object or a string then probably you dont have published entrust assets or something went wrong when you did it first of all check that you have the entrust php file in your config directory if you dont then try php artisan vendor publish and if it does not appear manually copy the vendor zizaco entrust src config config php file in your config directory and rename it entrust php if your app uses a custom namespace then youll need to tell entrust where your permission and role models are you can do this by editing the config file in config entrust php role custom\namespace\role permission custom\namespace\permission license entrust is free software distributed under the terms of the mit license contribution guidelines support follows psr 1 and psr 4 php coding standards and semantic versioning please report any issue you find in the issues page pull requests are welcome