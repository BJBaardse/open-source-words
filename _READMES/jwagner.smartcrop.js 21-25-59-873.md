smartcrop js smartcrop js implements an algorithm to find good crops for images it can be used in the browser in node or via a cli image https www flickr com photos endogamia 5682480447 by n feans demos smartcrop js test suite contains over 100 images heavy smartcrop js test bed allows you to test smartcrop with your own images and different face detection libraries automatic photo transitions automatically creates ken burns transitions for a slide show simple example javascript you pass in an image as well as the width height of the crop you want to optimize smartcrop crop image width 100 height 100 then function result console log result output javascript smartcrop will output you its best guess for a crop you can now use this data to crop the image topcrop x 300 y 200 height 200 width 200 download installation npm install smartcrop or just download smartcrop js from the git repository smarcrop requires support for promises use a polyfill for unsupported browsers or set smartcrop promise to your favorite promise implementation i recommend bluebird command line interface the smartcrop cli offers command line interface to smartcrop js node you can use smartcrop from nodejs via either smartcrop gm which is using image magick via gm or smartcrop sharp which is using libvips via sharp the smartcrop cli can be used as an example of using smartcrop from node stability while smartcrop js is a small personal project it is currently being used on high traffic production sites it has a basic set of automated tests and a test coverage of close to 100 the tests are ran in all modern browsers thanks to saucelabs if in any doubt the code is short enough to perform a quick review yourself algorithm overview smartcrop js works using fairly dumb image processing in short find edges using laplace find regions with a color like skin find regions high in saturation boost regions as specified by options for example detected faces generate a set of candidate crops using a sliding window rank them using an importance function to focus the detail in the center and avoid it in the edges output the candidate crop with the highest rank face detection the smartcrop algorithm itself is designed to be simple relatively fast small and generic in many cases it does make sense to add face detection to it to ensure faces get the priority they deserve there are multiple javascript libraries which can be easily integrated into smartcrop js ccv js jquery facedetection tracking js opencv js node opencv you can experiment with all of these in the smartcrop js testbed on the client side i would recommend using tracking js because its small and simple opencv js is compiled from c and very heavy 7 6mb of javascript 900kb of data jquery facedetection has dependency on jquery and from my limited experience seems to perform worse than the others on the server side node opencv can be quicker but comes with some annoying issues as well its also worth noting that all of these libraries are based on the now dated viola jones object detection framework it would be interesting to see how more state of the art techniques could be implemented in browser friendly javascript supported module formats commonjs amd global export window supported browsers see caniuse com canvas a polyfill for promises is recommended if you need to support old browsers api smartcrop crop image options find the best crop for image using options image anything ctx drawimage accepts usually htmlimageelement htmlcanvaselement or htmlvideoelement keep in mind that origin policies apply to the image source you may not use cross domain images without cors clearance options cropoptions returns a promise for a cropresult cropoptions minscale minimal scale of the crop rect set to 1 0 to prevent smaller than necessary crops lowers the risk of chopping things off width width of the crop you want to use height height of the crop you want to use boost optional array of regions whose interestingness you want to boost for example faces see boost ruleofthirds optional boolean if set to false it will turn off the rule of thirds composition weight debug internal if true cropresults will contain a debugcanvas and the complete results array there are many more for now undocumented options available check the source and be advised that they might change in the future cropresult result of the promise returned by smartcrop crop javascript topcrop crop crop an individual crop javascript x 11 pixels from the left side y 20 pixels from the top width 1 pixels height 1 pixels boost describes a region to boost a usage example of this is to take into account faces in the image see smartcrop cli for an example on how to integrate face detection javascript x 11 pixels from the left side y 20 pixels from the top width 1 pixels height 1 pixels weight 1 0 1 tests you can run the tests using grunt test alternatively you can also just run grunt the default task and open http localhost 8000 test benchmark there are benchmarks for both the browser test benchmark html and node node test benchmark node js requires node canvas both powered by benchmark js if you just want some rough numbers it takes 20 ms to find a square crop of a 640x427px picture on an i7 in other words its fine to run it on one image its suboptimal to run it on an entire gallery on page load contributors christian muehlhaeuser ports alternatives connect thumbs middleware for connect js that supports smartcrop js by irakli nadareishvili smartcrop java by quadflask smartcrop android by quadflask smartcrop go by christian muehlhaeuser smartcrop py by hideo hattori smartcrop rails smartcrop wrapped in a ruby gem by mohammed sadiq version history 2 0 2 in short its a lot faster when calculating bigger crops the quality of the crops should be comparable but the results are going to be different so this will be a major release 1 1 1 removed useless files from npm package 1 1 creating github releases added options input which is getting passed along to iop open 1 0 refactoring cleanup to make it easier to use with node js dropping the node canvas dependency and enable support for boosts which can be used to do face detection this is a 1 0 in the semantic meaning denoting backwards incompatible api changes it does not denote a finished product license copyright c 2018 jonas wagner licensed under the mit license enclosed