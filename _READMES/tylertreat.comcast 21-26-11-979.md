comcast testing distributed systems under hard failures like network partitions and instance termination is critical but its also important we test them under less catastrophic conditions because this is what they most often experience comcast is a tool designed to simulate common network problems like latency bandwidth restrictions and dropped reordered corrupted packets it works by wrapping up some system tools in a portable ish way on bsd derived systems such as osx we use tools like ipfw and pfctl to inject failure on linux we use iptables and tc comcast is merely a thin wrapper around these controls windows support may be possible with wipfw or even the native network stack but this has not yet been implemented in comcast and may be at a later date installation go get github com tylertreat comcast usage on linux comcast supports several options device latency target default bandwidth packet loss protocol and port number comcast device eth0 latency 250 target bw 1000 default bw 1000000 packet loss 10 target addr 8 8 8 8 10 0 0 0 24 target proto tcp udp icmp target port 80 22 1000 2000 on osx comcast will check for pfctl support as of yosemite which supports the same options as above if pfctl is not available it will use ipfw instead which supports device latency target bandwidth and packet loss options on bsd with ipfw comcast currently supports only device latency target bandwidth and packet loss comcast device eth0 latency 250 target bw 1000 packet loss 10 this will add 250ms of latency limit bandwidth to 1mbps and drop 10 of packets to the targetted on linux destination addresses using the specified protocols on the specified port numbers slow lane the default bandwidth specified will apply to all egress traffic fast lane to turn this off run the following comcast stop by default comcast will determine the system commands to execute log them to stdout and execute them the dry run flag will skip execution i dont trust you this code sucks i hate go etc if you dont like running code that executes shell commands for you despite it being open source so you can read it and change the code or want finer grained control you can run them directly instead read the man pages on these things for more details linux on linux you can use iptables to drop incoming and outgoing packets iptables a input m statistic mode random probability 0 1 j drop iptables a output m statistic mode random probability 0 1 j drop alternatively you can use tc which supports some additional options tc qdisc add dev eth0 root netem delay 50ms 20ms distribution normal tc qdisc change dev eth0 root netem reorder 0 02 duplicate 0 05 corrupt 0 01 to reset tc qdisc del dev eth0 root netem bsd osx to shape traffic in bsd derived systems create an ipfw pipe and configure it you can control incoming and outgoing traffic separately as well as which hosts are affected if you want ipfw add 1 pipe 1 ip from me to any ipfw add 2 pipe 1 ip from any to me ipfw pipe 1 config delay 500ms bw 1mbit s plr 0 1 to reset ipfw delete 1 note ipfw was removed in osx yosemite in favor of pfctl network condition profiles heres a list of network conditions with values that you can plug into comcast please add any more that you may come across name latency bandwidth packet loss gprs good 500 50 2 edge good 300 250 1 5 3g hsdpa good 250 750 1 5 dial up good 185 40 2 dsl poor 70 2000 2 dsl good 40 8000 0 5 wifi good 40 30000 0 2 satellite 1500 0 2