swiftyjson swiftyjson makes it easy to deal with json data in swift why is the typical json handling in swift not good requirements integration usage initialization subscript loop error optional getter non optional getter setter raw object literal convertibles merging work with alamofire work with moya 中文介绍 why is the typical json handling in swift not good swift is very strict about types but although explicit typing is good for saving us from mistakes it becomes painful when dealing with json and other areas that are by nature implicit about types take the twitter api for example say we want to retrieve a users name value of some tweet in swift according to twitters api the code would look like this swift if let statusesarray try jsonserialization jsonobject with data options allowfragments as string any let user statusesarray 0 user as string any let username user name as string finally we got the username its not good even if we use optional chaining it would be messy swift if let jsonobject try jsonserialization jsonobject with data options allowfragments as string any let username jsonobject 0 user as string any name as string theres our username an unreadable mess for something that should really be simple with swiftyjson all you have to do is swift let json json data datafromnetworking if let username json 0 user name string now you got your value and dont worry about the optional wrapping thing its done for you automatically swift let json json data datafromnetworking if let username json 999999 wrong key wrong name string calm down take it easy the string property still produces the correct optional string type with safety else print the error print json 999999 wrong key wrong name requirements ios 8 0 macos 10 10 tvos 9 0 watchos 2 0 xcode 8 integration cocoapods ios 8 os x 10 9 you can use cocoapods to install swiftyjson by adding it to your podfile ruby platform ios 8 0 use frameworks target myapp do pod swiftyjson 4 0 end carthage ios 8 os x 10 9 you can use carthage to install swiftyjson by adding it to your cartfile github swiftyjson swiftyjson 4 0 if you use carthage to build your dependencies make sure you have added swiftyjson framework to the linked frameworks and libraries section of your target and have included them in your carthage framework copying build phase swift package manager you can use the swift package manager to install swiftyjson by adding the proper description to your package swift file swift swift tools version 4 0 import packagedescription let package package name your project name dependencies package url https github com swiftyjson swiftyjson git from 4 0 0 then runswift build whenever you get prepared manually ios 7 os x 10 9 to use this library in your project manually you may for projects just drag swiftyjson swift to the project tree for workspaces include the whole swiftyjson xcodeproj usage initialization swift import swiftyjson swift let json json data datafromnetworking or swift let json json jsonobject or swift if let datafromstring jsonstring data using utf8 allowlossyconversion false let json json data datafromstring subscript swift getting a double from a json array let name json 0 double swift getting an array of string from a json array let arraynames json users arrayvalue map 0 name stringvalue swift getting a string from a json dictionary let name json name stringvalue swift getting a string using a path to the element let path jsonsubscripttype 1 list 2 name let name json path string just the same let name json 1 list 2 name string alternatively let name json 1 list 2 name string swift with a hard way let name json string swift with a custom way let keys jsonsubscripttype 1 list 2 name let name json keys string loop swift if json is dictionary for key subjson string json in json do something you want the first element is always a string even if the json is an array swift if json is array the index is 0 json counts string value for index subjson string json in json do something you want error swiftyjson 4 x swiftyjson 4 x introduces an enum type called swiftyjsonerror which includes unsupportedtype indexoutofbounds elementtoodeep wrongtype notexist and invalidjson at the same time errordomain are being replaced by swiftyjsonerror errordomain note those old error types are deprecated in swiftyjson 4 x and will be removed in the future release swiftyjson 3 x use a subscript to get set a value in an array or dictionary if the json is an array the app may crash with index out of bounds a dictionary it will be assigned to nil without a reason not an array or a dictionary the app may crash with an unrecognised selector exception this will never happen in swiftyjson swift let json json name age if let name json 999 string do something you want else print json 999 error array 999 is out of bounds swift let json json name jack age 25 if let name json address string do something you want else print json address error dictionary address does not exist swift let json json 12345 if let age json 0 string do something you want else print json 0 array 0 failure it is not an array print json 0 error array 0 failure it is not an array if let name json name string do something you want else print json name dictionary \ name failure it is not an dictionary print json name error dictionary \ name failure it is not an dictionary optional getter swift nsnumber if let id json user favourites count number do something you want else print the error print json user favourites count error swift string if let id json user name string do something you want else print the error print json user name error swift bool if let id json user is translator bool do something you want else print the error print json user is translator error swift int if let id json user id int do something you want else print the error print json user id error non optional getter non optional getter is named xxxvalue swift if not a number or nil return 0 let id int json id intvalue swift if not a string or nil return let name string json name stringvalue swift if not an array or nil return let list array json json list arrayvalue swift if not a dictionary or nil return let user dictionary string json json user dictionaryvalue setter swift json name json new name json 0 json 1 swift json id int 1234567890 json coordinate double 8766 766 json name string jack json arrayobject 1 2 3 4 json dictionaryobject name jack age 25 raw object swift let rawobject any json object swift let rawvalue any json rawvalue swift convert the json to raw nsdata do let rawdata try json rawdata do something you want catch print error \ error swift convert the json to a raw string if let rawstring json rawstring do something you want else print json rawstring is nil existence swift shows you whether value specified in json or not if json name exists literal convertibles for more info about literal convertibles swift literal convertibles swift stringliteralconvertible let json json im a json swift integerliteralconvertible let json json 12345 swift booleanliteralconvertible let json json true swift floatliteralconvertible let json json 2 8765 swift dictionaryliteralconvertible let json json i am a json swift arrayliteralconvertible let json json i am a json swift with subscript in array var json json 1 2 3 json 0 100 json 1 200 json 2 300 json 999 300 dont worry nothing will happen swift with subscript in dictionary var json json name jack age 25 json name mike json age 25 its ok to set string json address l a add the address l a in json swift array dictionary var json json name jack age 25 list a b c what this json list 3 what that json list 3 what that let path jsonsubscripttype list 3 what json path that swift with other json objects let user json username steve password supersecurepassword let auth json user user object use user object instead of just user apikey supersecretapitoken merging it is possible to merge one json into another json merging a json into another json adds all non existing values to the original json which are only present in the other json if both jsons contain a value for the same key mostly this value gets overwritten in the original json but there are two cases where it provides some special treatment in case of both values being a json type array the values form the array found in the other json getting appended to the original jsons array value in case of both values being a json type dictionary both json values are getting merged the same way the encapsulating json is merged in case where two fields in a json have a different types the value will get always overwritten there are two different fashions for merging merge modifies the original json whereas merged works non destructively on a copy swift let original json first name john age 20 skills coding reading address street front st zip 12345 let update json last name doe age 21 skills writing address zip 12342 city new york city let updated original merge with update first name john last name doe age 21 skills coding reading writing address street front st zip 12342 city new york city string representation there are two options available use the default swift one use a custom one that will handle optionals well and represent nil as null swift let dict 1 2 2 two 3 nil as string any let json json dict let representation json rawstring options castniltonsnull true representation is \ 1\ 2 \ 2\ \ two\ \ 3\ null which represents 1 2 2 two 3 null work with alamofire swiftyjson nicely wraps the result of the alamofire json response handler swift alamofire request url method get validate responsejson response in switch response result case success let value let json json value print json \ json case failure let error print error we also provide an extension of alamofire for serializing nsdata to swiftyjsons json see alamofire swiftyjson work with moya swiftyjson parse data to json swift let provider moyaprovider provider request showproducts result in switch result case let success moyaresponse let data moyaresponse data let json json data data convert network data to json print json case let failure error print error error