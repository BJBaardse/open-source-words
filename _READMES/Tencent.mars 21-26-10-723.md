mars 20 7c 20windows 20 brightgreen svg 中文版本请参看这里 mars is a cross platform infrastructure component developed by wechat mobile team it is proved to be effective by billions of wechat users cross platform easy to deploy if you are developing multi platform or multi business application suitable for small amount data transmission mobile platform friendly low power and traffic consumption a network solution fit for mobile application comm common library including socket thread message queue coroutine etc xlog a reliable log component with high performance sdt a network detection component stn a signaling network component the major part of mars samples start with sample usage here getting started choose android or ios os x or windows android you can use either mars wrapper or mars core we recommend you to use mars wrapper when you just wanna build a sample or demo while mars core is preferred to be used in your app mars wrapper add dependencies by adding the following lines to your app build gradle xml dependencies compile com tencent mars mars wrapper 1 1 8 or mars core add dependencies by adding the following lines to your app build gradle xml dependencies compile com tencent mars mars core 1 2 1 or mars xlog if you just want to user xlog add dependencies by adding the following lines to your app build gradle note xlog is included in mars core and mars wrapper xml dependencies compile com tencent mars mars xlog 1 0 6 if you read here make sure you have added dependencies of mars wrapper mars core or mars xlog xlog init initialize xlog when your app starts remember to use an exclusive folder to save the log files no other files are acceptable in the folder since they would be removed by the cleansing function in xlog automatically when multiple processes is used in your app make sure that each process owns its exclusive log file java system loadlibrary stlport shared system loadlibrary marsxlog final string sdcard environment getexternalstoragedirectory getabsolutepath final string logpath sdcard marssample log this is necessary or may cash for sigbus final string cachepath this getfilesdir xlog init xlog if buildconfig debug xlog appenderopen xlog level debug xlog appednermodeasync cachepath logpath marssample xlog setconsolelogopen true else xlog appenderopen xlog level info xlog appednermodeasync cachepath logpath marssample xlog setconsolelogopen false log setlogimp new xlog uninitialized xlog when your app exits java log appenderclose stn init if you add dependencies of mars core to your project you need to initialize and release stn initialize stn before you use it java set callback applogic setcallback stub stnlogic setcallback stub sdtlogic setcallback stub initialize the mars platformcomm mars init getapplicationcontext new handler looper getmainlooper initialize the mars stnlogic setlonglinksvraddr profile longlinkhost profile longlinkports stnlogic setshortlinksvraddr profile shortlinkport stnlogic setclientversion profile productid mars oncreate true baseevent onforeground true stnlogic makesurelonglinkconnected firstly you should call the setcallback interface and secondly the mars init then to initialize the mars there is to need to strictly follow the orders of the four commands finally after mars are initialized onforeground and makesurelonglinkconnect can be called destroy stn or exit your app java mars ondestroy event change network change java baseevent onnetworkchange if you add dependencies of mars wrapper to your project you just need initialize stn and no need uninitialized java marsserviceproxy init this getmainlooper null no matter which way of dependencies you used you must pay attention to these the state background or foreground of the app is changed java baseevent onforeground boolean the account of the app is changed java stnlogic reset if you want to modify the encryption algorithm of xlog the packer unpacker of longlink shortlink or you want to define the other components by yourself refer here ios os x compile python build apple py add mars framework as a dependency of your project rename files with rewriteme extension to cc extension add header files and source files into your project xlog init initialize xlog when your app starts remember to use an exclusive folder to save the log files no other files are acceptable in the folder since they would be removed by the cleansing function in xlog automatically cpp nsstring logpath nssearchpathfordirectoriesindomains nsdocumentdirectory nsuserdomainmask yes objectatindex 0 stringbyappendingstring log set do not backup for logpath const char attrname com apple mobilebackup u int8 t attrvalue 1 setxattr logpath utf8string attrname attrvalue sizeof attrvalue 0 0 init xlogger if debug xlogger setlevel kleveldebug appender set console log true else xlogger setlevel klevelinfo appender set console log false endif appender open kappednerasync logpath utf8string test uninitialized xlog in function applicationwillterminate cpp appender close stn init initialize stn before you use it objc void setcallback mars stn setcallback mars stn stncallback instance mars app setcallback mars app appcallback instance void createmars mars baseevent oncreate void setclientversion uint32 clientversion mars stn setclientversion clientversion void setshortlinkdebugip nsstring ip port const unsigned short port std string ipaddress ip utf8string mars stn setshortlinksvraddr port ipaddress void setshortlinkport const unsigned short port mars stn setshortlinksvraddr port void setlonglinkaddress nsstring string port const unsigned short port debugip nsstring ip std string ipaddress string utf8string std string debugip ip utf8string std vector ports ports push back port mars stn setlonglinksvraddr ipaddress ports debugip void setlonglinkaddress nsstring string port const unsigned short port std string ipaddress string utf8string std vector ports ports push back port mars stn setlonglinksvraddr ipaddress ports void reportevent onforeground bool isforeground mars baseevent onforeground isforground void makesurelonglinkconnect mars stn makesurelonglinkconnected firstly you should call the setcalback interface and secondly the mars init then to initialize the mars there is to need to strictly follow the orders of the four commands finally after mars are initialized onforeground and makesurelonglinkconnect can be called if you want to destroy stn or exit app objc void destroymars mars baseevent ondestroy event change when the apps state of background or foreground is changed objc void reportevent onforeground bool isforeground mars baseevent onforeground isforground network change objc void reportevent onnetworkchange mars baseevent onnetworkchange windows install visual studio 2015 compile python python build for win32 py add mars lib as a dependency of your project rename files with rewriteme extension to cc extension add header files and source files into your project xlog init initialize xlog when your app starts remember to use an exclusive folder to save the log files no other files are acceptable in the folder since they would be removed by the cleansing function in xlog automatically cpp std string logpath use your log path std string pubkey use you pubkey for log encrypt init xlog if debug xlogger setlevel kleveldebug appender set console log true else xlogger setlevel klevelinfo appender set console log false endif appender open kappednerasync logpath c str test pubkey c str uninitialized xlog before your app exits cpp appender close stn init initialize stn before you use it cpp void setshortlinkdebugip const std string ip unsigned short port mars stn setshortlinksvraddr port ip void setshortlinkport unsigned short port mars stn setshortlinksvraddr port void setlonglinkaddress const std string ip unsigned short port const std string debug ip vector ports ports push back port mars stn setlonglinksvraddr ip ports debug ip void init mars stn setcallback mars stn stncallback instance mars app setcallback mars app appcallback instance mars baseevent oncreate todo mars stn setclientversion version setshortlinkdebugip setlonglinkaddress mars baseevent onforeground true mars stn makesurelonglinkconnected firstly you should call the setcalback interface and secondly the mars init then to initialize the mars there is to need to strictly follow the orders of the four commands finally after mars are initialized onforeground and makesurelonglinkconnect can be called if you want to destroy stn or exit app cpp mars baseevent ondestroy support any problem learn more from mars sample read the source code read the wiki or faq for help contact us for help contributing for more information about contributing issues or pull requests see our mars contributing guide license mars is under the mit license see the license file for details mars mars 是微信官方的跨平台跨业务的终端基础组件。 comm：可以独立使用的公共库，包括 socket、线程、消息队列、协程等； xlog：高可靠性高性能的运行期日志组件； sdt： 网络诊断组件； stn： 信令分发网络模块，也是 mars 最主要的部分。 samples sample 的使用请参考这里。 getting started 接入 android 或者 ios os x 或者 windows 。 android gradle 接入我们提供了两种接入方式：mars wrapper 或者 mars core。如果你只是想做个 sample 推荐使用 mars wrapper，可以快速开发；但是如果你想把 mars 用到你的 app 中的话，推荐使用 mars core，可定制性更高。 mars wrapper 在 app build gradle 中添加 mars wrapper 的依赖： xml dependencies compile com tencent mars mars wrapper 1 1 8 或者 mars core 在 app build gradle 中添加 mars core 的依赖： xml dependencies compile com tencent mars mars core 1 2 1 或者 mars xlog 如果只想使用 xlog 可以只加 xlog 的依赖 mars core mars wrapper 中都已经包括 xlog ： xml dependencies compile com tencent mars mars xlog 1 0 6 接着往下操作之前，请先确保你已经添加了 mars wrapper 或者 mars core 或者 mars xlog 的依赖 xlog init 在程序启动加载 xlog 后紧接着初始化 xlog。但要注意如果你的程序使用了多进程，不要把多个进程的日志输出到同一个文件中，保证每个进程独享一个日志文件。而且保存 log 的目录请使用单独的目录，不要存放任何其他文件防止被 xlog 自动清理功能误删。 java system loadlibrary stlport shared system loadlibrary marsxlog final string sdcard environment getexternalstoragedirectory getabsolutepath final string logpath sdcard marssample log this is necessary or may cash for sigbus final string cachepath this getfilesdir xlog init xlog if buildconfig debug xlog appenderopen xlog level debug xlog appednermodeasync cachepath logpath marssample xlog setconsolelogopen true else xlog appenderopen xlog level info xlog appednermodeasync cachepath logpath marssample xlog setconsolelogopen false log setlogimp new xlog 程序退出时关闭日志： java log appenderclose stn init 如果你是把 mars core 作为依赖加入到你的项目中的话，你需要显式的初始化和反初始化 stn 在使用 stn 之前进行初始化 java set callback applogic setcallback stub stnlogic setcallback stub sdtlogic setcallback stub initialize the mars platformcomm mars init getapplicationcontext new handler looper getmainlooper initialize the mars stnlogic setlonglinksvraddr profile longlinkhost profile longlinkports stnlogic setshortlinksvraddr profile shortlinkport stnlogic setclientversion profile productid mars oncreate true baseevent onforeground true stnlogic makesurelonglinkconnected 初始化顺序不一定要严格遵守上述代码的顺序，但在初始化时首先要调用 setcallback 接口 callback 文件的编写可以参考 demo ，再调用 mars init，最后再调用 onforeground 和 makesurelonglinkconnect，中间顺序可以随意更改。注意：stn 默认是后台，所以初始化 stn 后需要主动调用一次baseevent onforeground true 需要释放 stn 或者退出程序时 java mars ondestroy event change 网络切换时 java baseevent onnetworkchange 如果你是把 mars wrapper 作为依赖加入到你的项目中，你只需要显式的初始化 stn，不需要反初始化 因为 mars wrapper 会进行反初始化 java marsserviceproxy init this getmainlooper null 不管你是使用 mars wrapper 还是 mars core，你都需要特别注意以下事件： 前后台切换 java baseevent onforeground boolean 应用的账号信息更改 java stnlogic reset 如果你想修改 xlog 的加密算法或者长短连的加解包部分甚至更改组件的其他部分，可以参考这里 ios os x 编译 python build apple py 把 mars framework 作为依赖加入到你的项目中，把和 mars framework 同目录的后缀名为 rewriteme 的文件名删掉 rewriteme 和头文件一起加入到你的项目中。 xlog init 在程序启动加载 xlog 后紧接着初始化 xlog。但要注意保存 log 的目录请使用单独的目录，不要存放任何其他文件防止被 xlog 自动清理功能误删。 cpp nsstring logpath nssearchpathfordirectoriesindomains nsdocumentdirectory nsuserdomainmask yes objectatindex 0 stringbyappendingstring log set do not backup for logpath const char attrname com apple mobilebackup u int8 t attrvalue 1 setxattr logpath utf8string attrname attrvalue sizeof attrvalue 0 0 init xlogger if debug xlogger setlevel kleveldebug appender set console log true else xlogger setlevel klevelinfo appender set console log false endif appender open kappednerasync logpath utf8string test 在函数 applicationwillterminate 中反初始化 xlog cpp appender close stn init 在你用 stn 之前初始化： objc void setcallback mars stn setcallback mars stn stncallback instance mars app setcallback mars app appcallback instance void createmars mars baseevent oncreate void setclientversion uint32 clientversion mars stn setclientversion clientversion void setshortlinkdebugip nsstring ip port const unsigned short port std string ipaddress ip utf8string mars stn setshortlinksvraddr port ipaddress void setshortlinkport const unsigned short port mars stn setshortlinksvraddr port void setlonglinkaddress nsstring string port const unsigned short port debugip nsstring ip std string ipaddress string utf8string std string debugip ip utf8string std vector ports ports push back port mars stn setlonglinksvraddr ipaddress ports debugip void setlonglinkaddress nsstring string port const unsigned short port std string ipaddress string utf8string std vector ports ports push back port mars stn setlonglinksvraddr ipaddress ports void reportevent onforeground bool isforeground mars baseevent onforeground isforground void makesurelonglinkconnect mars stn makesurelonglinkconnected 初始化顺序不一定要严格遵守上述代码的顺序，但在初始化时首先要调用 setcallback 接口 callback 文件的编写可以参考 demo ，再调用 mars init，最后再调用 onforeground 和 makesurelonglinkconnect，中间顺序可以随意更改。注意：stn 默认是后台，所以初始化 stn 后需要主动调用一次baseevent onforeground true 需要释放 stn 或者退出程序时 objc void destroymars mars baseevent ondestroy event change 前后台切换时 objc void reportevent onforeground bool isforeground mars baseevent onforeground isforeground 网络切换时： objc void reportevent onnetworkchange mars baseevent onnetworkchange windows 安装visual studio 2015 编译 python python build for win32 py 把 mars lib作为依赖加入到你的项目中，把和 mars lib 同目录的后缀名为 rewriteme 的文件名删掉 rewriteme 和头文件一起加入到你的项目中。 xlog init 在程序启动加载 xlog 后紧接着初始化 xlog。但要注意保存 log 的目录请使用单独的目录，不要存放任何其他文件防止被 xlog 自动清理功能误删。 cpp std string logpath use your log path std string pubkey use you pubkey for log encrypt init xlog if debug xlogger setlevel kleveldebug appender set console log true else xlogger setlevel klevelinfo appender set console log false endif appender open kappednerasync logpath c str test pubkey c str 在程序退出前反初始化 xlog cpp appender close stn init 在你用 stn 之前初始化： cpp void setshortlinkdebugip const std string ip unsigned short port mars stn setshortlinksvraddr port ip void setshortlinkport unsigned short port mars stn setshortlinksvraddr port void setlonglinkaddress const std string ip unsigned short port const std string debug ip vector ports ports push back port mars stn setlonglinksvraddr ip ports debug ip void init mars stn setcallback mars stn stncallback instance mars app setcallback mars app appcallback instance mars baseevent oncreate todo mars stn setclientversion version setshortlinkdebugip setlonglinkaddress mars baseevent onforeground true mars stn makesurelonglinkconnected 初始化顺序不一定要严格遵守上述代码的顺序，但在初始化时首先要调用 setcallback 接口 callback 文件的编写可以参考 demo ，再调用 mars init，最后再调用 onforeground 和 makesurelonglinkconnect，中间顺序可以随意更改。注意：stn 默认是后台，所以初始化 stn 后需要主动调用一次baseevent onforeground true 需要释放 stn 或者退出程序时 cpp mars baseevent ondestroy support 还有其他问题？ 参看 mars sample； 阅读 源码； 阅读 wiki 或者 faq； 联系我们。 contributing 关于 mars 分支管理、issue 以及 pr 规范，请阅读 mars contributing guide。 license mars 使用的 mit 协议，详细请参考 license。