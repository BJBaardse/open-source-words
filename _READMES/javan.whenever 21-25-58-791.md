whenever is a ruby gem that provides a clear syntax for writing and deploying cron jobs installation sh gem install whenever or with bundler in your gemfile ruby gem whenever require false getting started sh cd apps my great project wheneverize this will create an initial config schedule rb file for you as long as the config folder is already present in your project the whenever command sh cd apps my great project whenever this will simply show you your schedule rb file converted to cron syntax it does not read or write your crontab file youll need to do this in order for your jobs to execute sh whenever update crontab other commonly used options include sh whenever user app set a user as which to install the crontab whenever load file config my schedule rb set the schedule file whenever crontab command sudo crontab override the crontab command you can list installed cron jobs using crontab l run whenever help for a complete list of options for selecting the schedule to use setting variables in the schedule etc example schedule rb file ruby every 3 hours do 1 minute 1 day 1 week 1 month 1 year is also supported runner mymodel some process rake my rake task command usr bin my great command end every 1 day at 4 30 am do runner mymodel task to run at four thirty in the morning end every 1 day at 4 30 am 6 00 pm do runner mymodel task to run in two times every day end every hour do many shortcuts available hour day month year reboot runner somemodel ladeeda end every sunday at 12pm do use any day of the week or weekend weekday runner task do something great end every 0 0 27 31 do command echo you can use raw cron syntax too end run this task only on servers with the app role in capistrano see capistrano roles section below every day at 12 20am roles app do rake app server task end define your own job types whenever ships with three pre defined job types command runner and rake you can define your own with job type for example ruby job type awesome usr local bin awesome task fun level every 2 hours do awesome party fun level extreme end would run usr local bin awesome party extreme every two hours task is always replaced with the first argument and any additional whatevers are replaced with the options passed in or by variables that have been defined with set the default job types that ship with whenever are defined like so ruby job type command task output job type rake cd path environment variable environment bundle exec rake task silent output job type runner cd path bin rails runner e environment task output job type script cd path environment variable environment bundle exec script task output pre rails 3 apps and apps that dont use bundler will redefine the rake and runner jobs respectively to function correctly if a path is not set it will default to the directory in which whenever was executed environment variable will default to rails env environment will default to production output will be replaced with your output redirection settings which you can read more about here http github com javan whenever wiki output redirection aka logging your cron jobs all jobs are by default run with bash l c command among other things this allows your cron jobs to play nice with rvm by loading the entire environment instead of crons somewhat limited environment read more http blog scoutapp com articles 2010 09 07 rvm and cron in production you can change this by setting your own job template ruby set job template bash l c job or set the job template to nil to have your jobs execute normally ruby set job template nil parsing dates and times whenever uses the chronic gem to parse the specified dates and times you can set your custom chronic configuration if the defaults dont fit you for example to assume a 24 hour clock instead of the default 12 hour clock ruby set chronic options hours24 true by default this would run the job every day at 3am every 1 day at 3 00 do runner mymodel nightly archive job end you can see a list of all available options here https github com mojombo chronic blob master lib chronic parser rb customize email recipient with the mailto environment variable output from the jobs is sent to the email address configured in the mailto environment variable there are many ways to further configure the recipient example a global configuration overriding the environments value ruby env mailto output of cron example com every 3 hours do command usr bin my great command end example a mailto configured for all the jobs in an interval block ruby every 3 hours mailto my super command example com do command usr bin my super command end example a mailto configured for a single job ruby every 3 hours do command usr bin my super command mailto my super command output example com end capistrano integration use the built in capistrano recipe for easy crontab updates with deploys for capistrano v3 see the next section in your config deploy rb file ruby require whenever capistrano take a look at the recipe for options you can set https github com javan whenever blob master lib whenever capistrano v2 recipes rb for example if youre using bundler do this ruby set whenever command bundle exec whenever require whenever capistrano if you are using different environments such as staging production then you may want to do this ruby set whenever environment defer stage require whenever capistrano the capistrano variable stage should be the one holding your environment name this will make the correct environment available in your schedule rb if both your environments are on the same server youll want to namespace them or theyll overwrite each other when you deploy ruby set whenever environment defer stage set whenever identifier defer application stage require whenever capistrano if you use a schedule at an alternative path you may configure it like so ruby set whenever load file defer release path somewhere else schedule rb require whenever capistrano capistrano v3 integration in your capfile file ruby require whenever capistrano take a look at the load defaults task bottom of file for options you can set for example to namespace the crontab entries by application and stage do this in your config deploy rb file ruby set whenever identifier fetch application fetch stage the capistrano integration by default expects the application variable to be set in order to scope jobs in the crontab capistrano roles the first thing to know about the new roles support is that it is entirely optional and backwards compatible if you dont need different jobs running on different servers in your capistrano deployment then you can safely stop reading now and everything should just work the same way it always has when you define a job in your schedule rb file by default it will be deployed to all servers in the whenever roles list which defaults to db however if you want to restrict certain jobs to only run on subset of servers you can add a roles argument to their definitions make sure to add that role to the whenever roles list in your deploy rb when you run cap deploy jobs with a roles list specified will only be added to the crontabs on servers with one or more of the roles in that list jobs with no roles argument will be deployed to all servers in the whenever roles list this is to maintain backward compatibility with previous releases of whenever so for example with the default whenever roles of db a job like this would be deployed to all servers with the db role ruby every day at 12 20am do rake foo bar end if we set whenever roles to db app in deploy rb and have the following jobs in schedule rb ruby every day at 1 37pm roles app do rake app task will only be added to crontabs of app servers end every hour roles db do rake db task will only be added to crontabs of db servers end every day at 12 02am do command run this everywhere will be deployed to db and app servers end here are the basic rules if a servers role isnt listed in whenever roles it will never have jobs added to its crontab if a servers role is listed in the whenever roles then it will have all jobs added to its crontab that either list that role in their roles arg or that dont have a roles arg if a job has a roles arg but that role isnt in the whenever roles list that job will not be deployed to any server rvm integration if your production environment uses rvm ruby version manager you will run into a gotcha that causes your cron jobs to hang this is not directly related to whenever and can be tricky to debug your rvmrc files must be trusted or else the cron jobs will hang waiting for the file to be trusted a solution is to disable the prompt by adding this line to your user rvm file in rvmrc rvm trust rvmrcs flag 1 this tells rvm to trust all rvmrc files heroku no heroku does not support cron instead providing heroku scheduler if you deploy to heroku you should use that rather than whenever testing whenever test is an extension to whenever for testing a whenever schedule credit whenever was created for use at inkling http inklingmarkets com their take on it http blog inklingmarkets com 2009 02 whenever easy way to do cron jobs from html thanks to all the contributors who have made it even better http github com javan whenever contributors discussion feedback issues bugs for general discussion and questions please use the google group http groups google com group whenever gem if youve found a genuine bug or issue please use the issues section on github http github com javan whenever issues ryan bates created a great railscast about whenever http railscasts com episodes 164 cron in ruby its a little bit dated now but remains a good introduction copyright Â© 2017 javan makhmali