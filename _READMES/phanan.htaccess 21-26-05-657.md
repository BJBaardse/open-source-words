htaccess snippets a collection of useful htaccess snippets all in one place note htaccess files are for people that do not have rights to edit the main server configuration file they are intrinsically slower and more complicated than using the main config please see the howto in the httpd documentation for further details disclaimer while dropping the snippet into an htaccess file is most of the time sufficient there are cases when certain modifications might be required use at your own risk important apache 2 4 introduces a few breaking changes most notably in access control configuration for more information check the upgrading document as well as this issue credits what we are doing here is mostly collecting useful snippets from all over the interwebs for example a good chunk is from apache server configs into one place while weve been trying to credit where due things might be missing if you believe anything here is your work and credits should be given let us know or just send a pr table of contents rewrite and redirection force www force www in a generic way force non www force non www in a generic way force https force https behind a proxy force trailing slash remove trailing slash redirect a single page redirect using redirectmatch alias a single directory alias paths to script redirect an entire site alias clean urls security deny all access deny all access except yours allow all access except spammers deny access to hidden files and directories deny access to backup and source files disable directory browsing disable image hotlinking disable image hotlinking for specific domains password protect a directory password protect a file or several files block visitors by referrer prevent framing the site performance compress text files set expires headers turn etags off miscellaneous set php variables custom error pages force downloading prevent downloading allow cross domain fonts auto utf 8 encode switch to another php version disable internet explorer compatibility view serve webp images rewrite and redirection note it is assumed that you have mod rewrite installed and enabled force www apacheconf rewriteengine on rewritecond http host example\ com nc rewriterule http www example com 1 l r 301 nc force www in a generic way apacheconf rewritecond http host rewritecond http host www\ nc rewritecond https s on s rewriterule http 1 www http host request uri r 301 l this works for any domain source force non www its still open for debate whether www or non www is the way to go so if you happen to be a fan of bare domains here you go apacheconf rewriteengine on rewritecond http host www\ example\ com nc rewriterule http example com 1 l r 301 force non www in a generic way apacheconf rewriteengine on rewritecond http host www\ rewritecond https s on s off rewritecond http 1 http host https www\ rewriterule 1 3 request uri r 301 l force https apacheconf rewriteengine on rewritecond https on rewriterule https http host request uri note its also recommended to enable http strict transport security hsts on your https website to help prevent man in the middle attacks see https developer mozilla org en us docs web security http strict transport security remove includesubdomains if you dont want to enforce hsts on all subdomains header always set strict transport security max age 31536000 includesubdomains force https behind a proxy useful if you have a proxy in front of your server performing tls termination apacheconf rewritecond http x forwarded proto https rewriterule https http host request uri force trailing slash apacheconf rewritecond request uri \ rewriterule request uri r 301 l remove trailing slash this snippet will redirect paths ending in slashes to their non slash terminated counterparts except for actual directories e g http www example com blog to http www example com blog this is important for seo since its recommended to have a canonical url for every page apacheconf rewritecond request filename d rewritecond request uri rewriterule 1 r 301 l source redirect a single page apacheconf redirect 301 oldpage html http www example com newpage html redirect 301 oldpage2 html http www example com folder source redirect using redirectmatch apacheconf redirectmatch 301 subdirectory http www newsite com newfolder 1 redirectmatch 301 htm 1 html redirectmatch 301 200 0 9 01 2 3 redirectmatch 301 category 1 redirectmatch 301 htaccesselite ultimate htaccess article html htaccess htaccess html redirectmatch 301 html 1 1 html 2 redirectmatch 301 manual http www php net manual 1 redirectmatch 301 dreamweaver tools 1 redirectmatch 301 z http static askapache com 1 source alias a single directory apacheconf rewriteengine on rewriterule source directory target directory 1 r 301 l alias paths to script apacheconf fallbackresource index fcgi this example has an index fcgi file in some directory and any requests within that directory that fail to resolve a filename directory will be sent to the index fcgi script its good if you want baz foo some cool path to be handled by baz foo index fcgi which also supports requests to baz foo while maintaining baz foo css style css and the like get access to the original path from the path info environment variable as exposed to your scripting environment apacheconf rewriteengine on rewriterule index fcgi qsa l rewritecond request filename f rewritecond request filename d rewriterule index fcgi 1 qsa l this is a less efficient version of the fallbackresource directive because using mod rewrite is more complex than just handling the fallbackresource directive but its also more flexible redirect an entire site apacheconf redirect 301 http newsite com this way does it with links intact that is www oldsite com some crazy link html will become www newsite com some crazy link html this is extremely helpful when you are just “moving” a site to a new domain source alias “clean” urls this snippet lets you use “clean” urls those without a php extension e g example com users instead of example com users php apacheconf rewriteengine on rewritecond script filename d rewriterule 1 php nc l source security deny all access apacheconf apache 2 2 deny from all apache 2 4 require all denied but wait this will lock you out from your content as well thus introducing deny all access except yours apacheconf apache 2 2 order deny allow deny from all allow from xxx xxx xxx xxx apache 2 4 require all denied require ip xxx xxx xxx xxx xxx xxx xxx xxxis your ip if you replace the last three digits with0 12 for example this will specify a range of ips within the same network thus saving you the trouble to list all allowed ips separately source now of course theres a reversed version allow all access except spammers apacheconf apache 2 2 order deny allow deny from xxx xxx xxx xxx deny from xxx xxx xxx xxy apache 2 4 require all granted require not ip xxx xxx xxx xxx require not ip xxx xxx xxx xxy deny access to hidden files and directories hidden files and directories those whose names start with a dot should most if not all of the time be secured for example htaccess htpasswd git hg apacheconf rewritecond script filename d or rewritecond script filename f rewriterule \ f alternatively you can just raise a “not found” error giving the attacker no clue apacheconf redirectmatch 404 \ deny access to backup and source files these files may be left by some text html editors like vi vim and pose a great security danger if exposed to public apacheconf apache 2 2 order allow deny deny from all satisfy all apache 2 4 require all denied source disable directory browsing apacheconf options all indexes disable image hotlinking apacheconf rewriteengine on remove the following line if you want to block blank referrer too rewritecond http referer rewritecond http referer https example com nc rewriterule jpe g png gif bmp nc f l if you want to display a “blocked” banner in place of the hotlinked image replace the above rule with rewriterule jpe g png gif bmp http example com blocked png r l disable image hotlinking for specific domains sometimes you want to disable image hotlinking from some bad guys only apacheconf rewriteengine on rewritecond http referer https badsite com nc or rewritecond http referer https badsite2 com nc or rewriterule jpe g png gif bmp nc f l if you want to display a “blocked” banner in place of the hotlinked image replace the above rule with rewriterule jpe g png gif bmp http example com blocked png r l password protect a directory first you need to create a htpasswd file somewhere in the system bash htpasswd c home fellowship htpasswd boromir then you can use it for authentication apacheconf authtype basic authname one does not simply authuserfile home fellowship htpasswd require valid user password protect a file or several files apacheconf authname one still does not simply authtype basic authuserfile home fellowship htpasswd require valid user require valid user block visitors by referrer this denies access for all users who are coming from referred by a specific domain source apacheconf rewriteengine on options followsymlinks rewritecond http referer somedomain com nc or rewritecond http referer anotherdomain com rewriterule f prevent framing the site this prevents the website to be framed i e put into an iframe tag when still allows framing for a specific uri apacheconf setenvif request uri starry night allow framing true header set x frame options sameorigin env allow framing performance compress text files apacheconf force compression for mangled headers https developer yahoo com blogs ydn pushing beyond gzipping 25601 html ifmodule mod setenvif c ifmodule mod headers c setenvifnocase accept encodxng x cept encoding x 15 15 15 gzip deflate \s \s x 4 13 have accept encoding requestheader append accept encoding gzip deflate env have accept encoding ifmodule ifmodule compress all output labeled with one of the following mime types for apache versions below 2 3 7 you dont need to enable mod filter and can remove the ifmodule mod filter c and ifmodule lines as addoutputfilterbytype is still in the core directives ifmodule mod filter c addoutputfilterbytype deflate application atom xml \ application javascript \ application json \ application rss xml \ application vnd ms fontobject \ application x font ttf \ application x web app manifest json \ application xhtml xml \ application xml \ font opentype \ image svg xml \ image x icon \ text css \ text html \ text plain \ text x component \ text xml ifmodule source set expires headers expires headers tell the browser whether they should request a specific file from the server or just grab it from the cache it is advisable to set static contents expires headers to something far in the future if you dont control versioning with filename based cache busting consider lowering the cache time for resources like css and js to something like 1 week source apacheconf expiresactive on expiresdefault access plus 1 month css expiresbytype text css access plus 1 year data interchange expiresbytype application json access plus 0 seconds expiresbytype application xml access plus 0 seconds expiresbytype text xml access plus 0 seconds favicon cannot be renamed expiresbytype image x icon access plus 1 week html components htcs expiresbytype text x component access plus 1 month html expiresbytype text html access plus 0 seconds javascript expiresbytype application javascript access plus 1 year manifest files expiresbytype application x web app manifest json access plus 0 seconds expiresbytype text cache manifest access plus 0 seconds media expiresbytype audio ogg access plus 1 month expiresbytype image gif access plus 1 month expiresbytype image jpeg access plus 1 month expiresbytype image png access plus 1 month expiresbytype video mp4 access plus 1 month expiresbytype video ogg access plus 1 month expiresbytype video webm access plus 1 month web feeds expiresbytype application atom xml access plus 1 hour expiresbytype application rss xml access plus 1 hour web fonts expiresbytype application font woff2 access plus 1 month expiresbytype application font woff access plus 1 month expiresbytype application vnd ms fontobject access plus 1 month expiresbytype application x font ttf access plus 1 month expiresbytype font opentype access plus 1 month expiresbytype image svg xml access plus 1 month turn etags off by removing the etag header you disable caches and browsers from being able to validate files so they are forced to rely on your cache control and expires header source apacheconf ifmodule mod headers c header unset etag ifmodule fileetag none miscellaneous set php variables apacheconf php value for example php value upload max filesize 50m php value max execution time 240 custom error pages apacheconf errordocument 500 houston we have a problem errordocument 401 http error example com mordor html errordocument 404 errors halflife3 html force downloading sometimes you want to force the browser to download some content instead of displaying it apacheconf files md forcetype application octet stream header set content disposition attachment files now there is a yang to this yin prevent downloading sometimes you want to force the browser to display some content instead of downloading it apacheconf filesmatch \ tex log aux header set content type text plain filesmatch allow cross domain fonts cdn served webfonts might not work in firefox or ie due to cors this snippet solves the problem apacheconf ifmodule mod headers c filesmatch \ eot otf ttc ttf woff woff2 header set access control allow origin filesmatch ifmodule source auto utf 8 encode your text content should always be utf 8 encoded no apacheconf use utf 8 encoding for anything served text plain or text html adddefaultcharset utf 8 force utf 8 for a number of file formats addcharset utf 8 atom css js json rss vtt xml source switch to another php version if youre on a shared host chances are there are more than one version of php installed and sometimes you want a specific version for your website the following snippet should switch the php version for you apacheconf addhandler application x httpd php56 php alternatively you can use addtype addtype application x httpd php56 php disable internet explorer compatibility view compatibility view in ie may affect how some websites are displayed the following snippet should force ie to use the edge rendering engine and disable the compatibility view apacheconf ifmodule mod headers c browsermatch msie is msie header set x ua compatible ie edge env is msie ifmodule serve webp images if webp images are supported and an image with a webp extension and the same name is found at the same place as the jpg png image that is going to be served then the webp image is served instead apacheconf rewriteengine on rewritecond http accept image webp rewritecond document root 1 webp f rewriterule \ jpe g png 1 webp t image webp e accept 1 source