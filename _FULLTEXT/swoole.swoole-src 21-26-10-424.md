swoole swoole is an event driven asynchronous concurrent networking communication framework with high performance written only in c for php document https www swoole co uk docs api https rawgit com tchiotludo swoole ide helper english docs index html ide helper https github com swoole ide helper 中文文档 http wiki swoole com twitter https twitter com php swoole slack group https swoole slack com swoft a modern high performance aop and coroutine php framework https github com swoft cloud easyswoole a simple high performance php framework based on swoole which makes using swoole as easy as echo hello world https www easyswoole com swooledistributed a high performance cooperative server framework based on all versions of swoole supporting microservice and cluster deployment and providing developers with many advanced development and debugging components https github com swooledistributed swooledistributed event based the network layer in swoole is event based and takes full advantage of the underlaying epoll kqueue implementation making it really easy to serve thousands of connections coroutine swoole 2 0 or later supports the built in coroutine and you can use fully synchronized code to implement asynchronous programs php code without any additional keywords the underlying automatic coroutine scheduling php php for i 0 i 100 i swoole\coroutine create function use i redis new swoole\coroutine\redis res redis connect 127 0 0 1 6379 ret redis incr coroutine redis close if i 50 swoole\coroutine create function use i redis new swoole\coroutine\redis res redis connect 127 0 0 1 6379 ret redis set coroutine i 50 redis close php php server new swoole\http\server 127 0 0 1 9501 server on request function request response tcp cli new swoole\coroutine\client swoole sock tcp tcp cli connect 127 0 0 1 9906 tcp cli send test for the coroutine ret tcp cli recv 5 tcp cli close if ret response end swoole response is ok else response end recv failed error client errcode server start short api name start a new coroutine php go function co sleep 0 5 echo hello go test go object method channel php chan new chan 128 chan push 1234 chan push 1234 56 chan push hello world chan push hello world chan push new stdclass chan push fopen test txt r while chan pop mysql client php go function db new co\mysql server array host 127 0 0 1 user root password root database test db connect server result db query select from userinfo where id 3 var dump result redis client php go function redis new co\redis res redis connect 127 0 0 1 6379 ret redis set key value var dump redis get key http client php go function http new co\http\client www google com 443 true http setheaders function ret http get var dump http body http2 client php go function http new co\http2\client www google com 443 true req new co\http2\request req path index html req headers host www google com user agent chrome 49 0 2587 3 accept text html application xhtml xml application xml accept encoding gzip req cookies name rango email rango swoole com ret http send req var dump http recv other php co sleep 100 co fread fp co gethostbyname www google com concurrent on the request processing part swoole uses a multi process model every process works as a worker all business logic is executed in workers synchronously with the synchronous logic execution you can easily write large and robust applications and take advantage of almost all libraries available to the php community in memory unlike traditional apache php fpm stuff the memory allocated in swoole will not be freed after a request which can improve performance a lot why swoole traditional php applications almost always run behind apache nginx without much control of the request this brings several limitations all memory will be freed after the request all php code needs be re compiled on every request even with opcache enabled all opcode still needs to be re executed it is almost impossible to implement long connections and connection pooling techniques implementing asynchronous tasks requires third party queue servers such as rabbitmq and beanstalkd implementing realtime applications such as chatting servers requires third party languages such as nodejs for example this is why swoole appeared swoole extends the use cases of php and brings all these possibilities to the php world by using swoole you can build enhanced web applications with more control real time chatting servers etc more easily requirements version 1 php 5 3 10 or later version 2 php 7 0 0 or later version 4 php 7 0 0 or later linux os x and basic windows support thanks to cygwin gcc 4 4 or later gcc 4 8 or later version 4 installation install via pecl pecl install swoole install from source sudo apt get install php7 dev git clone https github com swoole swoole src git cd swoole src phpize configure make make install introduction swoole includes components for different purposes server task worker timer event and async io with these components swoole allows you to build many features server this is the most important part in swoole it provides the necessary infrastructure to build server applications with swoole server you can build web servers chat messaging servers game servers and almost anything you want the following example shows a simple echo server php create a server instance serv new swoole server 127 0 0 1 9501 attach handler for connect event once the client has connected to the server the registered handler will be executed serv on connect function serv fd echo client connect \n attach handler for receive event every piece of data will be received by server and the registered handler will be executed all custom protocol implementation should be located there serv on receive function serv fd from id data serv send fd data serv on close function serv fd echo client close \n start our server listen on the port and be ready to accept connections serv start try to extend your server and implement what you want http server php http new swoole http server 0 0 0 0 9501 http on request function request response response header content type text html charset utf 8 response end hello swoole rand 1000 9999 http start websocket server php ws new swoole websocket server 0 0 0 0 9502 ws on open function ws request var dump request fd request get request server ws push request fd hello welcome\n ws on message function ws frame echo message frame data \n ws push frame fd server frame data ws on close function ws fd echo client fd is closed\n ws start real async mysql client php db new swoole mysql 127 0 0 1 root root test db on close function o echo mysql connection is closed\n db query select now as now t function db result rows var dump result rows db close real async redis client php client new swoole redis client connect 127 0 0 1 6379 function swoole redis client result echo connect\n var dump result client set key swoole function swoole redis client result var dump result client get key function swoole redis client result var dump result client close async http client php cli new swoole http client 127 0 0 1 80 cli setheaders user agent swoole cli post dump php array test 9999999 function swoole http client cli echo cli sock \tpost response length strlen cli body \n cli get index php function swoole http client cli echo cli sock \tget response length strlen cli body \n async websocket client php cli new swoole http client 127 0 0 1 9501 cli on message function cli frame var dump frame cli upgrade function cli echo cli body cli push hello world multi port and mixed protocol php serv new swoole http server 127 0 0 1 9501 swoole base port2 serv listen 0 0 0 0 9502 swoole sock tcp port2 on receive function swoole server serv fd from id data var dump data serv send fd data serv on request function req resp resp end hello world serv start task worker swoole brings you two types of workers server workers and task workers server workers are for request handling as demonstrated above task workers are for task execution with task workers we can execute our task asynchronously without blocking the server workers task workers are mainly used for time consuming tasks such as sending password recovery emails and ensure the main request returns as soon as possible the following example shows a simple server with task support php serv new swoole server 127 0 0 1 9502 sets server configuration we set task worker num config greater than 0 to enable task workers support serv set array task worker num 4 attach handler for receive event which has been explained above serv on receive function serv fd from id data we dispath a task to task workers by invoke the task method of serv this method returns a task id as the identity of ths task task id serv task data echo dispath asynctask id task id\n attach handler for task event the handler will be executed in task workers serv on task function serv task id from id data handle the task and do what you want with data echo new asynctask id task id php eol after the task is handled we return the results to the caller worker serv finish data ok attach handler for finish event the handler will be executed in server workers the same worker dispatched this task before serv on finish function serv task id data echo asynctask task id finish data php eol serv start swoole also supports synchronous tasks to use synchronous tasks just simply replace serv task data with serv taskwait data unlike task taskwait will wait for a task to complete before it returns its response timer swoole has built in millisecond timer support by using the timer it is easy to get a block of code executed periodically really useful for managing interval tasks to demonstrate how the timer works here is a small example php interval 2000ms serv tick 2000 function timer id echo tick 2000ms\n after 3000ms serv after 3000 function echo after 3000ms \n in the example above we first set the timer event handler to swoole server to enable timer support then we add two timers by calling bool swoole server addtimer interval once the server started to handle multiple timers we switch the interval in registered handler and do what we want to do event swooles i o layer is event based which is very convenient to add your own file descriptor to swooles main eventloop with event support you can also build fully asynchronous applications with swoole to use events in swoole we can use swoole event set to register event handler to sepecified file descriptor once registered descriptors become readable or writeable our registered handler will be invoked also we can using bool swoole event del int fd to remove registered file descriptor from eventloop the following are prototypes for the related functions php bool swoole event add fd mixed read callback mixed write callback int flag bool swoole event set fd mixed read callback mixed write callback int flag bool swoole event del fd the fd parameter can be one of the following types unix file descriptor stream resource created by stream socket client fsockopen sockets resources created by socket create in sockets extension require compile swoole with enable sockets support the read callback and write callback are callbacks for corresponding read write event the flag is a mask to indicate what type of events we should get notified can be swoole event read swoole event write or swoole event read swoole event write async io swooles async io provides the ability to read write files and lookup dns records asynchronously the following are signatures for these functions php bool swoole async readfile string filename mixed callback bool swoole async writefile test log file content mixed callback bool swoole async read string filename mixed callback int trunk size 8192 bool swoole async write string filename string content int offset 1 mixed callback null void swoole async dns lookup string domain function host ip bool swoole timer after after n ms mixed callback bool swoole timer tick n ms mixed callback bool swoole timer clear n ms mixed callback refer to api reference for more detailed information about these functions client swoole also provides a client component to build tcp udp clients in both asynchronous and synchronous ways swoole uses the swoole client class to expose all its functionalities synchronous blocking php client new swoole client swoole sock tcp if client connect 127 0 0 1 9501 0 5 die connect failed if client send hello world die send failed data client recv if data die recv failed client close asynchronous non blocking php client new swoole client swoole sock tcp swoole sock async client on connect function cli cli send hello world\n client on receive function cli data echo received data \n client on error function cli echo connect failed\n client on close function cli echo connection close\n client connect 127 0 0 1 9501 0 5 the following methods are available in swoole client php swoole client construct int sock type int is sync swoole sock sync string key int swoole client on string event mixed callback bool swoole client connect string host int port float timeout 0 1 int flag 0 bool swoole client isconnected int swoole client send string data bool swoole client sendfile string filename string swoole client recv int size 65535 bool waitall 0 bool swoole client close refer to api reference for more detailed information about these functions api reference 中文 english related projects swooleframework web framework powered by swoole contribution your contribution to swoole development is very welcome you may contribute in the following ways repost issues and feedback submit fixes features via pull request write polish documentation license apache license version 2 0 see http www apache org licenses license 2 0 html