moya a chinese version of this document can be found here youre a smart developer you probably use alamofire to abstract away access to urlsession and all those nasty details you dont really care about but then like lots of smart developers you write ad hoc network abstraction layers they are probably called apimanager or networkmodel and they always end in tears ad hoc network layers are common in ios apps theyre bad for a few reasons makes it hard to write new apps where do i begin makes it hard to maintain existing apps oh my god this mess makes it hard to write unit tests how do i do this again so the basic idea of moya is that we want some network abstraction layer that sufficiently encapsulates actually calling alamofire directly it should be simple enough that common things are easy but comprehensive enough that complicated things are also easy if you use alamofire to abstract away urlsession why not use something to abstract away the nitty gritty of urls parameters etc some awesome features of moya compile time checking for correct api endpoint accesses lets you define a clear usage of different endpoints with associated enum values treats test stubs as first class citizens so unit testing is super easy you can check out more about the project direction in the vision document sample projects we have provided two sample projects in the repository to use it download the repo run carthage update to download the required libraries and open moya xcodeproj youll see two schemes basic and multi target select one and then build run source files for these are in the examples directory in project navigator have fun project status this project is actively under development and is being used in artsys new auction app we consider it ready for production use installation moya version vs swift version below is a table that shows which version of moya you should use for your swift version swift moya rxmoya reactivemoya 4 x 9 0 10 0 9 0 3 x 8 0 0 8 0 5 8 0 0 8 0 5 8 0 0 8 0 5 2 3 7 0 2 7 0 4 7 0 2 7 0 4 7 0 2 7 0 4 2 2 7 0 1 7 0 1 7 0 1 upgrading to a new major version of moya check out our migration guides swift package manager to integrate using apples swift package manager add the following as a dependency to your package swift swift package url https github com moya moya git uptonextmajor from 11 0 0 and then specify moya as a dependency of the target in which you wish to use moya if you want to use reactive extensions add also reactivemoya or rxmoya as your target dependency respectively heres an example packagedescription swift swift tools version 4 0 import packagedescription let package package name mypackage products library name mypackage targets mypackage dependencies package url https github com moya moya git uptonextmajor from 11 0 0 targets target name mypackage dependencies reactivemoya note that as of moya 10 spm only works with swift 4 toolchain and greater cocoapods for moya use the following entry in your podfile rb pod moya 11 0 or pod moya rxswift 11 0 or pod moya reactiveswift 11 0 then run pod install in any file youd like to use moya in dont forget to import the framework with import moya carthage carthage users can point to this repository and use whichever generated framework theyd like moya rxmoya or reactivemoya make the following entry in your cartfile github moya moya then run carthage update if this is your first time using carthage in the project youll need to go through some additional steps as explained over at carthage note at this time carthage does not provide a way to build only specific repository submodules all submodules and their dependencies will be built with the above command however you dont need to copy frameworks you arent using into your project for instance if you arent using reactiveswift feel free to delete that framework along with reactivemoya from the carthage build directory after carthage update completes or if you are using reactiveswift but not rxswift then rxmoya rxtest rxcocoa etc can safely be deleted manually open up terminal cd into your top level project directory and run the following command if your project is not initialized as a git repository bash git init add alamofire result moya as a git submodule by running the following commands bash git submodule add https github com alamofire alamofire git git submodule add https github com antitypical result git git submodule add https github com moya moya git open the new alamofire folder and drag the alamofire xcodeproj into the project navigator of your applications xcode project do the same with the result xcodeproj in the result folder and moya xcodeproj in the moya folder they should appear nested underneath your applications blue project icon whether it is above or below all the other xcode groups does not matter verify that the deployment targets of the xcodeprojs match that of your application target in the project navigator next select your application project in the project navigator blue project icon to navigate to the target configuration window and select the application target under the targets heading in the sidebar in the tab bar at the top of that window open the general panel click on the button under the embedded binaries section you will see two different alamofire xcodeproj folders each with two different versions of the alamofire framework nested inside a products folder it does not matter which products folder you choose from but it does matter whether you choose the top or bottom alamofire framework select the top alamofire framework for ios and the bottom one for os x you can verify which one you selected by inspecting the build log for your project the build target for alamofire will be listed as either alamofire ios alamofire macos alamofire tvos or alamofire watchos click on the button under embedded binaries again and add the build target you need for result click on the button again and add the correct build target for moya and thats it the three frameworks are automagically added as a target dependency linked framework and embedded framework in a copy files build phase which is all you need to build on the simulator and a device usage after some setup using moya is really simple you can access an api like this swift provider moyaprovider github provider request zen result in switch result case let success moyaresponse let data moyaresponse data let statuscode moyaresponse statuscode do something with the response data or statuscode case let failure error this means there was a network failure either the request wasnt sent connectivity or no response was received server timed out if the server responds with a 4xx or 5xx error that will be sent as a success ful response thats a basic example many api requests need parameters moya encodes these into the enum you use to access the endpoint like this swift provider moyaprovider github provider request userprofile ashfurrow result in do something with the result no more typos in urls no more missing parameter values no more messing with parameter encoding for more examples see the documentation reactive extensions even cooler are the reactive extensions moya provides reactive extensions for reactiveswift and rxswift reactiveswift reactiveswift extension provides both reactive request callbackqueue and reactive requestwithprogress callbackqueue methods that immediately return signalproducers that you can start bind map or whatever you want to do to handle errors for instance we could do the following swift provider moyaprovider github provider reactive request userprofile ashfurrow start event in switch event case let value response image uiimage data response data case let failed error print error default break rxswift rxswift extension also provide both rx request callbackqueue and rx requestwithprogress callbackqueue methods but return type is different for both in case of a normal rx request callbackqueue the return type is single response which emits either single element or an error in case of a rx requestwithprogress callbackqueue the return type is observable progressresponse since we may get multiple events from progress and one last event which is a response to handle errors for instance we could do the following swift provider moyaprovider github provider rx request userprofile ashfurrow subscribe event in switch event case let success response image uiimage data response data case let error error print error in addition to the option of using signals instead of callback blocks there are also a series of signal operators for rxswift and reactiveswift that will attempt to map the data received from the network response into either an image some json or a string with mapimage mapjson and mapstring respectively if the mapping is unsuccessful youll get an error on the signal you also get handy methods for filtering out certain status codes this means that you can place your code for handling api errors like 400s in the same places as code for handling invalid responses community projects moya has a great community around it and some people have created some very helpful extensions contributing hey do you like moya awesome we could actually really use your help open source isnt just writing code moya could use your help with any of the following finding and reporting bugs new feature suggestions answering questions on issues documentation improvements reviewing pull requests helping to manage issue priorities fixing bugs new features if any of that sounds cool to you send a pull request after your first contribution we will add you as a member to the repo so you can merge pull requests and help steer the ship ship you can read more details about that in our contributor guidelines moyas community has a tremendous positive energy and the maintainers are committed to keeping things awesome like in the cocoapods community always assume positive intent even if a comment sounds mean spirited give the person the benefit of the doubt please note that this project is released with a contributor code of conduct by participating in this project you agree to abide by its terms adding new source files if you add or remove a source file from moya a corresponding change needs to be made to the moya xcodeproj project at the root of this repository this project is used for carthage dont worry youll get an automated warning when submitting a pull request if you forget help us improve moya documentation whether youre a core member or a user trying it out for the first time you can make a valuable contribution to moya by improving the documentation help us by sending us feedback about something you thought was confusing or simply missing suggesting better wording or ways of explaining certain topics sending us a pull request via github improving the chinese documentation license moya is released under an mit license see license md for more information