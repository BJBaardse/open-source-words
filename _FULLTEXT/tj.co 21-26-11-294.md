co generator based control flow goodness for nodejs and the browser using promises letting you write non blocking code in a nice ish way co v4 co 4 0 0 has been released which now relies on promises it is a stepping stone towards the async await proposal the primary api change is how co is invoked before co returned a thunk which you then called with a callback and optional arguments now co returns a promise js co function var result yield promise resolve true return result then function value console log value function err console error err stack if you want to convert a co generator function into a regular function that returns a promise you now use co wrap fn js var fn co wrap function val return yield promise resolve val fn true then function val platform compatibility co 4 requires a promise implementation for versions of node 0 11 and for many older browsers you should must include your own promise polyfill when using node 0 10 x and lower or browsers without generator support you must use gnode and or regenerator when using node 0 11 x you must use the harmony generators flag or just harmony to get access to generators node v4 is supported out of the box you can use co without flags or polyfills installation npm install co associated libraries any library that returns promises work well with co mz wrap all of nodes code libraries as promises view the wiki for more libraries examples js var co require co co function yield any promise var result yield promise resolve true catch onerror co function resolve multiple promises in parallel var a promise resolve 1 var b promise resolve 2 var c promise resolve 3 var res yield a b c console log res 1 2 3 catch onerror errors can be try catched co function try yield promise reject new error boom catch err console error err message boom catch onerror function onerror err log any uncaught errors co will not throw any errors you do not handle handle all your errors console error err stack yieldables the yieldable objects currently supported are promises thunks functions array parallel execution objects parallel execution generators delegation generator functions delegation nested yieldable objects are supported meaning you can nest promises within objects within arrays and so on promises read more on promises thunks thunks are functions that only have a single argument a callback thunk support only remains for backwards compatibility and may be removed in future versions of co arrays yielding an array will resolve all the yieldables in parallel js co function var res yield promise resolve 1 promise resolve 2 promise resolve 3 console log res 1 2 3 catch onerror objects just like arrays objects resolve all yieldables in parallel js co function var res yield 1 promise resolve 1 2 promise resolve 2 console log res 1 1 2 2 catch onerror generators and generator functions any generator or generator function you can pass into co can be yielded as well this should generally be avoided as we should be moving towards spec compliant promises instead api co fn then val returns a promise that resolves a generator generator function or any function that returns a generator js co function return yield promise resolve true then function val console log val function err console error err stack var fn co wrap fn convert a generator into a regular function that returns a promise js var fn co wrap function val return yield promise resolve val fn true then function val license mit