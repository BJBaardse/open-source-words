supertest http assertions made easy via superagent about the motivation with this module is to provide a high level abstraction for testing http while still allowing you to drop down to the lower level api provided by superagent getting started install supertest as an npm module and save it to your package json file as a development dependency npm install supertest save dev once installed it can now be referenced by simply calling require supertest example you may pass an http server or a function to request if the server is not already listening for connections then it is bound to an ephemeral port for you so there is no need to keep track of ports supertest works with any test framework here is an example without using any test framework at all js const request require supertest const express require express const app express app get user function req res res status 200 json name john request app get user expect content type json expect content length 15 expect 200 end function err res if err throw err heres an example with mocha note how you can pass done straight to any of the expect calls js describe get user function it respond with json function done request app get user set accept application json expect content type json expect 200 done one thing to note with the above statement is that superagent now sends any http error anything other than a 2xx response code to the callback as the first argument if you do not add a status code expect i e expect 302 if you are using the end method expect assertions that fail will not throw they will return the assertion as an error to the end callback in order to fail the test case you will need to rethrow or pass err to done as follows js describe post users function it responds with json function done request app post users send name john set accept application json expect 200 end function err res if err return done err done you can also use promises js describe get users function it responds with json function return request app get users set accept application json expect 200 then response assert response body email foo bar com expectations are run in the order of definition this characteristic can be used to modify the response body or headers before executing an assertion js describe post user function it user name should be an case insensitive match for john function done request app post user send name john x www form urlencoded upload set accept application json expect function res res body id some fixed id res body name res body name touppercase expect 200 id some fixed id name john done anything you can do with superagent you can do with supertest for example multipart file uploads js request app post field name my awesome avatar attach avatar test fixtures avatar jpg passing the app or url each time is not necessary if youre testing the same host you may simply re assign the request variable with the initialization app or url a new test is created per request verb call js request request http localhost 5555 request get expect 200 function err console log err request get expect heya function err console log err heres an example with mocha that shows how to persist a request and its cookies js const request require supertest const should require should const express require express const cookieparser require cookie parser describe request agent app function const app express app use cookieparser app get function req res res cookie cookie hey res send app get return function req res if req cookies cookie res send req cookies cookie else res send const agent request agent app it should save cookies function done agent get expect set cookie cookie hey path done it should send cookies function done agent get return expect hey done there is another example that is introduced by the file agency js api you may use any superagent methods including write pipe etc and perform assertions in the end callback for lower level needs expect status fn assert response status code expect status body fn assert response status code and body expect body fn assert response body text with a string regular expression or parsed body object expect field value fn assert header field value with a string or regular expression expect function res pass a custom assertion function itll be given the response object to check if the check fails throw an error js request app get expect haspreviousandnextkeys end done function haspreviousandnextkeys res if next in res body throw new error missing next key if prev in res body throw new error missing prev key end fn perform the request and invoke fn err res notes inspired by api easy minus vows coupling license mit